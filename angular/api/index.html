<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何使用 Angular 存取 Web API ? | 點燈坊</title>
  <meta name="author" content="真 OO無双">
  
  <meta name="description" content="使用 JSON Server + JSON2TS + HttpClient + Service + DI Container 存取 Web API">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta name="description" content="使用 JSON Server + JSON2TS + HttpClient + Service + DI Container 存取 Web API">
<meta property="og:type" content="article">
<meta property="og:title" content="如何使用 Angular 存取 Web API ?">
<meta property="og:url" content="http://oomusou.io/angular/api/index.html">
<meta property="og:site_name" content="點燈坊">
<meta property="og:description" content="使用 JSON Server + JSON2TS + HttpClient + Service + DI Container 存取 Web API">
<meta property="og:image" content="http://oomusou.io/images/feature/logo.png">
<meta property="og:updated_time" content="2018-01-07T08:04:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何使用 Angular 存取 Web API ?">
<meta name="twitter:description" content="使用 JSON Server + JSON2TS + HttpClient + Service + DI Container 存取 Web API">
 

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
     <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		<li><a  href="/">點燈坊</a></li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 
	
		<div class="page-header">		
			<h1> 如何使用 Angular 存取 Web API ?</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

	
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> 使用 JSON Server + JSON2TS + HttpClient + Service + DI Container 存取 Web API			
		</div> <!-- alert -->
		

	<!-- toc -->
	<div id="postTOC">
		<span class="tocHeading">Contents</span>
		<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Version"><span class="toc-article-text">Version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#User_Story"><span class="toc-article-text">User Story</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Architecture"><span class="toc-article-text">Architecture</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Implementation"><span class="toc-article-text">Implementation</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JSON_Server"><span class="toc-article-text">JSON Server</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#安裝_JSON_Server"><span class="toc-article-text">安裝 JSON Server</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#第一次啟動_JSON_Server"><span class="toc-article-text">第一次啟動 JSON Server</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#測試_JSON_Server"><span class="toc-article-text">測試 JSON Server</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立_JSON_Server_Routes"><span class="toc-article-text">建立 JSON Server Routes</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立_Angular_CLI_Proxy"><span class="toc-article-text">建立 Angular CLI Proxy</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#由_npm_管理_JSON_Server_與_Proxy"><span class="toc-article-text">由 npm 管理 JSON Server 與 Proxy</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#JSON_Schema_to_TypeScript"><span class="toc-article-text">JSON Schema to TypeScript</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#安裝_JSON_Schema_to_TypeScript"><span class="toc-article-text">安裝 JSON Schema to TypeScript</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#JSON_Schema"><span class="toc-article-text">JSON Schema</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#將_JSON_Schema_轉_TypeScript_Interface"><span class="toc-article-text">將 JSON Schema 轉 TypeScript Interface</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#TypeScript_Interface"><span class="toc-article-text">TypeScript Interface</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#AppComponent"><span class="toc-article-text">AppComponent</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#IPostService"><span class="toc-article-text">IPostService</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#PostService"><span class="toc-article-text">PostService</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#AppModule"><span class="toc-article-text">AppModule</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#為什麼要使用_Service?"><span class="toc-article-text">為什麼要使用 Service?</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Conclusion"><span class="toc-article-text">Conclusion</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Sample_Code"><span class="toc-article-text">Sample Code</span></a></li></ol>
    </div>

	<!-- content -->
	<div class="mypage">		
	    <p>前後端分離後，前端除了負責顯示邏輯外，最重要的就是與 API 溝通。在 JQuery 只要使用 <code>$.ajax()</code> 就可存取 API；但在 Angular，則必須透過 service 與 DI container ，component 才可存取 API，完全遵守 <code>依賴反轉原則</code>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>Node.js 8.9.0<br>Angular 5.1.0<br>JSON Server 0.12.1</p>
<h2 id="User_Story">User Story</h2><hr>
<p><img src="/images/angular/angular-json-schema/http000.png" alt="http000"></p>
<ul>
<li><code>Add Post</code> : 使用 <code>POST</code> 對 API 新增資料</li>
<li><code>Show All Posts</code> : 使用 <code>GET</code> 對 API 抓資料</li>
</ul>
<h2 id="Architecture">Architecture</h2><hr>
<p><img src="/images/angular/angular-json-schema/http001.svg" alt="http001"></p>
<ul>
<li><code>AppComponent</code> : 專門負責顯示邏輯</li>
<li><code>PostService</code> : 專門負責連接 API 與資料處理部份</li>
<li><code>IPostService</code> : 由 <code>AppComponent</code> 觀點所定義出的 interface</li>
<li><code>HttpClient</code> : Angular 4.3 所新增處理 AJAX 的 class</li>
</ul>
<blockquote>
<p>依賴反轉原則</p>
<p>高階模組不應該依賴低階模組；兩著都應該依賴高階模組所定義的 interface</p>
</blockquote>
<p><code>AppComponent</code> 不直接依賴 <code>PostService</code>，且 <code>AppComponent</code> 與  <code>PostService</code> 都反過來依賴 <code>AppComponent</code> 所定義的 <code>IPostService</code> interface。</p>
<h2 id="Implementation">Implementation</h2><hr>
<h3 id="JSON_Server">JSON Server</h3><p>前後端分離後，前後端所依據的就是 JSON 資料，傳統前端會在先 <code>var</code> 一個 JSON，等要連 API 時，再用 <code>$.ajax()</code> 去改變 JSON 資料，這樣雖然可行，但必須去修改 code。</p>
<p><img src="/images/angular/angular-json-schema/http020.svg" alt="http020"></p>
<p>比較好的方式是改用 JSON Server，讓我們實際去模擬 HTTP 的 GET/POST/PUT/PATCH 與 DELETE，只要透過 proxy，就會連上 JSON Server，若不透過 proxy，就連上 API Server，無論怎麼切換，都不用去修改 code。</p>
<h4 id="安裝_JSON_Server">安裝 JSON Server</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> <span class="keyword">json</span>-<span class="keyword">server</span></span></span><br></pre></td></tr></table></figure>
<p>將 JSON Server 安裝在 global 環境。</p>
<p><img src="/images/angular/angular-json-schema/http002.png" alt="http002"></p>
<h4 id="第一次啟動_JSON_Server">第一次啟動 JSON Server</h4><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ cd MyProject</span><br><span class="line">~/MyProject$ mkdir json-<span class="keyword">server</span></span><br><span class="line">~/MyProject$ cd json-<span class="keyword">server</span></span><br><span class="line">~/MyProject/json-<span class="keyword">server</span>$ json-<span class="keyword">server</span> db.json</span><br></pre></td></tr></table></figure>
<p><img src="/images/angular/angular-json-schema/http003.png" alt="http003"></p>
<ol>
<li>進入專案目錄</li>
<li>在專案目錄建立 <code>json-server</code> 子目錄</li>
<li>進入 <code>json-server</code> 子目錄</li>
<li>第一次啟動 JSON Server，指定 <code>db.json</code> 為資料庫檔案</li>
<li>JSON Server 預設會啟動在 <code>http://localhost:3000</code> ，並提供 <code>posts</code>、 <code>comments</code> 與 <code>profile</code> 3 個 table</li>
</ol>
<p><img src="/images/angular/angular-json-schema/http004.png" alt="http004"></p>
<ol>
<li>若 <code>db.json</code> 存在，則 JSON Server 會以此檔案為資料庫，若不存在，則會建立新的 <code>db.json</code> </li>
<li>預設會有 <code>posts</code>、<code>comments</code> 與 <code>profile</code> 3 個 table</li>
</ol>
<h4 id="測試_JSON_Server">測試 JSON Server</h4><p>預設 <code>db.json</code> 已經有資料，可藉此測試 JSONServer 是否有成功啟動。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http:</span><span class="comment">//localhost:3000/posts</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/angular/angular-json-schema/http005.png" alt="http005"></p>
<p>使用 Postman 測試 GET </p>
<ol>
<li>選擇 <code>GET</code></li>
<li>輸入 <code>http://localhost:3000/posts</code></li>
<li>正確回傳 JSON</li>
</ol>
<p><img src="/images/angular/angular-json-schema/http006.png" alt="http006"></p>
<p>使用 Postman 測試 POST</p>
<ol>
<li>選擇 <code>POST</code></li>
<li>輸入 <code>http://localhost:3000/posts</code></li>
<li>選擇 <code>Headers</code></li>
<li>Key 為 <code>Content-Type</code>，value 為 <code>application/json</code></li>
</ol>
<p><img src="/images/angular/angular-json-schema/http007.png" alt="http007"></p>
<ol>
<li>選擇 <code>Body</code></li>
<li>選擇 <code>raw</code></li>
<li>選擇 <code>JSON (application/json)</code></li>
<li>輸入要新增的 JSON 資料</li>
</ol>
<blockquote>
<p>不用包含 <code>id</code>，JSON Server 會自動幫你新增</p>
</blockquote>
<p><img src="/images/angular/angular-json-schema/http008.png" alt="http008"></p>
<ol>
<li>選擇 <code>db.json</code></li>
<li>剛剛由 Postman 新增的資料會寫入 <code>db.json</code></li>
</ol>
<h4 id="建立_JSON_Server_Routes">建立 JSON Server Routes</h4><p>我們可以自行在 <code>db.json</code> 建立新的 table，但預設 URI 都會在 root，可能不適合使用 (一般都會放在 <code>/api</code> 下，如 <code>/api/posts</code>)，我們可自行加入 route 加以 mapping。</p>
<p><strong>json-server/routes.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">/api/posts</span>": <span class="value"><span class="string">"/posts"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>json-server</code> 目錄下新增 <code>routes.json</code>，將 <code>/api/posts</code> 對應到 JSON Server 的  <code>/posts</code>。<br><img src="/images/angular/angular-json-schema/http009.png" alt="http009"></p>
<ol>
<li>在 <code>json-server</code> 目錄下新增 <code>routes.json</code></li>
<li>將 <code>/api/routes</code> 對應到 JSON Server 的 <code>/posts</code></li>
</ol>
<h4 id="建立_Angular_CLI_Proxy">建立 Angular CLI Proxy</h4><p>Angular CLI 預設並不會使用 JSON Server，因此我們必須讓 Angular 會透過 proxy 去打 JSON Server。</p>
<p><strong>proxy.conf.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">/api</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">target</span>": <span class="value"><span class="string">"http://localhost:3000"</span></span>,</span><br><span class="line">    "<span class="attribute">secure</span>": <span class="value"><span class="literal">false</span></span><br><span class="line">  </span>&#125;</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>在專案根目錄下新增 <code>proxy.conf.json</code>，將 <code>/api</code> mapping 到 <code>http://localhost:3000</code>，也就是 JSON Server。</p>
<p><img src="/images/angular/angular-json-schema/http010.png" alt="http010"></p>
<ol>
<li>在專案根目錄下新增 <code>proxy.conf.json</code> </li>
<li>將 <code>/api</code> 對應到 JSON Server 的 <code>http://localhost:3000</code></li>
</ol>
<h4 id="由_npm_管理_JSON_Server_與_Proxy">由 npm 管理 JSON Server 與 Proxy</h4><p>由於每次都要啟動 JSON Server 與 proxy，且參數有點繁瑣，比較好的方式是統一由 npm 來管理。</p>
<p><strong>package.json</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "ng5-http-client",</span><br><span class="line">  "version": "0.0.0",</span><br><span class="line">  "license": "MIT",</span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "ng": "ng",</span><br><span class="line">    "start": "ng serve",</span><br><span class="line">    "proxy": "ng serve --proxy-config proxy.conf.json",</span><br><span class="line">    "build": "ng build",</span><br><span class="line">    "test": "ng test",</span><br><span class="line">    "lint": "ng lint",</span><br><span class="line">    "e2e": "ng e2e",</span><br><span class="line">    "json-server": "json-server ./json-server/db.json --routes ./json-server/routes.json"</span><br><span class="line">  &#125;,</span><br><span class="line">  (略)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>13 行</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"json-server"</span>: <span class="string">"json-server ./json-server/db.json --routes ./json-server/routes.json"</span></span><br></pre></td></tr></table></figure>
<p>新增 <code>npm json-server</code>，除了指定使用 <code>db.json</code> 外，還會使用自訂 route。</p>
<p>第 8 行</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"proxy"</span>: <span class="string">"ng serve --proxy-config proxy.conf.json"</span>,</span><br></pre></td></tr></table></figure>
<p>原本 <code>npm start</code> 得以保留，此為不透過 proxy 方式，另外新增 <code>npm proxy</code>，將會透過 proxy 使用 JSON Server。</p>
<p><img src="/images/angular/angular-json-schema/http011.png" alt="http011"></p>
<ol>
<li>選擇 <code>package.json</code></li>
<li>新增 <code>proxy</code> 使 Angular CLI 透過 proxy 使用 JSON Server</li>
<li>新增 <code>json-server</code> 啟動 JSON Server</li>
</ol>
<p>每次要開發專案時 :</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject$ npm <span class="command">run</span> json-server</span><br></pre></td></tr></table></figure>
<p>先 <code>npm run json-server</code> 執行 JSON Server</p>
<p><img src="/images/angular/angular-json-schema/http012.png" alt="http012"></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject$ npm <span class="command">run</span> proxy</span><br></pre></td></tr></table></figure>
<p>再 <code>npm run proxy</code> 透過 proxy 使用 JSON Server</p>
<p><img src="/images/angular/angular-json-schema/http013.png" alt="http013"></p>
<blockquote>
<p>必須開兩個 terminal 分別執行 <code>npm run json-server</code> 與 <code>npm run proxy</code>，因為都必須同時在背景執行</p>
</blockquote>
<h3 id="JSON_Schema_to_TypeScript">JSON Schema to TypeScript</h3><p>後端會以 JSON Schema 定義 JSON 格式與型別，而 Angular 亦會使用 interface 定義 JSON 的型別提供檢查。</p>
<p>透過 <code>JSON Schema to TypeScript</code>，我們可以直接將 JSON Schema 轉成 TypeScript interface，可節省時間，也可避免 typo。</p>
<h4 id="安裝_JSON_Schema_to_TypeScript">安裝 JSON Schema to TypeScript</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g json-schema-to-typescript</span><br></pre></td></tr></table></figure>
<p>將 JSON schema to TypeScript 安裝在 global 環境。</p>
<h4 id="JSON_Schema">JSON Schema</h4><p><strong>post.schema.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">title</span>": <span class="value"><span class="string">"Post"</span></span>,</span><br><span class="line">  "<span class="attribute">type</span>": <span class="value"><span class="string">"object"</span></span>,</span><br><span class="line">  "<span class="attribute">properties</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">id</span>": <span class="value">&#123;</span><br><span class="line">      "<span class="attribute">type</span>": <span class="value"><span class="string">"number"</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">title</span>": <span class="value">&#123;</span><br><span class="line">      "<span class="attribute">type</span>": <span class="value"><span class="string">"string"</span></span><br><span class="line">    </span>&#125;</span>,</span><br><span class="line">    "<span class="attribute">author</span>": <span class="value">&#123;</span><br><span class="line">      "<span class="attribute">type</span>": <span class="value"><span class="string">"string"</span></span><br><span class="line">    </span>&#125;</span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">additionalProperties</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">  "<span class="attribute">required</span>": <span class="value">[<span class="string">"title"</span>, <span class="string">"author"</span>]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>定義了 <code>id</code>、<code>title</code> 與 <code>author</code> 3 個欄位，其中 <code>title</code> 與 <code>author</code> 為必填。</p>
<h4 id="將_JSON_Schema_轉_TypeScript_Interface">將 JSON Schema 轉 TypeScript Interface</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject/src/app/model$ json2ts post<span class="class">.schema</span><span class="class">.json</span> post<span class="class">.model</span><span class="class">.ts</span></span><br></pre></td></tr></table></figure>
<p>目前將 <code>post.schema.json</code> 放在 <code>/src/app/model</code> 目錄下。</p>
<p>使用 <code>json2ts</code> 將 <code>post.schema.json</code> 轉成 <code>post.model.ts</code>。</p>
<p><img src="/images/angular/angular-json-schema/http014.png" alt="http014"></p>
<h4 id="TypeScript_Interface">TypeScript Interface</h4><p><strong>post.model.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * This file was automatically generated by json-schema-to-typescript.</span><br><span class="line"> * DO NOT MODIFY IT BY HAND. Instead, modify the source JSONSchema file,</span><br><span class="line"> * and run json-schema-to-typescript to regenerate this file.</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="interface"><span class="keyword">interface</span> Post </span>&#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  author: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由 <code>json2ts</code> 所轉出來的 TypeScript interface，最上面有 <code>json2ts</code> 所產生的註解。</p>
<blockquote>
<p>將然若有 JSON 欄位異動，請不要直接修改 TypeScript interface，而應該直接去修改 JSON Schema，再由 <code>json2ts</code> 產生 TypeScript interface</p>
</blockquote>
<p><img src="/images/angular/angular-json-schema/http015.png" alt="http015"></p>
<ol>
<li>由 <code>json2ts</code> 所產生的 <code>post.model.ts</code></li>
<li>由 <code>json2ts</code> 所產生的註解</li>
<li>由 <code>json2ts</code> 所轉出的 TypeScript interface</li>
</ol>
<h3 id="AppComponent">AppComponent</h3><p><img src="/images/angular/angular-json-schema/http017.svg" alt="http017"></p>
<p><strong>app.component.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> [(<span class="attribute">ngModel</span>)]=<span class="value">"title"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">button</span> (<span class="attribute">click</span>)=<span class="value">"onClick()"</span>&gt;</span>Add Post<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">li</span> *<span class="attribute">ngFor</span>=<span class="value">"let post of posts"</span>&gt;</span></span><br><span class="line">    &#123;&#123; post.id&#125;&#125; &#123;&#123;post.title&#125;&#125; &#123;&#123;post.author&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第 1 行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> [(<span class="attribute">ngModel</span>)]=<span class="value">"title"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>title</code> 的輸入框，直接使用 <code>ngModel</code> 的 two way binding 到 <code>title</code> field。</p>
<p>第 2 行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">button</span> (<span class="attribute">click</span>)=<span class="value">"onClick()"</span>&gt;</span>Add Post<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Button 的 <code>click</code> event 對應到 <code>AppComponent.onClick()</code>。</p>
<p>第 4 行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">l</span> *<span class="attribute">ngFor</span>=<span class="value">"let post of posts"</span>&gt;</span></span><br><span class="line">    &#123;&#123; post.id&#125;&#125; &#123;&#123;post.title&#125;&#125; &#123;&#123;post.author&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>*ngFor</code> 將所有 <code>posts</code> 展開。</p>
<p><strong>app.component.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IPostService &#125; from <span class="string">'./service/post/ipostservice.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Post &#125; from <span class="string">'./model/post.model'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  posts: Post[];</span><br><span class="line"></span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(private postService: IPostService) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.getAllPosts();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onClick() &#123;</span><br><span class="line">    <span class="keyword">const</span> post = &lt;Post&gt;&#123;</span><br><span class="line">      <span class="string">'title'</span> : <span class="keyword">this</span>.title,</span><br><span class="line">      <span class="string">'author'</span> : <span class="string">'Sam'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.postService.addPost(post)</span><br><span class="line">      .subscribe(</span><br><span class="line">        value =&gt; <span class="built_in">console</span>.log(value),</span><br><span class="line">        error =&gt; <span class="built_in">console</span>.log(error),</span><br><span class="line">        () =&gt; <span class="built_in">console</span>.log(<span class="string">'PUT completed'</span>)</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.getAllPosts();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> getAllPosts() &#123;</span><br><span class="line">    <span class="keyword">this</span>.postService.getAllPosts()</span><br><span class="line">      .subscribe(</span><br><span class="line">        value =&gt; <span class="keyword">this</span>.posts = value,</span><br><span class="line">        error =&gt; <span class="built_in">console</span>.log(error),</span><br><span class="line">        () =&gt; <span class="built_in">console</span>.log(<span class="string">'GET completed'</span>)</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>11 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title: <span class="built_in">string</span>;</span><br><span class="line">posts: Post[];</span><br></pre></td></tr></table></figure>
<p>要與 HTML 做 data binding 的東西都會宣告在 public field。</p>
<ul>
<li><code>title</code> : 給 <code>&lt;input type=&quot;text&quot;&gt;</code> 做 two-way binding </li>
<li><code>posts</code> :  給 <code>*ngFor</code> 做 data binding</li>
</ul>
<p>14 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor"><span class="keyword">constructor</span>(private postService: IPostService) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將 <code>PostService</code> 依賴注入，其型別為 <code>IPostService</code> interface。</p>
<blockquote>
<p>依賴反轉原則</p>
<p>高階模組不應該依賴低階模組；兩著都應該依賴高階模組所定義的 interface</p>
</blockquote>
<p>所以 <code>AppComponent</code> 不應該直接依賴 <code>PostService</code>，而應該依賴 <code>IPostService</code> interface，因此 <code>PostService</code> 的型別是 <code>IPostService</code>。</p>
<p>17 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngOnInit(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.getAllPosts();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一載入時，希望能顯示所有 <code>Post</code> 。</p>
<p>37 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> getAllPosts() &#123;</span><br><span class="line">  <span class="keyword">this</span>.postService.getAllPosts()</span><br><span class="line">    .subscribe(</span><br><span class="line">      value =&gt; <span class="keyword">this</span>.posts = value,</span><br><span class="line">      error =&gt; <span class="built_in">console</span>.log(error),</span><br><span class="line">      () =&gt; <span class="built_in">console</span>.log(<span class="string">'GET completed'</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為 <code>ngOnInit()</code> 與 <code>onClick()</code> 都會呼叫 <code>PostService.getAllPosts()</code>，基於 <code>DRY 原則</code>，將共用抽到 <code>getAllPosts()</code>。</p>
<p>因為呼叫 <code>PostService</code> 的 <code>getAllPosts()</code>，也因此期望 <code>IPostService</code> interface 有 <code>getAllPosts()</code>。</p>
<p><code>PostService.getAllPost()</code> 回傳為 <code>Observable</code>，因此要使用 <code>subscribe()</code> 訂閱 <code>Observable</code>。</p>
<p><code>subscribe()</code> 共有 3 個參數 :</p>
<ul>
<li><strong>next</strong> : 當 service 的非同步執行完後，<code>下一個</code> 要執行的動作，<code>value</code> 會傳回 <code>Post[]</code>，因此可直接指定給 <code>this.posts</code></li>
<li><strong>error</strong> : 當 <code>HttpClient</code> 執行錯誤時所執行的 arrow function</li>
<li><strong>complete</strong> : 當 <code>HttpClient</code> 執行完成時所執行的 arrow function</li>
</ul>
<p>21 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">onClick() &#123;</span><br><span class="line">  <span class="keyword">const</span> post = &lt;Post&gt;&#123;</span><br><span class="line">    <span class="string">'title'</span> : <span class="keyword">this</span>.title,</span><br><span class="line">    <span class="string">'author'</span> : <span class="string">'Sam'</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.postService.addPost(post)</span><br><span class="line">    .subscribe(</span><br><span class="line">      value =&gt; <span class="built_in">console</span>.log(value),</span><br><span class="line">      error =&gt; <span class="built_in">console</span>.log(error),</span><br><span class="line">      () =&gt; <span class="built_in">console</span>.log(<span class="string">'PUT completed'</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.getAllPosts();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增 <code>Post</code> 到資料庫。</p>
<p>因為呼叫 <code>PostService</code> 的 <code>addPost()</code>，傳入 <code>Post</code> model，也因此希望 <code>IPostService</code> interface 有  <code>addPost()</code>。</p>
<p><code>PostService.addPost()</code> 也是回傳 <code>Observable</code>，因此要使用 <code>subscribe()</code> 訂閱 <code>Observable</code>。</p>
<h3 id="IPostService">IPostService</h3><p><img src="/images/angular/angular-json-schema/http018.svg" alt="http018"></p>
<p><strong>ipostservice.interface.ts</strong><br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Post &#125; from <span class="string">'../../model/post.model'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable &#125; from <span class="string">'rxjs/Observable'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> abstract <span class="keyword">class</span> IPostService &#123;</span><br><span class="line">  abstract addPost(post: Post): Observable&lt;Post&gt;;</span><br><span class="line">  abstract getAllPosts(): Observable&lt;Post[]&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根據 <code>AppComponent</code> 的需求，我們希望 <code>IPostService</code> 有 <code>addPost()</code> 與 <code>getAllPosts()</code> 兩個 method。</p>
<p><code>IPostService</code> 觀念上是 interface，所以理想上應該這樣寫 :</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="interface"><span class="keyword">interface</span> IPostService </span>&#123;</span><br><span class="line">  addPost(post: Post): Observable&lt;Post&gt;;</span><br><span class="line">  getAllPosts(): Observable&lt;Post[]&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但若實際這樣寫，TypeScript 編譯沒問題，但 <code>ng serve</code> 時會執行錯誤。</p>
<p><img src="/images/angular/angular-json-schema/http016.png" alt="http016"></p>
<p>主要在於 interface 是 TypeScript 所擴充，在編譯成 JavaScript 後並沒有 interface，導致 DI container 在執行時找不到 interface 而造成 run-time 錯誤。</p>
<p>也就是說 interface 在 TypeScript 主要是用來 <code>編譯檢查</code>。</p>
<p><code>抽象</code> 除了使用 interface 實現外，也可以使用 <code>abstract class</code>，在 ES6 有 <code>abstract class</code>，在 ES5 也有相對應的解法，所以目前必須改用 <code>abstract class</code> 取代 <code>interface</code> 實現 <code>抽象</code>。</p>
<blockquote>
<p>在 Angular 的 DI container，觀念上是 interface，但實作上須與 JavaScript 妥協，改用 <code>abstract class</code> 實踐 <code>interface</code>。</p>
</blockquote>
<h3 id="PostService">PostService</h3><p><img src="/images/angular/angular-json-schema/http019.svg" alt="http019"></p>
<p><strong>post.service.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IPostService &#125; from <span class="string">'./ipostservice.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Post &#125; from <span class="string">'../../model/post.model'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable &#125; from <span class="string">'rxjs/Observable'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpClient &#125; from <span class="string">'@angular/common/http'</span>;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PostService <span class="keyword">implements</span> IPostService &#123;</span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(private httpClient: HttpClient) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">  addPost(post: Post): Observable&lt;Post&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.httpClient</span><br><span class="line">      .post&lt;Post&gt;(<span class="string">'api/posts'</span>, post);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getAllPosts(): Observable&lt;Post[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.httpClient</span><br><span class="line">      .get&lt;Post[]&gt;(<span class="string">'api/posts'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第 7 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Injectable()</span><br></pre></td></tr></table></figure>
<p>因為加了 <code>@Injectable()</code> decorator，所以 <code>PostService</code> 可以透過 DI container 依賴注入。</p>
<blockquote>
<p>並不是所有的 class 都可以由 DI container 依賴注入，必須要加上 <code>@Injectable</code> decorator 的 class 才可以</p>
</blockquote>
<p>第 8 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> PostService <span class="keyword">implements</span> IPostService &#123;</span><br></pre></td></tr></table></figure>
<p>因為 <code>依賴反轉原則</code>，<code>PostService</code> 必須實作 <code>IPostService</code> interface。</p>
<p>第 9 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor"><span class="keyword">constructor</span>(private httpClient: HttpClient) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<p>因為要使用 <code>HttpClient</code>，將 <code>HttpClient</code> 注入到 <code>PostService</code>。</p>
<p>11 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">addPost(post: Post): Observable&lt;Post&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.httpClient</span><br><span class="line">    .post&lt;Post&gt;(<span class="string">'api/posts'</span>, post);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 <code>HttpClient.post&lt;T&gt;()</code> 執行 POST，將 <code>Post</code> model 傳入，其中 <code>&lt;T&gt;</code> 傳入 <code>Post</code> model 的型別 <code>Post</code>。</p>
<p><code>HttpClient.post&lt;T&gt;()</code> 回傳的型別為 <code>Observable</code>，其本質為 <code>Post</code> model，會將傳進來的 <code>Post</code> 再傳回 <code>Observable&lt;Post&gt;</code>。</p>
<p>由於 <code>subscribe()</code> 最後要由 component 決定，因此將 <code>Observale</code> 回傳給 component 去 <code>subscribe()</code>。</p>
<blockquote>
<p>由於在 <code>addPost()</code> 並沒有 <code>subscribe()</code>，因此 <code>addPost()</code> 目前為止還沒有真的執行 POST</p>
</blockquote>
<p>16 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getAllPosts(): Observable&lt;Post[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.httpClient</span><br><span class="line">    .get&lt;Post[]&gt;(<span class="string">'api/posts'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 <code>HttpClient.get&lt;T&gt;()</code> 執行 GET，其中 <code>&lt;T&gt;</code> 為回傳的 <code>Post[]</code> 型別。</p>
<p><code>HttpClient.get&lt;T&gt;()</code> 回傳的型別為 <code>Observable</code>，其本質為 <code>Post[]</code>。</p>
<p>由於 <code>subscribe()</code> 最後要由 component 決定，因此將 <code>Observale</code> 回傳給 component 去 <code>subscribe()</code>。</p>
<blockquote>
<p>由於在 <code>getAllPosts()</code> 並沒有 <code>subscribe()</code>，因此 <code>getAllPosts()</code> 目前為止還沒有真的執行 GET</p>
</blockquote>
<p>在 Angular 2 所提供的 <code>Http</code>，至今仍可用，但用法較麻煩 :<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.http.get(<span class="string">'api/posts'</span>)</span><br><span class="line">  .map(response =&gt; response.json());</span><br></pre></td></tr></table></figure></p>
<p>Angular 4.3 的 <code>HttpClient</code> 改用泛型後，除了在 <code>get()</code> 與  <code>post()</code> 都可以明顯看到型別，語意較佳，且寫法也教精簡，不用再透過 <code>map()</code> 去轉成 JSON。</p>
<blockquote>
<p>實務上建議改用 <code>HttpClient</code>，不要再使用 <code>Http</code></p>
</blockquote>
<h3 id="AppModule">AppModule</h3><p><strong>app.module.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserModule &#125; from <span class="string">'@angular/platform-browser'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; from <span class="string">'./app.component'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IPostService &#125; from <span class="string">'./service/post/ipostservice.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PostService &#125; from <span class="string">'./service/post/post.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HttpClientModule &#125; from <span class="string">'@angular/common/http'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FormsModule &#125; from <span class="string">'@angular/forms'</span>;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule,</span><br><span class="line">    HttpClientModule,</span><br><span class="line">    FormsModule</span><br><span class="line">  ],</span><br><span class="line">  providers: [</span><br><span class="line">    &#123;provide: IPostService, useClass: PostService&#125;</span><br><span class="line">  ],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>13 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imports: [</span><br><span class="line">  BrowserModule,</span><br><span class="line">  HttpClientModule,</span><br><span class="line">  FormsModule</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<ul>
<li><code>HttpClient</code> 須使用 <code>HttpClientModule</code></li>
<li><code>[(ngModel)]</code> 須使用 <code>FormsModule</code></li>
</ul>
<p>18 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">providers: [</span><br><span class="line">  &#123;provide: IPostService, useClass: PostService&#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>DI container 一定要提供 interface 與 class 的 mapping。</p>
<p>在 <code>providers</code> 後為 object array，每一個 object  為 interface 與 class 的 mapping。</p>
<ul>
<li><strong>provide</strong> : interface 名稱</li>
<li><strong>useClass</strong> : class 名稱</li>
</ul>
<h2 id="為什麼要使用_Service?">為什麼要使用 Service?</h2><hr>
<p>或許你會認為，明明使用  <code>$.ajax()</code> 向後端 API 抓資料是很單純的事情，為什麼 Angular 還要大費周章透過 Service + DI container，而不是提供一個簡單的 function 就好了嗎？有幾個原因：</p>
<ul>
<li>將來若其他 component 要使用 API 時，將 service 直接 DI 進 compoent 即可</li>
<li>將來若要對 API 的 service 做抽換，可直接透過 DI 換掉即可</li>
<li>將來若要對 component 做單元測試，可輕易的 <code>spyOn</code> API service 即可</li>
</ul>
<blockquote>
<p>簡單的說，將 API 部分獨立成 service，目的要使 component 與 API <code>解耦合</code>，且讓 component 不直接相依於 service，兩者僅相依於 component 所定義的 interface，符合 <code>依賴反轉原則</code></p>
</blockquote>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li><strong>JSON Server</strong> : 讓我們在開發階段模擬真實的 API server</li>
<li><strong>JSON Schema to TypeScript</strong> : 將 JSON Schema 轉成 TypeScript interface，更有效率也避免 typo</li>
<li><strong>HttpClient</strong> : 語意更佳，也更簡單的寫法存取 API</li>
<li><strong>Angular DI Container</strong> : Angular 實現 <code>依賴反傳</code> 與 <code>依賴注入</code> 的解決方案</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/NG5HttpClient" target="_blank" rel="external">GitHub</a> 上找到。</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/angular/observable-data-service/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/tags"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/netcore/webapi-di/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-12-24 
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Angular/">Angular<span>48</span></a></li>
    </ul>
	</div>
		

    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer>  </footer>
</div> <!-- container-narrow -->
  
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hAXbiVYFC92XF16_EhCh','2.0.0');
  </script>



  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
