<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[點燈坊]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://oomusou.io/"/>
  <updated>2018-04-19T02:50:08.129Z</updated>
  <id>http://oomusou.io/</id>
  
  <author>
    <name><![CDATA[真 OO無双]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[如何使用 C# 實現 Composite Pattern ?]]></title>
    <link href="http://oomusou.io/design-pattern/composite/"/>
    <id>http://oomusou.io/design-pattern/composite/</id>
    <published>2018-04-18T12:23:43.000Z</published>
    <updated>2018-04-19T02:50:08.129Z</updated>
    <content type="html"><![CDATA[<p>Composite Pattern 是 OOP 中著名的 Design Pattern，無論是 <code>物件</code> 或 <code>容器</code>，都能使用相同 interface 一視同仁的操作。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>C# 7.2</p>
<h2 id="User_Story">User Story</h2><hr>
<p>由購物車計算商品價錢，但在活動期間，Apple 產品組合有特惠 ：</p>
<ul>
<li><strong>MacBook Pro 15”</strong>：6 萬</li>
<li><strong>iPad Air</strong>：1 萬</li>
<li><strong>Apple Watch</strong>：1 萬</li>
<li><strong>Apple 套餐組合</strong> : (Macbook Pro + iPad Air + Apple Watch) 總價打九折：<code>(6 + 1 + 1) * 0.9</code> = 7.2 萬</li>
</ul>
<p><img src="/images/design-pattern/composite/composite011.svg" alt="composite011"></p>
<p>若同時買 MacBook Pro + iPad Air + Apple Watch + Apple 套餐為 15.2 萬。</p>
<h2 id="Task">Task</h2><hr>
<p>在不改變產品 interface 的原則下，計算購物車價錢。</p>
<h2 id="Definition">Definition</h2><hr>
<blockquote>
<p>Composite Pattern</p>
<p>當 <code>單一資料</code> 與 <code>整體資料</code> 同時存在時，讓 client 有一致性的操作方式</p>
</blockquote>
<p><img src="/images/design-pattern/composite/composite008.svg" alt="composite008"></p>
<ul>
<li><p><strong>Client</strong>：<code>Leaf</code> 與 <code>Composite</code> 的 user，實務上可能是 component 或 controller</p>
</li>
<li><p><strong>Component</strong>：定義 <code>Leaf</code> 與 <code>Composite</code> 的共用 interface</p>
</li>
<li><p><strong>Leaf</strong>：表示 <code>單一資料</code></p>
</li>
<li><p><strong>Composite</strong>：表示 <code>整體資料</code></p>
</li>
</ul>
<p><img src="/images/design-pattern/composite/composite009.svg" alt="composite009"></p>
<p>由於 <code>Composite</code> 表示 <code>整體資料</code>，實務上可能還包含其他 <code>Composite</code>，而產生類似 tree 的結構。</p>
<blockquote>
<p>Composite Pattern 的確可以處理 tree 結構，但 tree 並非必要條件</p>
</blockquote>
<p><strong>適用時機</strong></p>
<ul>
<li>同時存在 <code>單一資料</code> 與 <code>整體資料</code> 時</li>
<li>想讓 client 不需分辨 <code>單一資料</code> 與 <code>整體資料</code>，都以相同的方式操作資料</li>
<li>不想使用 <code>繼承</code> 來描述 <code>樹狀結構</code></li>
</ul>
<p><strong>優點</strong></p>
<ul>
<li>​ Client 程式碼精簡，不需寫一堆 <code>if else</code> 判斷是 <code>單一資料</code> 或 <code>整體資料</code>，完全發揮 OOP 的 <code>多型</code></li>
<li>增加新的 <code>Leaf</code> 或 <code>Composite</code>，也不用修改 client 程式碼，符合 <code>開放封閉原則</code></li>
</ul>
<h2 id="Architecture">Architecture</h2><hr>
<p><img src="/images/design-pattern/composite/composite000.svg" alt="composite000"></p>
<ul>
<li><p><strong>ShoppingService</strong>：相當於 <code>Client</code></p>
</li>
<li><p><strong>IPrice</strong>：定義 <code>MabookPro</code>、<code>IPadAir</code>、<code>AppleWatch</code> 與 <code>AppleCombo</code> 的共用 interface，相當於 <code>Component</code> interface</p>
</li>
<li><p><strong>MacbookPro</strong>：單一產品，相當於 <code>Leaf</code></p>
</li>
<li><p><strong>IPadAir</strong>：單一產品，相當於 <code>Leaf</code></p>
</li>
<li><p><strong>AppleWatch</strong>：單一產品，相當於 <code>Leaf</code></p>
</li>
<li><p><strong>AppleCombo</strong>：套餐組合，相當於 <code>Composite</code></p>
</li>
</ul>
<h2 id="Implementation">Implementation</h2><hr>
<p><img src="/images/design-pattern/composite/composite001.svg" alt="composite001"></p>
<p><strong>Program.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> ShoppingCartLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> shoppingCartService = <span class="keyword">new</span> ShoppingCartService();</span><br><span class="line">            shoppingCartService.AddCart(<span class="keyword">new</span> MacBookPro());</span><br><span class="line">            shoppingCartService.AddCart(<span class="keyword">new</span> IPadAir());</span><br><span class="line">            shoppingCartService.AddCart(<span class="keyword">new</span> AppleWatch());</span><br><span class="line">            shoppingCartService.AddCart(<span class="keyword">new</span> AppleCombo());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> result = shoppingCartService.CalculatePrice();</span><br><span class="line">            Console.WriteLine(<span class="string">"&#123;0&#125;"</span>, result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>無論是 MacBook Pro、IPad Air、Apple Watch 或 AppleCombo 套餐組合，都統一用 <code>AddCart()</code> 新增。</p>
<p>且無論是 <code>單一產品</code> 或 <code>套餐組合</code>，都使用 <code>CalculatePrice()</code> 統一計算。</p>
<blockquote>
<p>可以猜想 <code>AddCart()</code> 與 <code>CalculatePrice()</code> 應該遵循特定 interface 使用，且 <code>單一產品</code> 與 <code>套餐組合</code> 也應該遵循特定 interface 實踐，client 才有可能這麼漂亮的實作</p>
</blockquote>
<h3 id="Composite_Pattern">Composite Pattern</h3><p><strong>IPrice</strong></p>
<p><img src="/images/design-pattern/composite/composite002.svg" alt="composite002"></p>
<p><strong>IPrice.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>訂定 <code>單一產品</code> 與 <code>套餐組合</code> 所遵守的共同 interface，這也是 Composite Pattern 的關鍵。</p>
<p><strong>MacBookPro</strong></p>
<p><img src="/images/design-pattern/composite/composite003.svg" alt="composite003"></p>
<p><strong>MacBookPro.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MacBookPro</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">60000.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>單一產品 MacBookPro 實踐 <code>IPrice</code>。</p>
<p><strong>IPadAir</strong></p>
<p><img src="/images/design-pattern/composite/composite004.svg" alt="composite004"></p>
<p><strong>IPadAir.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IPadAir</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10000.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>單一產品 IPadAir 實踐 <code>IPrice</code>。</p>
<blockquote>
<p>在 C# 世界習慣 interface 以 <code>I</code> 為 prefix，理論上 class name 不建議以 <code>I</code> 為開頭，這裡是因為 Apple 產品就叫做 <code>I</code> PadAir</p>
</blockquote>
<p><strong>AppleWatch</strong></p>
<p><img src="/images/design-pattern/composite/composite005.svg" alt="composite005"></p>
<p><strong>AppleWatch.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppleWatch</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10000.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>單一產品 AppleWatch 實踐 <code>IPrice</code>。</p>
<p><strong>AppleCombo</strong></p>
<p><img src="/images/design-pattern/composite/composite006.svg" alt="composite006"></p>
<p><strong>AppleCombo.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppleCombo</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _products;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AppleCombo</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            _products = <span class="keyword">new</span> List&lt;IPrice&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> MacBookPro(),</span><br><span class="line">                <span class="keyword">new</span> IPadAir(),</span><br><span class="line">                <span class="keyword">new</span> AppleWatch()</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> sum = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> _products)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += product.GetPrice();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0.9</span> * sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第 5 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppleCombo</span> : <span class="title">IPrice</span></span><br></pre></td></tr></table></figure>
<p>Apple <code>套餐組合</code> 也要實踐 <code>IPrice</code>，重點在於不再是 <code>單一產品</code> 要實踐 interface，而是連 <code>套餐組合</code> 也要實踐 interface。</p>
<p>也就是在將來，我們會將 <code>單一產品</code> 與 <code>套餐組合</code> 都一視同仁使用，也就是 OOP 的 <code>多型</code> 的實踐。</p>
<p>第 7 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _products;</span><br></pre></td></tr></table></figure>
<p>將套餐中所有產品 <code>封裝</code> 在 <code>_products</code> field，注意 <code>List</code> 的泛型為 <code>IPrice</code> interface，也就是只有實踐 <code>IPrice</code> 的單一產品才能加入，若該產品沒有實踐 <code>IPrice</code>，compiler 在編譯階段就可以擋掉。</p>
<blockquote>
<p>這也是 OOP 處理 side effect 方式，使用 private field 封裝在 class 內，避免資料被外界修改</p>
</blockquote>
<p>第 9 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AppleCombo</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    _products = <span class="keyword">new</span> List&lt;IPrice&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> MacBookPro(),</span><br><span class="line">        <span class="keyword">new</span> IPadAir(),</span><br><span class="line">        <span class="keyword">new</span> AppleWatch()</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為 Apple 套餐組合同時包含 MacBook Pro、iPad Air 與 Apple Watch，因此在 constructor 同時將產品建立好。</p>
<p>19 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> _products)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += product.GetPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.9</span> * sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將所有產品加總，並打九折。</p>
<p>也因為所有產品都遵守 <code>IPrice()</code> interface 的 <code>GetPrice()</code>，因此可以使用 <code>foreach()</code> 一視同仁以 <code>GetPrice()</code> 計算，這就是 interface 與 OOP <code>多型</code> 的優點。</p>
<p><strong>ShoppingCartService</strong></p>
<p><img src="/images/design-pattern/composite/composite007.svg" alt="composite007"></p>
<p><strong>ShoppingCartService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShoppingCartService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _carts = <span class="keyword">new</span> List&lt;IPrice&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddCart</span>(<span class="params">IPrice product</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            _carts.Add(product);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">CalculatePrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> sum = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> _carts)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += product.GetPrice();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第 7 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _carts = <span class="keyword">new</span> List&lt;IPrice&gt;();</span><br></pre></td></tr></table></figure>
<p>將購物車的購物資料封裝在 <code>_carts</code> field，注意 List 的泛型為 <code>IPrice</code> interface，也就是無論是 <code>單一產品</code> 或者 <code>套餐組合</code>，只要實踐 <code>IPrice</code> interface 就一視同仁，只要任何產品或套餐沒實踐 interface 而加入 List，compiler 在 compile-time 就會報錯。</p>
<p>第 9 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddCart</span>(<span class="params">IPrice product</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    _carts.Add(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AddCart()</code> 新增至購物車，只要實踐 <code>IPrice</code> 的 <code>單一產品</code> 或 <code>套餐組合</code> 都可加入購物車。</p>
<p>14 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">CalculatePrice</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> product <span class="keyword">in</span> _carts)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += product.GetPrice();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CalculatePrice()</code> 計算購物車內的產品總金額，也由於 <code>單一產品</code> 與 <code>套餐組合</code> 都實踐 <code>IPrice</code> interface，因此可以安心用 <code>foreach()</code> 一視同仁的使用 <code>GetPrice()</code> 計算。</p>
<blockquote>
<p>這就是 Composite Pattern 的關鍵，也因為都有實踐 <code>IPrice</code> interface，我們能安心使用 <code>IPrice</code> 的 <code>GetPrice()</code>，且 IDE 的 intellisense 也能顯示</p>
</blockquote>
<h3 id="Refactoring">Refactoring</h3><p>目前為止 Composite Pattern 已經完成，但我們發現有不少 code smell，需要進一步的重構。</p>
<p><strong>MacBookPro</strong></p>
<p><img src="/images/design-pattern/composite/composite003.svg" alt="composite003"></p>
<p><strong>MacBookPro.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MacBookPro</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">double</span> Price = <span class="number">60000.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前將 <code>60000.0</code> hardcode 在 <code>GetPrice()</code>，這樣會造成將來維護上的困然，應該使用 <code>Introduce Field</code> 重構到 field。</p>
<p><strong>IPadAir</strong></p>
<p><img src="/images/design-pattern/composite/composite004.svg" alt="composite004"></p>
<p><strong>IPadAir.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IPadAir</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">double</span> Price = <span class="number">10000.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前將 <code>10000.0</code> hardcode 在 <code>GetPrice()</code>，這樣會造成將來維護上的困然，應該使用 <code>Introduce Field</code> 重構到 field。</p>
<p><strong>AppleWatch</strong></p>
<p><img src="/images/design-pattern/composite/composite005.svg" alt="composite005"></p>
<p><strong>AppleWatch.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppleWatch</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">double</span> Price = <span class="number">10000.0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前將 <code>10000.0</code> hardcode 在 <code>GetPrice()</code>，這樣會造成將來維護上的困然，應該使用 <code>Introduce Field</code> 重構到 field。</p>
<p><strong>AppleCombo</strong></p>
<p><img src="/images/design-pattern/composite/composite006.svg" alt="composite006"></p>
<p><strong>AppleCombo.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppleCombo</span> : <span class="title">IPrice</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">double</span> Discount = <span class="number">0.9</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _products;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AppleCombo</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            _products = <span class="keyword">new</span> List&lt;IPrice&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> MacBookPro(),</span><br><span class="line">                <span class="keyword">new</span> IPadAir(),</span><br><span class="line">                <span class="keyword">new</span> AppleWatch()</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Discount * _products.Sum(product =&gt; product.GetPrice());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>21 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Discount * _products.Sum(product =&gt; product.GetPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 將 <code>0.9</code> 使用 <code>Introduce Field</code> 重構到 field，並將 for loop 重構成 LINQ 的 <code>Sum()</code> 。</p>
<blockquote>
<p>實務上若搭配 List，使用 <code>foreach()</code> 的機率幾乎為 0，因為 LINQ 對 <code>IEnumerable</code> 的支援已經很完整，可以使用 FP 的方式使用 List，更加精簡，可讀性也更高</p>
</blockquote>
<p><strong>ShoppingCartService</strong></p>
<p><img src="/images/design-pattern/composite/composite007.svg" alt="composite007"></p>
<p><strong>ShoppingCartService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ShoppingCartLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ShoppingCartService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IPrice&gt; _carts = <span class="keyword">new</span> List&lt;IPrice&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddCart</span>(<span class="params">IPrice product</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            _carts.Add(product);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">CalculatePrice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _carts.Sum(product =&gt; product.GetPrice());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>15 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">CalculatePrice</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _carts.Sum(product =&gt; product.GetPrice());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將 for loop 重構成 LINQ 的 <code>Sum()</code> 。</p>
<h2 id="Summary">Summary</h2><hr>
<blockquote>
<p>Q：Proxy Pattern、Decorator Pattern 與 Composite Pattern 有何差異？</p>
</blockquote>
<p><strong>Proxy Pattern</strong><br><img src="/images/design-pattern/composite/composite014.svg" alt="composite014"></p>
<p><strong>Decorator Pattern</strong><br><img src="/images/design-pattern/composite/composite013.svg" alt="composite014"></p>
<p><strong>Composite Pattern</strong><br><img src="/images/design-pattern/composite/composite008.svg" alt="composite008"></p>
<p>以 class diagram 角度，Proxy Pattern、Decorator Pattern 與 Composite Pattern 的確非常類似。</p>
<blockquote>
<p>學 Design Pattern 不能以 class diagram 的角度去思考，而要以他要解決什麼問題來思考</p>
</blockquote>
<h3 id="Similarity">Similarity</h3><ul>
<li>都在解決 <code>繼承濫用</code>，將原本 <code>垂直結構</code> 變成 <code>水平結構</code></li>
<li>Interface 都不會改變</li>
</ul>
<h3 id="Difference">Difference</h3><ul>
<li>Proxy 目的在對 service 做 <code>控制存取</code></li>
<li>Decorator 目的在對 service <code>增加功能</code></li>
<li>Composite 目的在於對單一 model/DTO 與套餐組合 model/DTO <code>一視同仁</code></li>
</ul>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li><code>單一產品</code> 與 <code>套餐組合</code>，原本是完全不同的東西，但藉由實踐相同的 interface，在邏輯上視為相同的物件，因此可藉由 OOP 的 <code>多型</code> 加以操作，而不須在 client 做任何判斷，將來新增任何 <code>單一產品</code> 或 <code>套餐組合</code>，也不用修改 client，符合 <code>開放封閉原則</code> 的要求</li>
<li>計算 List 的總和可使用 LINQ 的 <code>Sum()</code>，可讀性更高也更精簡</li>
<li>大部分書籍資料都將 Composite Pattern 用來實作 tree 資料結構，因此很多初學者以為此 pattern 就是為了用來實作 tree，但 tree 並非 Composite Pattern 的必要條件，事實上只要同時需要處理 <code>單一資料</code> 與 <code>整體資料</code>，就適合使用 Composite Pattern，因此也稱為 Part-Whole Pattern，<code>讓單一資料與整體資料有一致操作方式</code>，這就是 Composite Pattern 的本質</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/CSharpComposite" target="_blank" rel="external">GitHub</a> 上找到</p>
]]></content>
    <summary type="html">
    <![CDATA[將物件與容器一視同仁操作]]>
    
    </summary>
    
      <category term="C#" scheme="http://oomusou.io/tags/C/"/>
    
      <category term="Design Pattern" scheme="http://oomusou.io/tags/Design-Pattern/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 Docker 安裝 Ubuntu ?]]></title>
    <link href="http://oomusou.io/docker/ubuntu/"/>
    <id>http://oomusou.io/docker/ubuntu/</id>
    <published>2018-04-16T13:23:43.000Z</published>
    <updated>2018-04-16T13:15:32.503Z</updated>
    <content type="html"><![CDATA[<p>以前在 macOS 安裝 Ubuntu 都要先安裝 Parallel Desktop，然後再將 Ubuntu 安裝在 Parallel Desktop 上，安裝了 Docker for Mac 後，只要下載 Ubuntu 的 Docker image，Ubuntu 就能以 container 形式跑在 Docker 上。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>Docker for Mac 17.20.0-ce-mac49 (21995)<br>Ubuntu 16.04.4 LTS</p>
<h2 id="搜尋_Ubuntu_Image">搜尋 Ubuntu Image</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker search ubuntu</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker search</code> 搜尋 Docker Hub 的 image。</p>
<p><img src="/images/docker/ubuntu/ubuntu000.png" alt="ubuntu000"></p>
<ol>
<li>使用 Docker 第一步就是使用 <code>docker search</code> 到 Docker Hub 搜尋 image 下載</li>
<li>找到 <code>ubuntu</code> image</li>
<li>7234 star</li>
<li>為 official image</li>
</ol>
<blockquote>
<p>下載 Docker image 時，盡量使用 official  image，而不要使用別人包過的 image，因為可能會有後門或木馬</p>
</blockquote>
<h2 id="下載並建立_Container">下載並建立 Container</h2><hr>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="command">run</span> <span class="comment">--name MyUbuntu -dt ubuntu</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>docker run</code> 由 image 建立 container，當 Docker 發現本機沒有 image，會自動從 Docker Hub 下載。</p>
<ul>
<li><code>--name</code> : 替 container 取一個人能夠識別的名字 <code>MyUbuntu</code> ( 若省略，Docker 將隨機命名 )</li>
<li><code>-d</code> : <code>d</code>etach，建立 container 後，就脫離目前 process</li>
<li><code>-t</code> : <code>t</code>erminal，預設執行 <code>/bin/bash</code> process，為了讓 container 啟動後不會立即停止</li>
<li><code>ubuntu</code> : Ubuntu 的官方 image 名稱</li>
</ul>
<blockquote>
<p>Docker container  重要觀念</p>
<p>One process per container</p>
<ul>
<li>一個 container 應該只有 process</li>
<li>若有多個 process，就應該有多個 container</li>
<li>process 執行完，container 則釋放停止執行</li>
</ul>
<p>當 process 執行完，container 會自動釋放，<code>ubuntu</code> image 預設並沒有執行任何 process，所以 <code>start</code> 完後會自動釋放，為了讓 container 不會執行完立即釋放，因此特別加上 <code>-t</code>，讓此 container 預設執行 <code>bash</code>，使的 container 不會釋放</p>
</blockquote>
<p><img src="/images/docker/ubuntu/ubuntu002.png" alt="ubuntu002"></p>
<ol>
<li>使用 <code>docker run</code> 建立 container 並執行 bash</li>
</ol>
<h2 id="觀察_Container">觀察 Container</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker ps</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ps</strong> : <code>p</code> resent <code>s</code>tate，使用 <code>docker ps</code> 顯示 <code>正在執行</code> 的 container。</li>
</ul>
<p><img src="/images/docker/ubuntu/ubuntu005.png" alt="ubuntu005"></p>
<ol>
<li>輸入 <code>docker ps</code></li>
<li><code>MyUbuntu</code> container 正在執行中</li>
</ol>
<h2 id="進入_Ubuntu">進入 Ubuntu</h2><hr>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -<span class="keyword">it</span> MyUbuntu bash</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker exec</code> 對已經執行中的 container 下指令。</p>
<ul>
<li><code>-i</code> :  <code>i</code>nteractive，可對 terminal 輸入資料</li>
<li><code>-t</code> : <code>t</code>erminal，可對 terminal 顯示資料</li>
<li><code>MyUbuntu</code> : Container 名稱</li>
<li><code>bash</code> : 對 container 下的指令</li>
</ul>
<p><img src="/images/docker/ubuntu/ubuntu007.png" alt="ubuntu007"></p>
<ol>
<li>輸入 <code>docker exec -it</code> 進入 container 的 terminal</li>
<li>輸入 <code>ll</code></li>
<li>顯示 Ubuntu 內的目錄結構</li>
</ol>
<blockquote>
<p>如此可證明 Ubuntu 已經正常啟動</p>
</blockquote>
<h2 id="離開_Ubuntu">離開 Ubuntu</h2><hr>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>exit</code> 離開 Ubuntu 的 terminal。</p>
<p><img src="/images/docker/ubuntu/ubuntu008.png" alt="ubuntu008"></p>
<h2 id="停止_Container">停止 Container</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker stop <span class="constant">MyUbuntu</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>docker stop</code> 停止 container。</p>
<p><img src="/images/docker/ubuntu/ubuntu010.png" alt="ubuntu010"></p>
<ol>
<li>輸入 <code>docker stop MyUbuntu</code> 停止 <code>MyUbuntu</code> container</li>
<li>輸入 <code>docker ps</code> 顯示目前執行中的 container</li>
</ol>
<blockquote>
<p>目前已經沒有執行中的 container，表示 Ubuntu 已經停止執行</p>
</blockquote>
<h2 id="啟動_Container">啟動 Container</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker start <span class="constant">MyUbuntu</span></span><br><span class="line"><span class="variable">$ </span>docker ps</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker start</code> 重新啟動已經在硬碟，但還沒有執行的 container。</p>
<p>使用 <code>docker ps</code> 顯示目前執行中的 container。</p>
<p><img src="/images/docker/ubuntu/ubuntu006.png" alt="ubuntu006"></p>
<ol>
<li>輸入 <code>docker start MyUbuntu</code> 啟動 <code>MyUbuntu</code> container</li>
<li>輸入 <code>docker ps</code> 顯示目前執行中的 container</li>
<li><code>MyUbuntu</code> container 執行中。</li>
</ol>
<h2 id="刪除_Container">刪除 Container</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker rm <span class="constant">MyUbuntu</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>docker rm</code> 刪除在硬碟中的 container。</p>
<p><img src="/images/docker/ubuntu/ubuntu011.png" alt="ubuntu011"></p>
<ol>
<li>輸入 <code>docker rm MyUbuntu</code> 刪除 <code>MyUbuntu</code> container，由於 container 正在執行中，無法刪除</li>
<li>輸入  <code>docker stop MyUbuntu</code> 停止 <code>MyUbuntu</code> container</li>
<li>再次輸入 <code>docker rm MyUbuntu</code> 刪除 <code>MyUbuntu</code> container，此次刪除成功</li>
<li>輸入 <code>docker ps -a</code> 顯示所有在硬碟的 container，確認已經沒有任何 container</li>
</ol>
<blockquote>
<p>要刪除 container 之前，必須先停止 container，才能加以刪除。</p>
</blockquote>
<h2 id="顯示所有_Image">顯示所有 Image</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker images</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker images</code> 顯示目前在硬碟所有的 image。</p>
<p><img src="/images/docker/ubuntu/ubuntu012.png" alt="ubuntu012"></p>
<ol>
<li>輸入 <code>docker images</code> 顯示目前在硬碟的所有 image</li>
<li>目前有 <code>ubuntu</code> image</li>
</ol>
<h2 id="刪除_Image">刪除 Image</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker rmi ubuntu</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker rmi</code> 刪除 image。</p>
<ul>
<li><code>rm</code> : 刪除</li>
<li><code>i</code> : <code>i</code>mage</li>
</ul>
<p><img src="/images/docker/ubuntu/ubuntu013.png" alt="ubuntu013"></p>
<ol>
<li>輸入 <code>docker rmi ubuntu</code> 刪除 <code>ubuntu</code> image</li>
<li>輸入 <code>docker images</code> 確認是否 image 已被刪除</li>
</ol>
<h2 id="Summary">Summary</h2><hr>
<p><img src="/images/docker/ubuntu/ubuntu014.svg" alt="ubuntu014"></p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>使用 Docker 快速建立 Ubuntu 測試環境</li>
<li>本文為 Docker 最基本的操作，是使用 Docker 一定要會的基本指令</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[使用 Docker 快速建立 Ubuntu 測試環境]]>
    
    </summary>
    
      <category term="Docker" scheme="http://oomusou.io/tags/Docker/"/>
    
      <category term="Ubuntu" scheme="http://oomusou.io/tags/Ubuntu/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何安裝 Docker for Mac ?]]></title>
    <link href="http://oomusou.io/docker/docker-for-mac/"/>
    <id>http://oomusou.io/docker/docker-for-mac/</id>
    <published>2018-04-16T12:23:43.000Z</published>
    <updated>2018-04-16T12:44:42.330Z</updated>
    <content type="html"><![CDATA[<p>由於 Docker 在本質上仍是個 Linux，只是多個 container 跑在同一個 Linux 上，因此若要將 Docker 跑在 macOS，仍然需要一個 VM 在背景跑 Linux。Docker for Mac 讓我們不用安裝其他 VM，就可以將 container 跑在 Docker 上。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>Homebrew 1.6.0<br>Docker for Mac 18.03.0.ce (23751)</p>
<h2 id="Prerequisite">Prerequisite</h2><hr>
<p>在 macOS 先安裝好 Homebrew。</p>
<h2 id="Docker_for_Mac">Docker for Mac</h2><hr>
<h3 id="安裝_Docker">安裝 Docker</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>update</span><br><span class="line">$ <span class="keyword">brew </span>cask install docker</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew cask 安裝 Docker。</p>
<p><img src="/images/docker/docker-for-mac/mac000.png" alt="mac000"></p>
<ol>
<li>輸入 <code>brew cask install docker</code> 安裝 Docker</li>
<li>Homebrew cask 從官網下載 <code>Docker.dmg</code></li>
<li>安裝 Docker</li>
<li>將 <code>Docker.app</code> 安裝在 <code>Applications</code> 目錄下</li>
</ol>
<h3 id="執行_Docker">執行 Docker</h3><p><img src="/images/docker/docker-for-mac/mac001.png" alt="mac001"></p>
<ol>
<li>在 <code>Applications</code> 顯示 <code>Docker</code></li>
</ol>
<p><img src="/images/docker/docker-for-mac/mac002.png" alt="mac002"></p>
<p>第一次執行會要求管理者權限，按 <code>OK</code> 後會要求輸入管理者密碼。</p>
<p><img src="/images/docker/docker-for-mac/mac003.png" alt="mac003"></p>
<p>Docker 啟動中，會在右上角顯示 Docker icon。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker -v</span><br></pre></td></tr></table></figure>
<p>等 Docker 啟動完畢，在 terminal 輸入 <code>docker -v</code>，若能正確顯示版本，表示 Docker 已經安裝成功。</p>
<p><img src="/images/docker/docker-for-mac/mac004.png" alt="mac004"></p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>安裝 Docker for Mac 之後，就可以安裝各種 image，並執行各種 container</li>
</ul>
<h2 id="Appendix">Appendix</h2><hr>
<h3 id="清除_Cache">清除 Cache</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>cask cleanup</span><br></pre></td></tr></table></figure>
<p>清除 Homebrew cask 的 cache。</p>
<blockquote>
<p>Homebrew cask 下載了 <code>Docker.dmg</code> 安裝 Docker，預設會下載到 <code>~/Library/Caches/Homebrew/Cask</code> 目錄下，必須下 <code>brew cask cleanup</code> 才會刪除 <code>Docker.dmg</code></p>
</blockquote>
<p><img src="/images/docker/docker-for-mac/mac005.png" alt="mac005"></p>
<ol>
<li>輸入 <code>brew cask cleanup</code> </li>
<li>刪除在 <code>~/Library/Caches/Homebrew/Cask</code> 目錄下的 <code>Docker.dmg</code></li>
</ol>
<h3 id="開機啟動_Docker">開機啟動 Docker</h3><p><img src="/images/docker/docker-for-mac/mac006.png" alt="mac006"></p>
<p><strong><em>Preferences -&gt; General</em></strong></p>
<ol>
<li>預設 Docker 安裝後，下次會 Mac 開機也會自動啟動 Docker，可視需求決定是否要自動啟動 Docker</li>
</ol>
<blockquote>
<p>Docker 雖然比 Vagrant 省電，但本質還是 VM，所以若沒用卻開著，還是會耗電，若是 desktop 可能無感，但若是 notebook 且在乎電池續航力，建議只有要使用時才啟動 Docker</p>
</blockquote>
<h3 id="移除_Docker_for_Mac">移除 Docker for Mac</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>cask uninstall docker</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew cask 移除 Docker。</p>
<blockquote>
<p>不必事先關閉 Docker</p>
</blockquote>
<p><img src="/images/docker/docker-for-mac/mac007.png" alt="mac007"></p>
<ol>
<li>輸入 <code>brew cask uninstall docker</code></li>
<li>刪除 Docker</li>
<li>刪除 <code>Applications/Docker.app</code></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[使用 Homebrew 即可簡單的安裝 Docker]]>
    
    </summary>
    
      <category term="Docker" scheme="http://oomusou.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 Closure 達成 Encapsulation ?]]></title>
    <link href="http://oomusou.io/fsharp/closure-encapsulation/"/>
    <id>http://oomusou.io/fsharp/closure-encapsulation/</id>
    <published>2018-04-15T12:23:43.000Z</published>
    <updated>2018-04-16T12:45:14.274Z</updated>
    <content type="html"><![CDATA[<p><code>封裝</code> 是 OOP 三個重要的特色之一，也由於 <code>封裝</code>，才導致了 <code>多型</code>，而 <code>繼承</code> 則是實現多型的手段 (<code>里氏替換原則</code>)。事實上 FP 也能完美實現 <code>封裝</code>，關鍵就在於 Closure。</p>
<p>我們分別來看看 TypeScript、ReasonML 與 F# 如何以 Clsoure 達成 <code>封裝</code>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>TypeScript 2.8<br>ReasonML 3.1.0<br>F# 4.1</p>
<h2 id="OOP_封裝">OOP 封裝</h2><hr>
<p>以 OOP 最經典的 Strategy Pattern 為例，我們將各種 strategy 封裝在 context 內，讓 client 與 strategy 解耦合。</p>
<h3 id="TypeScript">TypeScript</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="interface"><span class="keyword">interface</span> Strategy </span>&#123;</span><br><span class="line">  execute(x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Context &#123;</span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(private strategy: Strategy) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  request(x: <span class="built_in">number</span>, y:<span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.strategy.execute(x, y);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> context = <span class="keyword">new</span> Context(<span class="keyword">new</span> <span class="keyword">class</span> <span class="keyword">implements</span> Strategy &#123;</span><br><span class="line">  execute(x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = context.request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>第 1 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="interface"><span class="keyword">interface</span> Strategy </span>&#123;</span><br><span class="line">  execute(x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>訂出 strategy 的 class interface。</p>
<p>第 5 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Context &#123;</span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(private strategy: Strategy) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  request(x: <span class="built_in">number</span>, y:<span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.strategy.execute(x, y);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Context</code> class 負責將 strategy 封裝在 field，對於 client 來說只認得 <code>Context.request()</code>，將 client 與 strategy 解耦合。</p>
<p>14 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> context = <span class="keyword">new</span> Context(<span class="keyword">new</span> <span class="keyword">class</span> <span class="keyword">implements</span> Strategy &#123;</span><br><span class="line">  execute(x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Client 在建立 <code>Context</code> 物件時，順便將 strategy 傳入，由於只使用一次，可以使用 anonymous class。</p>
<p>20 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = context.request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>
<p>Client 實際執行的是 <code>Context.request()</code>，由於已經將 strategy object 封裝在 <code>Context</code> 的 field 內，因此 client 已經跟 strategy 解耦合。</p>
<h2 id="FP_封裝">FP 封裝</h2><hr>
<h3 id="TypeScript-1">TypeScript</h3><p>TypeScript 除了支援完整 OOP，也支援 FP。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="interface"><span class="keyword">interface</span> Strategy </span>&#123;</span><br><span class="line">  (x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> context = (strategy: Strategy) =&gt; (x, y) =&gt; strategy(x, y);</span><br><span class="line"><span class="keyword">let</span> request = context((x, y) =&gt; x + y);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>第 1 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="interface"><span class="keyword">interface</span> Strategy </span>&#123;</span><br><span class="line">  (x: <span class="built_in">number</span>, y: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將 strategy 的 interface 由 class interface 改成 function interface。</p>
<p>第 5 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> context = (strategy: Strategy) =&gt; (x, y) =&gt; strategy(x, y);</span><br></pre></td></tr></table></figure>
<p>將 <code>Context</code> class 退化成 <code>context()</code> function，class contructor 則退化成 function parameter，strategy function 依然要遵守 function interface。</p>
<p>回傳為新的 function，此時 strategy function 將以 Closure 形式保留在新的 function 內，也因為 Closure，使得 strategy function 被封裝在新的 function 內。</p>
<p>第 6 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> request = context((x, y) =&gt; x + y);</span><br></pre></td></tr></table></figure>
<p>由 <code>context()</code> 傳入 strategy function，以 Arrow Function 形式表達，而 request 為一 function，此時 strategy function 已經被封裝在 <code>request()</code> 內。</p>
<p>第 9 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>
<p>Client 實際執行的是 <code>request()</code>，由於已經將 strategy function 封裝在 <code>request()</code>，因此 client 已經跟 strategy function 解耦合。</p>
<h3 id="ReasonML">ReasonML</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> context = (strategy, x, y) =&gt; strategy(x, y);</span><br><span class="line"><span class="keyword">let</span> request = context((x, y) =&gt;  x + y);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">Js.log(result);</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>第 1 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> context = (strategy, x, y) =&gt; strategy(x, y);</span><br></pre></td></tr></table></figure>
<p>因為 ReasonML 支援 Partial Application Function，因此可以將 <code>context()</code> 與 <code>request()</code> 合一，若只提供 strategy parameter，回傳的就是 strategy function。</p>
<p>第 2 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> request = context((x, y) =&gt;  x + y);</span><br></pre></td></tr></table></figure>
<p>由 <code>context()</code> function 傳入 strategy function。</p>
<p>第 4 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = request(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">Js.log(result);</span><br></pre></td></tr></table></figure>
<p>Client 實際執行的是 <code>request()</code>，由於已經將 strategy function 封裝在 <code>request()</code>，因此 client 已經跟 strategy function 解耦合。</p>
<blockquote>
<p>ReasonML 支援了目前 JavaScript 與 TypeScript 尚未支援的  Partial Application Function，也因為有 Type Inference，所以也不需要 interface，因此 ReasonML 寫起來比 TypeScript 精簡</p>
</blockquote>
<h3 id="FSharp">FSharp</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> context strategy x y = strategy x y</span><br><span class="line"><span class="keyword">let</span> request = context (<span class="keyword">fun</span> x y -&gt;  x + y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = request <span class="number">1</span> <span class="number">1</span></span><br><span class="line">printf <span class="string">"%d"</span> result</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>F# 寫起來與 ReasonML 已經非常類似，就不再詳細討論，大抵就是 F# 不用 <code>()</code> 與 <code>;</code>，且 Lambda 使用 <code>fun</code>，但 F# 支援 Partial Function Application 與 Type Inference 則與 ReasonML 一致。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>OOP 使用 constructor + field 將變化加以封裝；而 FP 亦可使用 Higher Order Function + Closure 將變化加以封裝</li>
<li>若以 FP 方式思考，無論使用 TypeScript、ReasonML 或 F#，寫法都已經相當接近，程式碼也比 OOP 精簡</li>
<li>ReasonML 與 F# 支援 Partial Application Function 與 Type Inference，程式碼又會比 TypeScript 更加精簡</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[封裝也有了新的方式]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
      <category term="ReasonML" scheme="http://oomusou.io/tags/ReasonML/"/>
    
      <category term="TypeScript" scheme="http://oomusou.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何安裝 Docker for Windows ?]]></title>
    <link href="http://oomusou.io/docker/docker-for-windows/"/>
    <id>http://oomusou.io/docker/docker-for-windows/</id>
    <published>2018-04-14T12:23:43.000Z</published>
    <updated>2018-04-14T12:30:35.082Z</updated>
    <content type="html"><![CDATA[<p>由於 Docker 在本質上仍是個 Linux，只是多個 container 跑在同一個 Linux 上，因此若要將 Docker 跑在 Windows，仍然需要一個 VM 在背景跑 Linux。Docker for Windws 內建支援 Windows 的 Hyper-V，只會在 Hyper-V 內跑一個極小的 Linux，如此其他 container 就能跑在 Docker 上。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>Parallel Desktop 13 for Mac Pro Edition 13.3.0 (43321)<br>Windows 10 Pro 1709 16299.371<br>Docker for Windows 18.03.0.ce (0520e24)</p>
<h2 id="Docker_for_Windows">Docker for Windows</h2><hr>
<p>要能在 Windows 執行 Docker，首先必須安裝 Docker for Windows。</p>
<h3 id="下載_Docker_for_Windows">下載 Docker for Windows</h3><p><img src="/images/docker/docker-for-windows/win000.png" alt="win000"></p>
<ol>
<li>到 <a href="https://store.docker.com/editions/community/docker-ce-desktop-windows" target="_blank" rel="external">Docker 官網</a></li>
<li>按 <code>Get Docker</code> 下載 Docker</li>
</ol>
<h3 id="執行_Installer">執行 Installer</h3><p><img src="/images/docker/docker-for-windows/win002.png" alt="win002"></p>
<ol>
<li>預設將 <code>Docker for Windows Installer</code> 下載到 <code>Downloads</code> 目錄</li>
<li>執行 <code>Docker for Windows Installer</code></li>
</ol>
<h3 id="Configuration">Configuration</h3><p><img src="/images/docker/docker-for-windows/win003.png" alt="win003"></p>
<ol>
<li>可選擇是否在 desktop 增加 shortcut</li>
<li>不要勾選 <code>Use Windows containers instead of Linux containers</code></li>
</ol>
<blockquote>
<p>Windows container 與 Linux container 正在整合中，同時只能 <code>單獨使用</code> Windows container 或 Linux container，目前只有 Edge 版可以 <code>同時使用</code> Windows container 與 Linux container</p>
</blockquote>
<p><img src="/images/docker/docker-for-windows/win004.png" alt="win004"></p>
<p>安裝 Docker for Windows 中。</p>
<p><img src="/images/docker/docker-for-windows/win005.png" alt="win005"></p>
<ol>
<li>按 <code>Close and log out</code>，即將登出 Windows 並重新登入</li>
</ol>
<h2 id="Hyper-V">Hyper-V</h2><p><img src="/images/docker/docker-for-windows/win006.png" alt="win006"></p>
<ol>
<li>重新登入後，Docker 發現 Hyper-V 沒有啟動而無法執行</li>
<li>按 <code>Ok</code> 後 Windows 將重新啟動並自動安裝 <code>Hyper-V</code></li>
</ol>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker -v</span><br></pre></td></tr></table></figure>
<p>預設 Windows 10 每次啟動都會執行 Docker，在 Command Prompt 輸入 <code>docker -v</code>，若出現 Docker 版本編號，則表示 Docker 安裝成功。</p>
<p><img src="/images/docker/docker-for-windows/win007.png" alt="win007"></p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>安裝 Docker for Windows 之後，就可以安裝各種 image，並執行各種 container</li>
</ul>
<h2 id="Appendix">Appendix</h2><hr>
<p>由於 Docker for Windows 會使用 Hyper-V，若在 Parallel Desktop 中的 Windows 10 執行 Docker，等於是在 VM 中執行 VM，必須在 Parallel Desktop 做額外的設定：</p>
<p><img src="/images/docker/docker-for-windows/win001.png" alt="win001"></p>
<ol>
<li>選擇 <code>Hardware</code></li>
<li>選擇 <code>CPU &amp; Memory</code></li>
<li>將 <code>Enable nested virtualization</code> 打勾</li>
</ol>
<blockquote>
<p>實務上不建議這樣使用 Docker，由於兩層 VM，效率並不好，建議直接使用 Docker for Mac</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[Docker 在 Windows 的安裝越來越簡單了]]>
    
    </summary>
    
      <category term="Docker" scheme="http://oomusou.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 F# 實現 Proxy Pattern？]]></title>
    <link href="http://oomusou.io/fsharp/proxy/"/>
    <id>http://oomusou.io/fsharp/proxy/</id>
    <published>2018-04-13T12:23:43.000Z</published>
    <updated>2018-04-14T12:28:55.598Z</updated>
    <content type="html"><![CDATA[<p>Proxy Pattern 是 OOP 中著名的 Design Pattern，尤其可在不改變 interface 的前提下，就能控制該物件的使用，F# 既然是 Function First Language，就讓我們以 function 的角度重新實現 Proxy Pattern。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="User_Story">User Story</h2><hr>
<p>假設你在處理訂單，只有會員才能享受 <code>全館八折</code>，其他人都只能原價購買。</p>
<ul>
<li>目前已經有 <code>MemberService.isMember()</code> 判斷是否為會員</li>
<li>目前已經有 <code>OrderService.getPrice()</code> 可根據折購計算售價</li>
<li>在 <code>MemberService.isMember()</code> 與 <code>OrderService.getPrice()</code> 不修改的前提下 (<code>開放封閉原則</code>)，計算出售價</li>
</ul>
<h2 id="Task">Task</h2><hr>
<p>直接使用 FP 的思維完成需求。</p>
<h2 id="Definition">Definition</h2><hr>
<blockquote>
<p>Proxy Pattern</p>
<p>在不改變原有 interface 的前提下，控制 service 的使用</p>
</blockquote>
<p><img src="/images/fsharp/proxy/proxy000.svg" alt="ecorator00"></p>
<p>首先思考 Proxy Pattern 的本質：</p>
<ol>
<li>Proxy 與 RealSubject 之間的 interface 必須相同</li>
<li>Client 藉由 Proxy 控制 RealSubject 的使用</li>
</ol>
<p>只要能達到這兩個目標，就算完成了 Proxy Pattern。</p>
<h2 id="OOP_思考方式">OOP 思考方式</h2><hr>
<ul>
<li>為了讓 Proxy 與 RealSubject 的 interface 要相同，所以必須訂出共同的 interface</li>
<li>Proxy 必須以 state 記住 RealSubject，client 才能透過 Proxy 使用 RealSubject</li>
<li>Proxy 可以加上邏輯，控制 RealSubject 的使用</li>
</ul>
<h2 id="FP_思考方式">FP 思考方式</h2><hr>
<ul>
<li>Proxy 與 RealSubject 都是 function，不用事先定義 interface，反正只要 interface 不同，在 <code>if … else</code>、 <code>Pattern Matching</code> 或 <code>try catch</code> 一定會錯</li>
<li>Proxy 與 RealSubject 都是 function，既然 interface 都相同，由 RealSubject 切換到 Proxy 就不用修改程式碼</li>
<li>Proxy function 可加上邏輯，控制 RealSubject function 的使用</li>
</ul>
<h2 id="Implementation">Implementation</h2><hr>
<p><strong>MemberService.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> MemberLibrary</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> MemberService =</span><br><span class="line">    <span class="keyword">let</span> isMember account = account = <span class="string">"Sam"</span></span><br></pre></td></tr></table></figure>
<p><code>isMember()</code> 判斷是否為 <code>會員</code>。</p>
<blockquote>
<p>實務上判斷 <code>是否為會員</code> 與資料庫有關，本文主要是談 Proxy Pattern，就只簡單的判斷會員是否為 <code>Sam</code> 即可。</p>
</blockquote>
<p><strong>OrderService.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> OrderLibrary</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> OrderService =</span><br><span class="line">    <span class="keyword">let</span> getPrice discount price = price * discount * <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>計算 <code>全館八折</code>，之所以加上 <code>* 1.0</code>，是為了讓 Type Inference 推導出 <code>discount</code> 與 <code>price</code> 的型別為 <code>float</code>。</p>
<blockquote>
<p>當使用 function pipeline 時，最後一個參數可以自動被 pipeline，所以設計 function parameter 時，將要使用 pipeline 的 value 放在最後一個 parameter，才能發揮 pipeline 的優勢</p>
</blockquote>
<p><strong>Program.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> MemberLibrary</span><br><span class="line"><span class="keyword">open</span> OrderLibrary</span><br><span class="line"><span class="keyword">open</span> System</span><br><span class="line"></span><br><span class="line"><span class="annotation">[&lt;EntryPoint&gt;]</span></span><br><span class="line"><span class="keyword">let</span> main argv =</span><br><span class="line">    <span class="keyword">let</span> account = <span class="string">"Sam"</span></span><br><span class="line">    <span class="keyword">let</span> originalPrice = <span class="number">800.0</span></span><br><span class="line">    <span class="keyword">let</span> discount = <span class="number">0.8</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> isMember = MemberService.isMember account</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> orderProxy =</span><br><span class="line">        <span class="keyword">match</span> isMember <span class="keyword">with</span></span><br><span class="line">        | <span class="keyword">true</span>  -&gt; OrderService.getPrice</span><br><span class="line">        | <span class="keyword">false</span> -&gt; <span class="keyword">fun</span> _ price -&gt; price </span><br><span class="line">    </span><br><span class="line">    originalPrice</span><br><span class="line">    |&gt; orderProxy discount</span><br><span class="line">    |&gt; printf <span class="string">"Real price : %0.0f"</span>        </span><br><span class="line"></span><br><span class="line">    <span class="number">0</span> <span class="comment">// return an integer exit code</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Real price : 640</span></span><br></pre></td></tr></table></figure>
<p>11 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isMember = MemberService.isMember account</span><br></pre></td></tr></table></figure>
<p>由於會由 <code>MemberService.isMember()</code> 判斷是否為會員，先判斷並將結果 binding 到 <code>isMember</code>。</p>
<p>13 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> orderProxy =</span><br><span class="line">    <span class="keyword">match</span> isMember <span class="keyword">with</span></span><br><span class="line">    | <span class="keyword">true</span>  -&gt; OrderService.getPrice</span><br><span class="line">    | <span class="keyword">false</span> -&gt; <span class="keyword">fun</span> _ price -&gt; price</span><br></pre></td></tr></table></figure>
<p>將 <code>OrderProxy</code> class 退化成 <code>orderProxy()</code> function，其 interface 仍然為 <code>float -&gt; float -&gt; float</code>，Type Inference 會自動推導，若有違反，Pattern Matching 就會報錯。</p>
<p><code>orderProxy()</code> 本質為 function，由於 closure 機制，可以自然使用到 function 外面的 <code>isMember</code>，因此不必使用 parameter 方式傳入。</p>
<p>Pattern Matching 根據  <code>isMember</code> 結果回傳 <code>OrderService.getPrice()</code>，或者全新的 Lambda function。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| <span class="keyword">false</span> -&gt; <span class="keyword">fun</span> _ price -&gt; price</span><br></pre></td></tr></table></figure>
<p>由於要 return 的 Lambda function 並沒有使用到 <code>discount</code> 計算，使用 <code>_</code> 代表即可。</p>
<p>16 行</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">originalPrice</span><br><span class="line">|&gt; orderProxy discount</span><br><span class="line">|&gt; printf <span class="string">"Real price : %0.0f"</span></span><br></pre></td></tr></table></figure>
<p>將 <code>originalPrice</code> 傳給 <code>orderProxy()</code> 計算，這是個已經考慮 <code>是否為會員</code> 的 <code>orderService()</code>，最後再傳給  <code>printf()</code> 顯示。</p>
<h2 id="Summary">Summary</h2><hr>
<p>回想 Proxy Pattern 的本質：</p>
<ol>
<li>Proxy 與 RealSubject 之間的 interface 必須相同</li>
<li>Client 藉由 Proxy 控制 RealSubject 的使用</li>
</ol>
<p>雖然沒有特別定義 interface，但 <code>orderProxy()</code> 與 <code>OrderService.getPrice()</code> 的 signature 都是 <code>float -&gt; float -&gt; float</code>，若 function 的 signature 不同，在 Pattern Matching 就會編譯錯誤，與原本 Proxy Pattern 定義 interface 的本質相同。</p>
<p>FP 則藉由 Proxy Function 控制 RealSubject function 的使用，與原本 Proxy Pattern 藉由 Proxy 控制 RealSubject 使用的本質相同。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>Proxy Pattern 本質就是 delegation，但 object 的 delegation 沒 function 簡單直覺，所以才需要搭配 interface；但若純 function，連 interface 都不需要，而且也能享受 strong type 的編譯檢查</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/FSharpCore2OrderProxy" target="_blank" rel="external">GitHub</a> 上找到</p>
]]></content>
    <summary type="html">
    <![CDATA[以 FP 重新思考 Proxy Pattern]]>
    
    </summary>
    
      <category term="Design Pattern" scheme="http://oomusou.io/tags/Design-Pattern/"/>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 C# 實現 Proxy Pattern ?]]></title>
    <link href="http://oomusou.io/design-pattern/proxy/"/>
    <id>http://oomusou.io/design-pattern/proxy/</id>
    <published>2018-04-12T12:23:43.000Z</published>
    <updated>2018-04-19T02:11:07.516Z</updated>
    <content type="html"><![CDATA[<p>Proxy Pattern 是 OOP 中著名的 Design Pattern，尤其可在不改變 interface 的前提下，就能控制該物件的使用，隨著 FP 逐漸受到重視， Proxy Pattern 在實作上也有了新的面貌。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>C# 7.2</p>
<h2 id="User_Story_1">User Story 1</h2><hr>
<p>假設你在處理訂單，為了慶祝週年慶，<code>全館八折</code>。</p>
<p><strong>Task</strong><br>將 <code>OrderService</code> 包在 <code>OrderLibrary</code> assembly 內。</p>
<p><strong>Architecture</strong><br><img src="/images/design-pattern/proxy/proxy004.svg" alt="proxy004"></p>
<p><strong>Implementation</strong><br><strong>Client</strong></p>
<p><img src="/images/design-pattern/proxy/proxy005.svg" alt="proxy004"></p>
<p><strong>Program.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> OrderLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            PriceInterface orderService = <span class="keyword">new</span> OrderService();</span><br><span class="line">            <span class="keyword">var</span> realPrice = orderService.GetPrice(<span class="number">0.8</span>, <span class="number">800</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">"Real price : &#123;0&#125;"</span>, realPrice);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>與一般使用 service 寫法相同，建立 <code>OrderService</code> 物件，並執行 <code>getPrice()</code> 計算 <code>全館八折</code>。</p>
<p><strong>PriceInterface</strong></p>
<p><img src="/images/design-pattern/proxy/proxy006.svg" alt="proxy004"></p>
<p><strong>PriceInterface.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">OrderLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">PriceInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>PriceInterface</code> 定義 <code>OrderService</code> 的 interface，只有 <code>GetPrice()</code> 一個 method。</p>
<p><strong>OrderService</strong><br><img src="/images/design-pattern/proxy/proxy007.svg" alt="proxy007"></p>
<p><strong>OrderService.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">OrderLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderService</span> : <span class="title">PriceInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> discount * price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>OrderService</code> 實踐 <code>PriceInterface</code> 的 <code>GetPrice()</code>，計算 <code>全館八折</code>。</p>
<blockquote>
<p>目前 <code>PriceInterface</code> 與 <code>OrderService</code> 都包在 <code>OrderLibrary</code> assembly 內，與 <code>Client</code> 的 <code>ConsoleApp</code> 是不同 assembly。</p>
</blockquote>
<h2 id="User_Story_2">User Story 2</h2><hr>
<p>週年慶過後，只有 <code>會員</code> 才享有 <code>全館八折</code>，一般消費者維持原價。</p>
<p><strong>Task</strong></p>
<ul>
<li>由於 <code>開放封閉原則</code>， <code>OrderLibrary</code> 不再修改與編譯</li>
<li>在相同的 <code>PriceInterface</code> 下，要使 <code>Client</code> 的修改程式碼降到最低</li>
</ul>
<h2 id="Inheritance">Inheritance</h2><p><strong>Architecture</strong></p>
<p><img src="/images/design-pattern/proxy/proxy002.svg" alt="proxy002"></p>
<ul>
<li><strong>Client</strong>：<code>OrderService</code> 的 user，實務上可能是 component 或 controller</li>
<li><strong>PriceInterface</strong>：定義 <code>OrderService</code> 的 interface</li>
<li><strong>OrderService</strong>：實現 <code>全館八折</code></li>
<li><strong>MemberOrderService</strong>：根據 <code>MemberService</code> 判斷 <code>是否為會員</code>，並且因為 code reuse 繼承 <code>OrderService</code></li>
<li><strong>MemberService</strong>：判斷 <code>是否為會員</code></li>
</ul>
<p><strong>Implementation</strong></p>
<p><strong>MemberService</strong></p>
<p><img src="/images/design-pattern/proxy/proxy012.svg" alt="proxy012"></p>
<p><strong>MemberService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">MemberLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MemberService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMember</span>(<span class="params"><span class="keyword">string</span> account</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> account == <span class="string">"Sam"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為要判斷是否為 <code>會員</code>，新增 <code>MemberService</code>。</p>
<blockquote>
<p>實務上判斷 <code>是否為會員</code> 與資料庫有關，本文主要是談 Proxy Pattern，就只簡單的判斷會員是否為 <code>Sam</code> 即可。</p>
</blockquote>
<p><strong>MemberOrderService</strong></p>
<p><img src="/images/design-pattern/proxy/proxy013.svg" alt="proxy013"></p>
<p><strong>MemberOrderService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> MemberLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">OrderLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MemberOrderService</span> : <span class="title">OrderService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> MemberService _memberService = <span class="keyword">new</span> MemberService();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _memberService.IsMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">                   <span class="keyword">base</span>.GetPrice(price, discount) : </span><br><span class="line">                   price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第 5 行<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MemberOrderService</span> : <span class="title">OrderService</span></span><br></pre></td></tr></table></figure></p>
<p>由於只是多了 <code>是否為會員</code> 判斷，<code>全館八折</code> 的邏輯還是一樣，因此最直覺的寫法就是直接繼承 <code>OrderService</code> 在加以 <code>override</code>。</p>
<p>第 7 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> MemberService _memberService = <span class="keyword">new</span> MemberService();</span><br></pre></td></tr></table></figure>
<p>由於需使用 <code>MemberService</code> 判斷 <code>是否為會員</code>，因此宣告 <code>MemberService</code> 為 private field。</p>
<blockquote>
<p>實務上不應該直接 <code>new</code> service，而應該使用 DI 注入解耦合，因為本文主是談 Proxy Pattern，因此就偷懶直接 <code>new</code> 了。</p>
</blockquote>
<p>11 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> _memberService.IsMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">       <span class="keyword">base</span>.GetPrice(price, discount) : </span><br><span class="line">       price;</span><br></pre></td></tr></table></figure>
<p>由於 <code>MemberOrderService</code> 繼承 <code>OrderService</code>，因此使用 <code>base.GetPrice()</code> 呼叫父類別 <code>OrderService</code> 的 <code>GetPrice()</code>。</p>
<p><strong>OrderService</strong></p>
<p><img src="/images/design-pattern/proxy/proxy014.svg" alt="proxy014"></p>
<p><strong>OrderService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">OrderLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderService</span> : <span class="title">PriceInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> discount * price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 因為 <code>MemberOrderService</code> 要 override <code>GetPrice()</code>，所以在 <code>OrderService</code> 必須宣告成 <code>virtual</code>。</p>
<blockquote>
<p>Q：使用 <code>繼承</code> 有什麼問題？</p>
</blockquote>
<ol>
<li><code>OrderService.GetPrice()</code> 必須改成 <code>virtual</code>，<code>OrderLibrary</code> 必須修改與重新編譯，違反 <code>OrderLibrary 不再修改與編譯</code> 的需求，也違反 <code>開放封閉原則</code></li>
<li><code>MemberOrderService</code> 必須加在 <code>OrderLibrary</code> assembly，違反 <code>OrderLibrary 不再修改與編譯</code> 的需求，也違反 <code>開放封閉原則</code></li>
<li><code>繼承</code> 就該符合 <code>里氏替換原則</code>，也就是無論怎麼繼承， <code>GetPrice()</code> 都該只是計算 price，但 <code>MemberOrderService.GetPrice()</code> 卻還去判斷 <code>IsMember()</code>，這已經超出 <code>GetPrice()</code> 的職責，也就是違反 <code>單一職責原則</code></li>
<li><code>MemberOrderService</code> 完全以 code reuse 的角度去繼承 <code>OrderService</code>，而不是以 <code>多型</code> 的角度去繼承 <code>OrderService</code>，這也違反 <code>里氏替換原則</code></li>
<li><code>MemberOrderService</code> 與 <code>OrderService</code> 強耦合，將來在  <code>OrderService</code> 新增任何 field 與 method，都會污染到 <code>MemberOrderService</code>，違反 <code>介面隔離原則</code></li>
</ol>
<blockquote>
<p><code>繼承</code> 不是不能用，若真的沒有駕馭 <code>繼承</code> 的功力，建議就遵循 <code>里氏替換原則</code></p>
</blockquote>
<h2 id="Proxy_Pattern">Proxy Pattern</h2><hr>
<p><strong>Definition</strong></p>
<blockquote>
<p>Proxy Pattern</p>
<p>在不改變原有 interface 的前提下，控制 service 的使用</p>
</blockquote>
<p><img src="/images/design-pattern/proxy/proxy015.svg" alt="proxy015"></p>
<ul>
<li><strong>Client</strong>：<code>Proxy</code> 的 user，實務上可能是 component 或 controller</li>
<li><strong>Subject</strong>：定義 <code>Proxy</code> 與 <code>RealSubject</code> 的共用 interface</li>
<li><strong>Proxy</strong> : <code>RealSubject</code> 的替身，<code>Client</code> 實際只接觸 <code>Proxy</code>， 再由 <code>Proxy</code> 呼叫 <code>RealSubject</code></li>
<li><strong>RealSubject</strong>：實際功能的物件</li>
</ul>
<p><strong>適用時機</strong></p>
<ul>
<li>原有 interface 不能變動而想控制 service 使用</li>
<li>原來的 class 在不同 assembly，無法修改 code 卻想控制 service 使用</li>
<li>原本使用繼承而造成強耦合</li>
</ul>
<p><strong>優點</strong></p>
<ul>
<li>Interface 沒有變動，因此 client 程式不用修改 (如 .NET Core 的 Type Forwarding 設計)</li>
</ul>
<blockquote>
<p>在 GoF 的 Proxy Pattern，有提到四種 proxy，分別為 Remote Proxy、Virtual Proxy、Protection Proxy、Smart Reference，本文只針對最常用的 Protection Proxy 討論</p>
</blockquote>
<p><strong>Architecture</strong><br><img src="/images/design-pattern/proxy/proxy000.svg" alt="proxy000"></p>
<ul>
<li><strong>Client</strong>：<code>OrderProxy</code> 的 user，實務上可能是 component 或 controller</li>
<li><strong>PriceInterface</strong>：定義 <code>OrderProxy</code> 與 <code>OrderService</code> 的共用 interface，相當於 <code>Subject</code></li>
<li><strong>OrderProxy</strong>：控制 <code>OrderService</code> 的使用，相當於 <code>Proxy</code></li>
<li><strong>OrderService</strong>：實際計算 <code>全館八折</code>，相當於 <code>RealSubject</code></li>
<li><strong>MemberService</strong>：判斷是否為會員，為 <code>OrderService</code> 所依賴的物件</li>
</ul>
<p><strong>Implementation</strong></p>
<p><strong>OrderProxy</strong></p>
<p><img src="/images/design-pattern/proxy/proxy003.svg" alt="proxy003"></p>
<p><strong>OrderProxy.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> MemberLibrary;</span><br><span class="line"><span class="keyword">using</span> OrderLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderProxy</span> : <span class="title">PriceInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> PriceInterface _orderService = <span class="keyword">new</span> OrderService();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> MemberService _memberService = <span class="keyword">new</span> MemberService();</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _memberService.IsMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">                   _orderService.GetPrice(discount, price) : </span><br><span class="line">                   price;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第 6 行<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrderProxy</span> : <span class="title">PriceInterface</span></span><br></pre></td></tr></table></figure></p>
<p>為了要達成 <code>使 Client 的修改程式碼降到最低</code> 的要求，<code>OrderProxy</code> 也繼續使用 <code>PriceInterface</code>。</p>
<p>第 8 行<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> PriceInterface _orderService = <span class="keyword">new</span> OrderService();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> MemberService _memberService = <span class="keyword">new</span> MemberService();</span><br></pre></td></tr></table></figure></p>
<p>由於 <code>OrderProxy</code> 有兩個相依的 service：<code>OrderService</code> 與  <code>MemberService</code>，因此宣告為 private field 儲存。</p>
<blockquote>
<p>實務上不應該直接 <code>new</code> service，而應該使用 DI 注入解耦合，因為本文主是談 Proxy Pattern，因此就偷懶直接 <code>new</code> 了。</p>
</blockquote>
<p>11 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> price, <span class="keyword">double</span> discount</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _memberService.IsMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">           _orderService.GetPrice(price, discount) : </span><br><span class="line">           price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先判斷是否為會員，在執行 <code>OrderService.GetPrice()</code>。</p>
<p>重點在於在呼叫 service 的之前與之後，我們都可以加上自己的邏輯，而不是直接呼叫 service，這就是 proxy 本質。</p>
<p><strong>Client</strong><br><img src="/images/design-pattern/proxy/proxy001.svg" alt="proxy001"></p>
<p><strong>Program.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> OrderLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            PriceInterface orderProxy = <span class="keyword">new</span> OrderProxy();</span><br><span class="line">            <span class="keyword">var</span> realPrice = orderProxy.GetPrice(<span class="number">0.8</span>, <span class="number">800</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">"Real price : &#123;0&#125;"</span>, realPrice);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>10 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PriceInterface orderProxy = <span class="keyword">new</span> OrderProxy();</span><br></pre></td></tr></table></figure>
<p>由 <code>OrderService</code> 改成 <code>OrderProxy</code>，再透過 Refactoring 的 <code>Rename</code> 將 <code>orderService</code> 重構成 <code>orderProxy</code>。</p>
<p>其他都不用改，達成 <code>使 Client 的修改程式碼降到最低</code> 的要求。</p>
<blockquote>
<p>Q：<code>OrderProxy.GetPrice()</code> 與 <code>MemberOrderService.GetPrice()</code> 的程式碼差異不大，為什麼寫在 proxy 就可以，寫在 <code>繼承</code> 就不行？</p>
</blockquote>
<p>就功能而言，Proxy 與 <code>繼承</code> 都能達到需求，但語意不一樣：</p>
<ul>
<li>Proxy 目的就是 <code>控制 service 的使用</code>，所以加上 <code>IsMember()</code> 判斷就天經地義，這就是它的職責</li>
<li><code>OrderProxy</code> 並沒有使用 <code>繼承</code>，因此不受 <code>里式替換原則</code> 約束，interface 只要遵循 <code>介面隔離原則</code> 即可</li>
</ul>
<h2 id="Func">Func<t></t></h2><hr>
<p>雖然先定義好 <code>PriceInterface</code>，讓 <code>OrderService</code> 與 <code>OrderProxy</code> 共用 interface 的理念很好，但 …</p>
<ul>
<li>只有 <code>GetPrice()</code> 一個 method，真的需要開 interface 嗎？</li>
<li>真的有必要特別實作 <code>OrderProxy</code> 嗎？</li>
</ul>
<p><strong>Architecture</strong></p>
<p><img src="/images/design-pattern/proxy/proxy008.svg" alt="proxy008"></p>
<p><strong>Implementation</strong></p>
<p><strong>OrderService</strong></p>
<p><img src="/images/design-pattern/proxy/proxy009.svg" alt="proxy009"></p>
<p><strong>OrderService.cs</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">OrderLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">OrderService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">GetPrice</span>(<span class="params"><span class="keyword">double</span> discount, <span class="keyword">double</span> price</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> discount * price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由於 <code>OrderService</code> 都沒用到 field (state)， 是 pure function，因此可以將 <code>GetPrice()</code> 與 <code>OrderService</code> 全部改成 static。</p>
<p><strong>MemberService</strong><br><img src="/images/design-pattern/proxy/proxy010.svg" alt="proxy010"></p>
<p><strong>MemberService.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">MemberLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">MemberService</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsMember</span>(<span class="params"><span class="keyword">string</span> account</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> account == <span class="string">"Sam"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由於 <code>MemberService</code>  也沒用到 field (state)，也是 pure function，因此將 <code>IsMember()</code> 與 <code>MemberService</code> 全部改成 static。</p>
<p><strong>Client</strong></p>
<p><img src="/images/design-pattern/proxy/proxy011.svg" alt="proxy011"></p>
<p><strong>Program.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> MemberLibrary;</span><br><span class="line"><span class="keyword">using</span> OrderLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt; OrderProxy(Predicate&lt;<span class="keyword">string</span>&gt; isMember) =&gt;</span><br><span class="line">                isMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">                (Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt;) OrderService.GetPrice : </span><br><span class="line">                (discount, price) =&gt; price;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> realPrice = OrderProxy(MemberService.IsMember)(<span class="number">0.8</span>, <span class="number">800</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">"Real price : &#123;0&#125;"</span>, realPrice);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>11 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt; OrderProxy(Predicate&lt;<span class="keyword">string</span>&gt; isMember) =&gt;</span><br><span class="line">    isMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">    (Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt;) OrderService.GetPrice : </span><br><span class="line">    (discount, price) =&gt; price;</span><br></pre></td></tr></table></figure>
<p>將 <code>OrderProxy</code> 由 class 退化成 function，但 signature 仍然是 <code>Func&lt;double, double, double&gt;</code>，與原本的 <code>PriceInterface</code> 的 signature 一樣。</p>
<p>在 <code>OrderProxy</code> class 的 dependency，我們使用 DI 解決 <code>依賴反轉原則</code> 要求，但 FP 該如何做呢 ?</p>
<p>其實很簡單，function 就是 dependency，將 function 當參數傳入就好，也就是把 <code>orderProxy()</code> 當成 Higher Order Function，再將 <code>MemberService.IsMember()</code> 當成 predicate function 傳入 <code>orderProxy()</code> 即可。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt;) OrderService.GetPrice :</span><br></pre></td></tr></table></figure>
<p>需要 <code>Func&lt;double, double, double&gt;</code> 轉型是因為 C# Type Inference 需求，所以一定得加。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(discount, price) =&gt; price;</span><br></pre></td></tr></table></figure>
<p>由於 signature 要求為 <code>Func&lt;double, double, double&gt;</code>，所以 Lambda 的 input 一定要兩個參數，儘管只使用到 <code>price</code>。</p>
<blockquote>
<p>由此可發現所以 return function 都必須符合 <code>Func&lt;double, double, double&gt;</code>，這與 class interface 的本質是一樣的</p>
</blockquote>
<p>16 行</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> realPrice = OrderProxy(MemberService.IsMember)(<span class="number">0.8</span>, <span class="number">800</span>);</span><br></pre></td></tr></table></figure>
<p><code>orderProxy(MemberService.IsMember)</code> 回傳為一 anonymous function，其中 <code>MemberService.IsMember</code> 為 function dependency，而  <code>(discount, originalPrice)</code> 為 anonymous function 的參數。</p>
<p>也就是原本是</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> realPrice = orderService(discount, originalPrice);</span><br></pre></td></tr></table></figure>
<p>因為 <code>orderProxy()</code> 回傳的 anonymous function 與 <code>orderService()</code> 的 signature 都是 <code>Func&lt;double, double, double&gt;</code>，所以其本質與 Proxy Pattern 都遵守 <code>PriceInterface</code> 意義是一樣的，只是 FP 使用 proxy function，而 OOP 使用 proxy class。</p>
<h2 id="Refactoring">Refactoring</h2><hr>
<p>或許你會覺得 <code>OrderProxy()</code> 這個 local function 放在 <code>Client</code> 太過沈重，想另外 <code>Move Method</code> 到 <code>OrderProxy</code> class，那也非常簡單。</p>
<p><img src="/images/design-pattern/proxy/proxy016.svg" alt="proxy016"></p>
<p><strong>OrderProxy</strong><br><img src="/images/design-pattern/proxy/proxy017.svg" alt="proxy017"></p>
<p><strong>OrderProxy.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> OrderLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">OrderProxy</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt; GetPrice(Predicate&lt;<span class="keyword">string</span>&gt; isMember)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> isMember(<span class="string">"Sam"</span>) ? </span><br><span class="line">                   (Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">double</span>&gt;) OrderService.GetPrice : </span><br><span class="line">                   (discount, price) =&gt; price;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>將 <code>OrderProxy()</code> local function 透過 Refactoring 的 <code>Move Method</code> 到 <code>OrderProxy</code> class，直接將 local function <code>剪下貼上</code> 即可。</p>
<blockquote>
<p><code>Move Method</code> 在 OOP Refactoring 雖然很基本，但實務上卻不容易達到，主要是因為 OOP 的 method 會與 field 有關，要 <code>Move Method</code> 可能得先 <code>Move Field</code>，要 <code>Move Field</code> 又可能得先 <code>Self Encapsulate Field</code>，然後又會發現更多 method 也必須跟著 <code>Move Method</code>，總之會是一連串的 combo 動作。</p>
<p>但若是 Pure Function，則 <code>Move Method</code> 非常容易，只是 <code>剪下貼上</code> 即可，因為完全不涉及 field，也不會與其他 method 有關，所以 FP 非常適合重構 <code>Move Method</code>。</p>
</blockquote>
<p><strong>Client</strong><br><img src="/images/design-pattern/proxy/proxy018.svg" alt="proxy018"></p>
<p><strong>Program.cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> MemberLibrary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> realPrice = OrderProxy.GetPrice(MemberService.IsMember)(<span class="number">0.8</span>, <span class="number">800</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">"Real price : &#123;0&#125;"</span>, realPrice);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>Client</code> 提供 <code>OrderProxy.GetPrice()</code> 的 dependency function 後，就可處理訂單了。</p>
<blockquote>
<p> 從 OOP 原本具有 <code>垂直</code> 特性的架構，經過 FP 重構後，出現 <code>水平</code> 近似 <code>鐵道</code> 的架構，也就是所謂的 <code>Railway Oriented Programming</code>，因為重構到最後的架構都是 <code>水平</code> 的，剛好就是 FP 所強調的 Pipeline 與 Function Composition。</p>
</blockquote>
<h2 id="Summary">Summary</h2><hr>
<blockquote>
<p>Q：Proxy Pattern 與 Decorator Pattern 有什麼差異？</p>
</blockquote>
<p><strong>Proxy Pattern</strong><br><img src="/images/design-pattern/proxy/proxy020.svg" alt="proxy018"></p>
<p><strong>Decorator Pattern</strong><br><img src="/images/design-pattern/proxy/proxy019.svg" alt="proxy019"></p>
<p>以 class diagram 角度，Proxy Pattern 與 Decorator Pattern 的確非常類似。</p>
<blockquote>
<p>學 Design Pattern 不能以 class diagram 的角度去思考，而要以他要解決什麼問題來思考</p>
</blockquote>
<p><strong>Similarity</strong></p>
<ul>
<li>都在解決 <code>繼承濫用</code> </li>
<li>Interface 都不會改變</li>
</ul>
<p><strong>Difference</strong></p>
<ul>
<li>Proxy 目的在對 service 做 <code>控制存取</code>；Decorator 目的在對 service <code>增加功能</code></li>
<li>Proxy 與 Subject 只能在 compile-time <code>靜態對應</code>；Decorator 能在 run-time <code>動態新增</code></li>
</ul>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li><code>繼承</code> 通常是 OOP 最直覺的作法，但也是維護上最容易出問題的地方，Proxy Pattern 與 Decorator Pattern 提供了 <code>繼承</code> 的取代方案，讓 client 與 service 之間的依賴僅限於 interface，而不是 concrete service</li>
<li>Proxy Pattern 與 Decorator Pattern 非常類似，也都在解決 <code>繼承</code> 的老問題，但 Proxy Pattern 重點在於 <code>控制存取</code>，而 Decorator Pattern 重點在於 <code>增加功能</code></li>
<li>Proxy class 亦可使用 Proxy function 取代，如此 interface 與 proxy class 都可省略，依賴注入可改用 Higher Order Function 解決。</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/Core2OrderProxy" target="_blank" rel="external">GitHub</a> 上找到</p>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://sourcemaking.com/" target="_blank" rel="external">Source Making</a>, <a href="https://sourcemaking.com/design_patterns/proxy" target="_blank" rel="external">Proxy Design Pattern</a></p>
]]></content>
    <summary type="html">
    <![CDATA[使用 FP 將有不同的實現方式]]>
    
    </summary>
    
      <category term="C#" scheme="http://oomusou.io/tags/C/"/>
    
      <category term="Design Pattern" scheme="http://oomusou.io/tags/Design-Pattern/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入探討 F# List Module 所提供的 Function (Q ~ Z)]]></title>
    <link href="http://oomusou.io/fsharp/list-module-function-part3/"/>
    <id>http://oomusou.io/fsharp/list-module-function-part3/</id>
    <published>2018-04-07T13:23:43.000Z</published>
    <updated>2018-04-08T15:39:17.935Z</updated>
    <content type="html"><![CDATA[<p>F# 的 List module 提供眾多 <code>List</code> 常用的 Higher Order Function，要能發揮 FP 的威力，首先必須能活用內建 function。</p>
<p>本文探討英文字母 Q ~ Z 開頭的 function。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="List-reduce">List.reduce</h2><hr>
<blockquote>
<p>將 list 中每個 element 的值經過 reduction function 累加</p>
<p><code>reduction : (&#39;T -&gt; &#39;T -&gt; &#39;T) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.reduce (<span class="keyword">fun</span> acc elm -&gt; acc + elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : <code>List.fold()</code> 與 <code>List.reduce()</code> 有何差異？</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.fold (<span class="keyword">fun</span> elm acc -&gt; acc + elm) <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p><strong>相同</strong></p>
<ul>
<li>都是 <code>累加</code></li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.fold()</code> 可以設定初始值；<code>List.reduce()</code> 不能設定初始值</li>
<li><code>List.fold()</code> 可以不同型別，如 <code>(string * int) list</code> -&gt; int；<code>List.reduce()</code> 從頭到尾必須相同型別，如 <code>int lint -&gt; int</code></li>
</ul>
<h2 id="List-reduceBack">List.reduceBack</h2><hr>
<blockquote>
<p>將 list 中每個 element 的值從尾部經過 reduction function 累加<br><code>reduction : (&#39;T -&gt; &#39;T -&gt; &#39;T) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.reduceBack (<span class="keyword">fun</span> elm acc -&gt; acc + elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<h2 id="List-replicate">List.replicate</h2><hr>
<blockquote>
<p>以相同 element 建立 list</p>
<p><code>count : int -&gt; initial : &#39;T -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List.replicate <span class="number">3</span> <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 0; 0]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-rev">List.rev</h2><hr>
<blockquote>
<p>將 list 反過來表示</p>
<p><code>list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.rev</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 2; 1]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-scan">List.scan</h2><hr>
<blockquote>
<p>類似 <code>List.fold()</code> 與 <code>List.reduce()</code> 對 list 進行累加，但會將計算過程保留在新 list 的 element</p>
<p><code>folder : (&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state : &#39;State -&gt; list : &#39;T list -&gt; &#39;State list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.scan (<span class="keyword">fun</span> acc elm -&gt; acc + elm) <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 1; 3; 6]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-scanBack">List.scanBack</h2><hr>
<blockquote>
<p>同 <code>List.scan()</code>，但從 list 尾部開始累加，並將最後結果先顯示</p>
<p><code>folder : (&#39;T -&gt; &#39;State -&gt; &#39;State) -&gt; list : &#39;T list -&gt; state : &#39;State -&gt; &#39;State list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">List.scanBack (<span class="keyword">fun</span> elm acc -&gt; acc + elm) list1 <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [6; 5; 3; 0]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-singleton">List.singleton</h2><hr>
<blockquote>
<p>將整個 list 成為新 list 的第一個 element</p>
<p><code>value : &#39;T -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.singleton</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [[1; 2; 3]]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-skip">List.skip</h2><hr>
<blockquote>
<p>忽略前 n 個 element 並傳回新 list</p>
<p><code>count : int -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.skip <span class="number">5</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [6; 7; 8; 9; 10]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-skipWhile">List.skipWhile</h2><hr>
<blockquote>
<p>忽略前 n 個符合 predicate function 的 element，若第一個 element 不符合則停止 skip</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.skipWhile (<span class="keyword">fun</span> elm -&gt; elm &lt; <span class="number">5</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [5; 6; 7; 8; 9; 10]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sort">List.sort</h2><hr>
<blockquote>
<p>將 list 排序 (由小到大)</p>
<p><code>list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3</span>; <span class="number">2</span>; <span class="number">1</span> ]</span><br><span class="line">|&gt;List.sort</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sortDescending">List.sortDescending</h2><hr>
<blockquote>
<p>將 list 排序 (由大到小)</p>
<p><code>list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.sortDescending</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 2; 1]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sortBy">List.sortBy</h2><hr>
<blockquote>
<p>將 list 的 element 透過 projection function 轉換過，再根據 key 排序 (由小到大)</p>
<p><code>projection : (&#39;T -&gt; &#39;Key) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3</span>; <span class="number">2</span>; <span class="number">1</span> ]</span><br><span class="line">|&gt;List.sortBy (<span class="keyword">fun</span> elm -&gt; elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sortByDescending">List.sortByDescending</h2><hr>
<blockquote>
<p>將 list 的 element 透過 projection function 轉換過，再根據 key 排序 (由大到小)</p>
<p><code>projection : (&#39;T -&gt; &#39;Key) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.sortByDescending (<span class="keyword">fun</span> elm -&gt; elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 2; 1]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sortWith">List.sortWith</h2><hr>
<blockquote>
<p>將 list 的 element 透過 comparer function 排序</p>
<p><code>comparer : (&#39;T -&gt; &#39;T -&gt; int) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">3</span>; <span class="number">2</span>; <span class="number">1</span> ]</span><br><span class="line">|&gt;List.sortWith (<span class="keyword">fun</span> elm1 elm2 -&gt; elm1 - elm2)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-splitAt">List.splitAt</h2><hr>
<blockquote>
<p>將 list 根據指定 index 分成兩個 list</p>
<p><code>index : int -&gt; list : &#39;T list -&gt; &#39;T list * &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.splitAt <span class="number">5</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([1; 2; 3; 4; 5], [6; 7; 8; 9; 10])</span></span><br></pre></td></tr></table></figure>
<h2 id="List-splitInto">List.splitInto</h2><hr>
<blockquote>
<p>將 list 分成指定 chunk 數</p>
<p><code>count : int -&gt; list : &#39;T list -&gt; &#39;T list list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.splitInto <span class="number">3</span> </span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [[1; 2; 3; 4]; [5; 6; 7]; [8; 9; 10]]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sum">List.sum</h2><hr>
<blockquote>
<p>將 list 中所有 element 相加</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.sum</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<h2 id="List-sumBy">List.sumBy</h2><hr>
<blockquote>
<p>將 list 先將過 projection function 運算後再相加，相當於 <code>List.map()</code> + <code>List.sum()</code></p>
<p><code>projection : (&#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;U</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.sumBy (<span class="keyword">fun</span> elm -&gt; elm * elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure>
<p>相當於</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> elm -&gt; elm * elm)</span><br><span class="line">|&gt; List.sum</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure>
<h2 id="List-tail">List.tail</h2><hr>
<blockquote>
<p>將 list 除了第 1 個 element 外，剩下的 list 傳回，相當於 list 的 <code>Tail</code> property</p>
<p><code>list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.tail</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-take">List.take</h2><hr>
<blockquote>
<p>回傳 list 前 n 個 element</p>
<p><code>count : int -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.take <span class="number">3</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : <code>List.truncate()</code> 與 <code>List.take()</code> 有何差異？</p>
</blockquote>
<p>當 n 大於 <code>Length</code> 時，<code>List.truncate()</code> 不會報錯，只是將整個 list 傳回；但 <code>List.take()</code> 拋出 <code>InvalidOperationException</code></p>
<h2 id="List-takeWhild">List.takeWhild</h2><hr>
<blockquote>
<p>回傳前 n 個符合 predicate function 的 element，若第一個 element 不符合則停止 take</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt;List.takeWhile (<span class="keyword">fun</span> elm -&gt; elm &lt; <span class="number">5</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-toArray">List.toArray</h2><hr>
<blockquote>
<p>將 list 轉成 array</p>
<p><code>list : &#39;T list -&gt; &#39;T []</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.toArray</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [|1; 2; 3|]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-toSeq">List.toSeq</h2><hr>
<blockquote>
<p>將 list 轉成 sequence</p>
<p><code>list : &#39;T list -&gt; seq&lt;&#39;T&gt;</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt;List.toSeq</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-transpose">List.transpose</h2><hr>
<blockquote>
<p>將 sequence 內的 list 加以 transpose</p>
<p><code>list : seq&lt;&#39;T list&gt; -&gt; &#39;T list list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span>]]</span><br><span class="line">|&gt;List.transpose</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [[1]; [2]; [3]]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-truncate">List.truncate</h2><hr>
<blockquote>
<p>回傳 list 最多 n 的 element</p>
<p><code>count : int -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span>]</span><br><span class="line">|&gt;List.truncate <span class="number">6</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : <code>List.truncate()</code> 與 <code>List.take()</code> 有何差異？</p>
</blockquote>
<p>當 n 大於 <code>Length</code> 時，<code>List.truncate()</code> 不會報錯，只是將整個 list 傳回；但 <code>List.take()</code> 拋出 <code>InvalidOperationException</code></p>
<h2 id="List-tryFind">List.tryFind</h2><hr>
<blockquote>
<p>找出 list 中符合 predicate function 條件的第一個 element</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.tryFind (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> <code>List.find()</code> 與 <code>List.tryFind()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.find()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryFind()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.find()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFind()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFind()</code> 取代 <code>List.find()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryFindBack">List.tryFindBack</h2><hr>
<blockquote>
<p>從 list 尾部找出符合 predicate function 條件的第一個 element</p>
<p><code>predicate：(&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.tryFindBack (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 10</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.findBack()</code> 與 <code>List.tryFindBack()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findBack()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryFindBack()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.findBack()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindBack()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindBack()</code> 取代 <code>List.findBack()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryFindIndex">List.tryFindIndex</h2><hr>
<blockquote>
<p>找出 list 中符合 predicate function 條件的第一 element 的 index</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; int option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.tryFindIndex (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.findIndex()</code> 與 <code>List.tryFindIndex()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findIndex()</code> 傳回 <code>int</code>；而 <code>List.tryFindIndex()</code> 傳回 <code>int option</code></p>
</li>
<li><p>若找不到資料，<code>List.findIndex()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindIndex()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindIndex()</code> 取代 <code>List.findIndex()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryFindIndexBack">List.tryFindIndexBack</h2><hr>
<blockquote>
<p>從 list 尾部找出符合 predicate function 條件的第一 element 的 index</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; int option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.tryFindIndexBack (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 9</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.findIndexBack()</code> 與 <code>List.tryFindIndexBack()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findIndexBack()</code> 傳回 <code>int</code>；而 <code>List.tryFindIndexBack()</code> 傳回 <code>int option</code></p>
</li>
<li><p>若找不到資料，<code>List.findIndexBack()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindIndexBack()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindIndexBack()</code> 取代 <code>List.findIndexBack()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryHead">List.tryHead</h2><hr>
<blockquote>
<p>傳回 list 第一個 element，相當於 list 的  <code>Head</code> property</p>
<p><code>list : &#39;T list -&gt; &#39;T option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.tryHead</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 1</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.head()</code> 與 <code>List.tryHead()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 第一個 element</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.head()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryHead()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.head()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryHead()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryHead()</code> 取代 <code>List.head()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryItem">List.tryItem</h2><hr>
<blockquote>
<p>傳回 list 指定 index 的 element 值，相當於 list 的 <code>Item</code> property</p>
<p><code>index : int -&gt; list : &#39;T list -&gt; &#39;T option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.tryItem <span class="number">2</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.item()</code> 與 <code>List.tryItem()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 指定 index 的 element 值</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.item()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryItem()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.head()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryHead()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryItem()</code> 取代 <code>List.item()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryLast">List.tryLast</h2><hr>
<blockquote>
<p>傳回 list 最後一個 element</p>
<p><code>list : &#39;T list -&gt; &#39;T option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.tryLast</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.last()</code> 與 <code>List.tryLast()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 最後一個 element 值</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.last()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryLast()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.last()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryLast()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryLast()</code> 取代 <code>List.last()</code>，較為安全</p>
</blockquote>
<h2 id="List-tryPick">List.tryPick</h2><hr>
<blockquote>
<p>找出 list 中符合 chooser function 條件的第一個 element</p>
<p><code>chooser : (&#39;T -&gt; &#39;U option) -&gt; list : &#39;T list -&gt; &#39;U option</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> chooser elm = </span><br><span class="line">    <span class="keyword">match</span> elm <span class="keyword">with</span> </span><br><span class="line">    | elm <span class="keyword">when</span> elm % <span class="number">2</span> = <span class="number">0</span> -&gt; Some elm</span><br><span class="line">    | _ -&gt; None</span><br><span class="line"></span><br><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.tryPick chooser</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// Some 2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q：<code>List.pick()</code> 與 <code>List.tryPick()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 chooser function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.pick()</code> 傳回 <code>&#39;U</code>；而 <code>List.tryPick()</code> 傳回 <code>&#39;U option</code></p>
</li>
<li><p>若找不到資料，<code>List.pick()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryPick()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryPick()</code> 取代 <code>List.pick()</code>，較為安全</p>
</blockquote>
<h2 id="List-unfold">List.unfold</h2><hr>
<blockquote>
<p>根據 generator function 建立 list，其中 generator function 可指定目前 state 與下一個 state</p>
<p><code>generator : (&#39;State -&gt; (&#39;T * &#39;State) option) -&gt; state : &#39;State -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> generator state =</span><br><span class="line">    <span class="keyword">match</span> state <span class="keyword">with</span> </span><br><span class="line">    |_ <span class="keyword">when</span> state &lt; <span class="number">10</span> -&gt; Some(state, state + <span class="number">1</span>)</span><br><span class="line">    |_                 -&gt; None</span><br><span class="line"></span><br><span class="line">List.unfold generator <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 1; 2; 3; 4; 5; 6; 7; 8; 9]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-unzip">List.unzip</h2><hr>
<blockquote>
<p>將所有 element 為 pair 的 list，分解成兩個 list</p>
<p><code>list : (&#39;T1 * &#39;T2) list -&gt; &#39;T1 list * &#39;T2 list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ (<span class="number">1</span>, <span class="number">4</span>); (<span class="number">2</span>, <span class="number">5</span>); (<span class="number">3</span>, <span class="number">6</span>) ]</span><br><span class="line">|&gt; List.unzip</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([1; 2; 3], [4; 5; 6])</span></span><br></pre></td></tr></table></figure>
<h2 id="List-unzip3">List.unzip3</h2><hr>
<blockquote>
<p>將所有 element 為 triple 的 list，分解成三個 list</p>
<p><code>list : (&#39;T1 * &#39;T2 * &#39;T3) list -&gt; &#39;T1 list * &#39;T2 list * &#39;T3 list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ (<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>); (<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>); (<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>) ]</span><br><span class="line">|&gt; List.unzip3</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([1; 2; 3], [4; 5; 6], [7; 8; 9])</span></span><br></pre></td></tr></table></figure>
<h2 id="List-where">List.where</h2><hr>
<blockquote>
<p>找出 list 中符合 predicate function 條件的所有 element</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span>]</span><br><span class="line">|&gt; List.where (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">1</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-windowed">List.windowed</h2><hr>
<blockquote>
<p>依照 list 的 element 順序，依序取出 n 個 element 的 list</p>
<p><code>windowSize : int -&gt; list : &#39;T list -&gt; &#39;T list list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">5</span> ]</span><br><span class="line">|&gt; List.windowed <span class="number">3</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [[1; 2; 3]; [2; 3; 4]; [3; 4; 5]]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-zip">List.zip</h2><hr>
<blockquote>
<p>將兩個 list 合併成 element 為 pair 的 list</p>
<p> <code>list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; (&#39;T1 * &#39;T2) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"></span><br><span class="line">List.zip list1 list2</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [(1, 4); (2, 5); (3, 6)]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-zip3">List.zip3</h2><hr>
<blockquote>
<p>將三個 list 合併成 element 為 triple 的 list</p>
<p><code>list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; list3 : &#39;T3 list -&gt; (&#39;T1 * &#39;T2 * &#39;T3) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"><span class="keyword">let</span> list3 = [ <span class="number">7</span>; <span class="number">8</span>; <span class="number">9</span> ]</span><br><span class="line"></span><br><span class="line">List.zip3 list1 list2 list3</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [(1, 4, 7); (2, 5, 8); (3, 6, 9)]</span></span><br></pre></td></tr></table></figure>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>List module 所提供的 function 都必須非常熟練，因為這些都是常用的 Higher Order Function，算是 FP 的基本功</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://msdn.microsoft.com/en-us/" target="_blank" rel="external">MSDN</a>, <a href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/collections.list-module-%5bfsharp%5d" target="_blank" rel="external">Collection.List Module (F#)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[FP 的基本功]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入探討 F# List Module 所提供的 Function (G ~ P)]]></title>
    <link href="http://oomusou.io/fsharp/list-module-function-part2/"/>
    <id>http://oomusou.io/fsharp/list-module-function-part2/</id>
    <published>2018-04-07T12:23:43.000Z</published>
    <updated>2018-04-08T15:44:33.323Z</updated>
    <content type="html"><![CDATA[<p>F# 的 List module 提供眾多 <code>List</code> 常用的 Higher Order Function，要能發揮 FP 的威力，首先必須能活用內建 function。</p>
<p>本文探討英文字母 G ~ P 開頭的 function。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="List-head">List.head</h2><hr>
<blockquote>
<p>傳回 list 第一個 element，相當於 list 的  <code>Head</code> property</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.head</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>若為 empty list，會拋出 <code>ArgumentException</code>。</p>
<blockquote>
<p>Q：<code>List.head()</code> 與 <code>List.tryHead()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 第一個 element</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.head()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryHead()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.head()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryHead()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryHead()</code> 取代 <code>List.head()</code>，較為安全</p>
</blockquote>
<h2 id="List-indexed">List.indexed</h2><hr>
<blockquote>
<p>將 element 的 key 與 value 封裝成 tuple 的 list</p>
<p><code>list : &#39;T list -&gt; (int * &#39;T) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.indexed</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [(0, 1); (1, 2); (2, 3)]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-init">List.init</h2><hr>
<blockquote>
<p>根據 index 值建立新的 list</p>
<p><code>int -&gt; initializer : (int -&gt; &#39;T) -&gt; &#39;T list</code>   </p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List.init <span class="number">10</span> (<span class="keyword">fun</span> idx -&gt; idx * <span class="number">2</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 2; 4; 6; 8; 10; 12; 14; 16; 18]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-isEmpty">List.isEmpty</h2><hr>
<blockquote>
<p>判斷 list 是否為空，相當於 list 的  <code>IsEmpty</code> property</p>
<p><code>list : &#39;T list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br><span class="line">|&gt; List.isEmpty</span><br><span class="line">|&gt; printf <span class="string">"%b"</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="List-item">List.item</h2><hr>
<blockquote>
<p>傳回 list 指定 index 的 element 值，相當於 list 的 <code>Item</code> property</p>
<p><code>index : int -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.item <span class="number">2</span></span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>ArgumentException</code>。</p>
<blockquote>
<p>Q：<code>List.item()</code> 與 <code>List.tryItem()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 指定 index 的 element 值</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.item()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryItem()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.head()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryHead()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryItem()</code> 取代 <code>List.item()</code>，較為安全</p>
</blockquote>
<h2 id="List-iter">List.iter</h2><hr>
<blockquote>
<p>對每個 element 執行回傳值為 <code>unit</code> 的 action function</p>
<p><code>action : (&#39;T -&gt; unit) -&gt; list : &#39;T list -&gt; unit</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.iter (printf <span class="string">"%A "</span>)</span><br><span class="line"><span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure>
<h2 id="List-iter2">List.iter2</h2><hr>
<blockquote>
<p>同時對兩個 list 的每個 element 執行回傳值為 <code>unit</code> 的 action function</p>
<p><code>action : (&#39;T1 -&gt; &#39;T2 -&gt; unit) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; unit</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> action elm1 elm2 =</span><br><span class="line">    printf <span class="string">"%d "</span> (elm1 + elm2) </span><br><span class="line"></span><br><span class="line">List.iter2 action list1 list2</span><br><span class="line"><span class="comment">// 5 7 9</span></span><br></pre></td></tr></table></figure>
<h2 id="List-iteri">List.iteri</h2><hr>
<blockquote>
<p>對每個 element 執行回傳值為 <code>unit</code> 的 action function，但會將 index 也傳入 action function</p>
<p><code>action : (int -&gt; &#39;T -&gt; unit) -&gt; list : &#39;T list -&gt; unit</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.iteri (<span class="keyword">fun</span> idx elm -&gt; printfn <span class="string">"%d : %d"</span> idx elm)</span><br><span class="line"><span class="comment">// 0 : 1</span></span><br><span class="line"><span class="comment">// 1 : 2</span></span><br><span class="line"><span class="comment">// 2 : 3</span></span><br></pre></td></tr></table></figure>
<h2 id="List-iteri2">List.iteri2</h2><hr>
<blockquote>
<p>同時對兩個 list 的每個 element 執行回傳值為 <code>unit</code> 的 action function，但會將 index 也傳入 action function</p>
<p><code>action : (int -&gt; &#39;T1 -&gt; &#39;T2 -&gt; unit) -&gt; list1 : &#39;T1 list -&gt; list2 :  &#39;T2 list -&gt; unit</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> action idx elm1 elm2 =</span><br><span class="line">    printfn <span class="string">"%d : %d"</span> idx (elm1 + elm2) </span><br><span class="line"></span><br><span class="line">List.iteri2 action list1 list2</span><br><span class="line"><span class="comment">// 0 : 5</span></span><br><span class="line"><span class="comment">// 1 : 7</span></span><br><span class="line"><span class="comment">// 2 : 9</span></span><br></pre></td></tr></table></figure>
<h2 id="List-last">List.last</h2><hr>
<blockquote>
<p>傳回 list 最後一個 element</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.last</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>ArgumentException</code>。</p>
<blockquote>
<p>Q：<code>List.last()</code> 與 <code>List.tryLast()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都傳回 list 最後一個 element 值</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.last()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryLast()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.last()</code> 會拋出  <code>ArgumentException</code>；但 <code>List.tryLast()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryLast()</code> 取代 <code>List.last()</code>，較為安全</p>
</blockquote>
<h2 id="List-length">List.length</h2><hr>
<blockquote>
<p>傳回 list 的 element 個數，相當於 list 的  <code>Length</code> property</p>
<p><code>list: &#39;T list -&gt; int</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.length</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h2 id="List-map">List.map</h2><hr>
<blockquote>
<p>將 list 的每個 element  根據 mapping function 轉換成另外一個 value 的 list</p>
<p><code>mapping : (&#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> elm -&gt; elm * elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 4; 9]</span></span><br></pre></td></tr></table></figure>
<p>若經過 mapping function 後 element 個數不一樣，請用 <code>List.collect()</code></p>
<h2 id="List-map2">List.map2</h2><hr>
<blockquote>
<p>將兩個 list 的每個 element  根據 mapping function 轉換成另外一個 value 的 list</p>
<p><code>mapping : (&#39;T1 -&gt; &#39;T2 -&gt; &#39;U) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"></span><br><span class="line">List.map2 (<span class="keyword">fun</span> elem1 elem2 -&gt; elem1 + elem2) list1 list2</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [5; 7; 9]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-map3">List.map3</h2><hr>
<blockquote>
<p>將三個 list 的每個 element  根據 mapping function 轉換成另外一個 value 的 list</p>
<p><code>mapping : (&#39;T1 -&gt; &#39;T2 -&gt; &#39;T3 -&gt; &#39;U) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; list3 : &#39;T3 list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"><span class="keyword">let</span> list3 = [ <span class="number">7</span>; <span class="number">8</span>; <span class="number">9</span> ]</span><br><span class="line"></span><br><span class="line">List.map3 (<span class="keyword">fun</span> elm1 elm2 elm3 -&gt; elm1 + elm2 + elm3) list1 list2 list3</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [12; 15; 18]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-mapFold">List.mapFold</h2><hr>
<blockquote>
<p>相當於 <code>List.map()</code> + <code>List.fold()</code> 合體，回傳為 tuple。</p>
<p><code>mapping : (&#39;State -&gt; &#39;T -&gt; &#39;Result * &#39;State) -&gt; state : &#39;State -&gt; list : &#39;T list -&gt; &#39;Result list * &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.mapFold (<span class="keyword">fun</span> acc elm -&gt; (elm * elm , acc + elm * elm)) <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([1; 4; 9], 14)</span></span><br></pre></td></tr></table></figure>
<p>mapping funciton 中，回傳的是 tuple。</p>
<ul>
<li>第 1 個 element 為 <code>List.map()</code> 的結果</li>
<li>第 2 個 element 為 <code>List.fold()</code> 的結果</li>
</ul>
<h2 id="List-mapFoldBack">List.mapFoldBack</h2><hr>
<blockquote>
<p>相當於 <code>List.map()</code> + <code>List.fold()</code> 合體，回傳為 tuple，但從 list 的尾部開始，signature 的順序也不一樣</p>
<p><code>mapping : (&#39;T -&gt; &#39;State -&gt; &#39;Result * &#39;State) -&gt; list : &#39;T list -&gt; state : &#39;State -&gt; &#39;Result * &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">List.mapFoldBack (<span class="keyword">fun</span> elm acc -&gt; (elm * elm , acc + elm * elm)) list1 <span class="number">0</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([1; 4; 9], 14)</span></span><br></pre></td></tr></table></figure>
<h2 id="List-mapi">List.mapi</h2><hr>
<blockquote>
<p>對 list 的每個 element  根據 mapping function 轉換成另外一個 value 的 list，但會將 index 也傳入 mapping function</p>
<p><code>mapping : (int -&gt; &#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.mapi (<span class="keyword">fun</span> idx elm -&gt; idx * elm)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 2; 6]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-mapi2">List.mapi2</h2><hr>
<blockquote>
<p>同時對兩個 list 的每個 element  根據 mapping function 轉換成另外一個 value 的 list，但會將 index 也傳入 mapping function</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mapping idx elm1 elm2 =</span><br><span class="line">    idx + elm1 + elm2</span><br><span class="line"></span><br><span class="line">List.mapi2 mapping list1 list2</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [5; 8; 11]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-max">List.max</h2><hr>
<blockquote>
<p>傳回 list 內 element 最大值</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.max</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h2 id="List-maxBy">List.maxBy</h2><hr>
<blockquote>
<p>傳回 list 內 element 最大值，但所比較的是經過 projection function 轉換過的值</p>
<p><code>project : (&#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.maxBy (<span class="keyword">fun</span> elm -&gt; <span class="number">1</span> - elm)</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p><code>[1; 2; 3]</code> 經過 projection function 後為 <code>[0; -1; -2]</code>，所以最大值為 <code>0</code>，但 <code>List.maxBy()</code> 回傳的是原 list 的值，所以為 <code>1</code>。</p>
<blockquote>
<p>Projection function 的值只是比較用，不是回傳用</p>
</blockquote>
<h2 id="List-min">List.min</h2><hr>
<blockquote>
<p>傳回 list 內 element 最小值</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.min</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h2 id="List-minBy">List.minBy</h2><hr>
<blockquote>
<p>傳回 list 內 element 最小值，但所比較的是經過 projection function 轉換過的值</p>
<p><code>project : (&#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.minBy (<span class="keyword">fun</span> elm -&gt; <span class="number">1</span> - elm)</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p><code>[1; 2; 3]</code> 經過 projection function 後為 <code>[0; -1; -2]</code>，所以最小值為 <code>0</code>，但 <code>List.minBy()</code> 回傳的是原 list 的值，所以為 <code>3</code>。</p>
<blockquote>
<p>Projection function 的值只是比較用，不是回傳用</p>
</blockquote>
<h2 id="List-ofArray">List.ofArray</h2><hr>
<blockquote>
<p>由 array 轉成 list</p>
<p><code>array : &#39;T [] -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[| <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> |]</span><br><span class="line">|&gt; List.ofArray</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-ofSeq">List.ofSeq</h2><hr>
<blockquote>
<p>由 sequence 轉成 list</p>
<p><code>source : seq&lt;&#39;T&gt; -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seq &#123; <span class="number">1</span> .. <span class="number">5</span> &#125;</span><br><span class="line">|&gt; List.ofSeq</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4; 5]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-pairWise">List.pairWise</h2><hr>
<blockquote>
<p>根據 list 順序，回傳兩兩成為 tuple 的 list</p>
<p><code>list : &#39;T list -&gt; (&#39;T * &#39;T) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span>; <span class="number">4</span> ]</span><br><span class="line">|&gt; List.pairwise</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">//[(1, 2); (2, 3); (3, 4)]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-partition">List.partition</h2><hr>
<blockquote>
<p>將 list 根據 predicate function 條件拆成兩個 list</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T list * &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.partition (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// ([2; 4; 6; 8; 10], [1; 3; 5; 7; 9])</span></span><br></pre></td></tr></table></figure>
<h2 id="List-permute">List.permute</h2><hr>
<blockquote>
<p>List 重新根據 indexMap function 的規則，重新調整 element 順序</p>
<p><code>indexMap : (int -&gt; int) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.permute (<span class="keyword">fun</span> idx -&gt; (idx + <span class="number">1</span>) % <span class="number">3</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 1; 2]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-pick">List.pick</h2><hr>
<blockquote>
<p>找出 list 中符合 chooser function 條件的第一個 element</p>
<p><code>chooser : (&#39;T -&gt; &#39;U option) -&gt; list : &#39;T list -&gt; -&gt; &#39;U</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> chooser elm = </span><br><span class="line">    <span class="keyword">match</span> elm <span class="keyword">with</span> </span><br><span class="line">    | elm <span class="keyword">when</span> elm % <span class="number">2</span> = <span class="number">0</span> -&gt; Some elm</span><br><span class="line">    | _ -&gt; None</span><br><span class="line"></span><br><span class="line">[ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line">|&gt; List.pick chooser</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>KeyNotFoundException</code>。</p>
<blockquote>
<p>Q：<code>List.find()</code> 與 <code>List.pick()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li><p>都用來找資料</p>
</li>
<li><p>找不到資料都會拋出 <code>KeyNotFoundException</code></p>
</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.find()</code> 的 predicate function 為 <code>&#39;T -&gt; bool</code></li>
<li><code>List.pick()</code> 的 chooser function 為 <code>&#39;T -&gt; &#39;U option</code></li>
</ul>
<blockquote>
<p>若 fuction 回傳為 <code>option</code>，則適合用 <code>List.pick()</code>，否則使用 <code>List.find()</code></p>
</blockquote>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>List module 所提供的 function 都必須非常熟練，因為這些都是常用的 Higher Order Function，算是 FP 的基本功</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://msdn.microsoft.com/en-us/" target="_blank" rel="external">MSDN</a>, <a href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/collections.list-module-%5bfsharp%5d" target="_blank" rel="external">Collection.List Module (F#)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[FP 的基本功]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入探討 F# List Module 所提供的 Function (A ~ F)]]></title>
    <link href="http://oomusou.io/fsharp/list-module-function-part1/"/>
    <id>http://oomusou.io/fsharp/list-module-function-part1/</id>
    <published>2018-04-06T12:23:43.000Z</published>
    <updated>2018-04-08T15:39:24.615Z</updated>
    <content type="html"><![CDATA[<p>F# 的 List module 提供眾多 <code>List</code> 常用的 Higher Order Function，要能發揮 FP 的威力，首先必須能活用內建 function。</p>
<p>本文探討英文字母 A ~ F 開頭的 function。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="List-allPairs">List.allPairs</h2><hr>
<blockquote>
<p>將兩個 list 的 element 取 cartesian product</p>
<p><code>list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; (&#39;T1 * &#39;T2) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.allPairs [ <span class="number">4</span> .. <span class="number">6</span> ]</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [(4, 1); (4, 2); (4, 3); (5, 1); (5, 2); (5, 3); (6, 1); (6, 2); (6, 3)]</span></span><br></pre></td></tr></table></figure>
<p>兩個 list 可以不同型別，反正最後會以 tuple 形式呈現。</p>
<h2 id="List-append">List.append</h2><hr>
<blockquote>
<p>傳入兩個 list，第 2 個 list 會 append 到第 1 個 list 之後，相當於 <code>list1@list2</code></p>
<p><code>list1 : &#39;T list -&gt; list2 : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.append [ <span class="number">4</span> .. <span class="number">6</span>]</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [4; 5; 6; 1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-average">List.average</h2><hr>
<blockquote>
<p>計算 list 中所有 element 的平均值</p>
<p><code>list : &#39;T list -&gt; T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1.0</span> .. <span class="number">10.0</span> ]</span><br><span class="line">|&gt; List.average</span><br><span class="line">|&gt; printf <span class="string">"%f"</span></span><br><span class="line"><span class="comment">// 5.500000</span></span><br></pre></td></tr></table></figure>
<h2 id="List-averageBy">List.averageBy</h2><hr>
<blockquote>
<p>將 list 所有 element 先經過 project funtion 計算後，再取平均值</p>
<p><code>project : (&#39;T -&gt; &#39;U) -&gt; list : &#39;T list -&gt; &#39;U</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.averageBy (<span class="keyword">fun</span> elm -&gt; float elm)</span><br><span class="line">|&gt; printf <span class="string">"%f"</span></span><br></pre></td></tr></table></figure>
<p><code>[ 1..3 ]</code> 無法透過 <code>List.average()</code> 取平均值，先透過 <code>List.averageBy()</code> 轉成 float，再取平均值。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1.0</span> .. <span class="number">3.0</span> ]</span><br><span class="line">|&gt; List.averageBy (<span class="keyword">fun</span> elm -&gt; elm * elm)</span><br><span class="line">|&gt; printf <span class="string">"%f"</span></span><br><span class="line"><span class="comment">// 4.666667</span></span><br></pre></td></tr></table></figure>
<p>先將 <code>[1.0; 2.0; 3.0]</code> project 成 <code>[1.0; 4.0; 9.0]</code> 之後，再取平均值。</p>
<h2 id="List-choose">List.choose</h2><hr>
<blockquote>
<p>將 list 所有 element 經過 chooser function 塞選過，傳回 option 型別的 list</p>
<p><code>chooser : (&#39;T -&gt; &#39;U option) -&gt; list : &#39;T list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span>]</span><br><span class="line">|&gt; List.filter (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> elm -&gt; elm + <span class="number">1</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 5; 7; 9; 11]</span></span><br></pre></td></tr></table></figure>
<p>先找出偶數，在每個 element + 1。</p>
<p>傳統須先使用 <code>List.filter()</code> 找出 <code>偶數</code>，在用 <code>List.map()</code> 計算 <code>+1</code>。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> chooser elm = </span><br><span class="line">    <span class="keyword">match</span> elm % <span class="number">2</span> <span class="keyword">with</span></span><br><span class="line">    | <span class="number">0</span> -&gt; Some (elm + <span class="number">1</span>)</span><br><span class="line">    | _ -&gt; None</span><br><span class="line"></span><br><span class="line">[ <span class="number">1</span> .. <span class="number">10</span>]</span><br><span class="line">|&gt; List.choose chooser</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 5; 7; 9; 11]</span></span><br></pre></td></tr></table></figure>
<p>若使用 <code>List.choose()</code>，則可在 chooser function 使用 Pattern Matching：</p>
<ul>
<li>在 pattern 與 when 完成 <code>List.filter()</code> 該做的事情</li>
<li>在 <code>-&gt;</code> 之後完成 <code>List.map()</code> 該做的事情</li>
</ul>
<p>也就是 <code>List.choose()</code> = <code>List.filter()</code> + <code>List.map()</code>。</p>
<h2 id="List-chunkBySize">List.chunkBySize</h2><hr>
<blockquote>
<p>將 list 根據 size 切成小 list</p>
<p><code>chunkSize : int -&gt; list : &#39;T list -&gt; &#39;T list list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span>]</span><br><span class="line">|&gt; List.chunkBySize <span class="number">3</span></span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [[1; 2; 3]; [4; 5; 6]; [7; 8; 9]; [10]]</span></span><br></pre></td></tr></table></figure>
<p>注意 <code>List.chunkBySize()</code> 的回傳型態為 <code>&#39;T list list</code>，表示回傳為 list，其 element 型態為 <code>&#39;T list</code>。</p>
<h2 id="List-collect">List.collect</h2><hr>
<blockquote>
<p>將 list 所有 element 經過 mapping function 轉換，其中 mapping function 會回傳新的 list，最後再將所有 list 攤平成新的 list</p>
<p><code>mapping : (&#39;T -&gt; &#39;U list) -&gt; list : &#39;T list -&gt; &#39;U list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mapping elm = [</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. <span class="number">3</span> -&gt; elm * i</span><br><span class="line">]     </span><br><span class="line">    </span><br><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.collect mapping</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 2; 4; 6; 3; 6; 9]</span></span><br></pre></td></tr></table></figure>
<p><code>mapping()</code> 會為每個 element 產生新的 list，最後再打平成單一 list。</p>
<blockquote>
<p>Q : <code>List.collect()</code> 與 <code>List.map()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都需使用 mapping function</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.map()</code> 的 mapping function 傳回 value；但  <code>List.collect()</code> 的 mapping function 傳回 list</li>
<li><code>List.map()</code> 產生的 list ，其 element 個數與原本 list 一樣大；但 <code>List.collect()</code> 產生的 list，其 element 個數大於等於原本 list</li>
</ul>
<h2 id="List-compareWith">List.compareWith</h2><hr>
<blockquote>
<p>自行定義 comparer function 比較兩個 list</p>
<p><code>comparer : (&#39;T -&gt; &#39;T -&gt; int) -&gt; list1 : &#39;T list -&gt; list2 : &#39;T list -&gt; int</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">4</span> .. <span class="number">6</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> comparer elm1 elm2 = elm1 - elm2</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> compareList list1 list2 =</span><br><span class="line">    <span class="keyword">match</span> (List.compareWith comparer list1 list2) <span class="keyword">with</span> </span><br><span class="line">    | x <span class="keyword">when</span> x &gt; <span class="number">0</span> -&gt; printfn <span class="string">"list1 is larget than list2"</span></span><br><span class="line">    | x <span class="keyword">when</span> x &lt; <span class="number">0</span> -&gt; printfn <span class="string">"list2 is larger than list1"</span></span><br><span class="line">    | _            -&gt; printfn <span class="string">"list1 and list2 are equal"</span>    </span><br><span class="line">    </span><br><span class="line">compareList list1 list2</span><br><span class="line"><span class="comment">// list1 is larger than list2</span></span><br></pre></td></tr></table></figure>
<p><code>comparer()</code> 定義 element 間的比較方式：</p>
<ul>
<li>若 <code>elm1</code> 大於 <code>elm2</code>，則傳回 <code>正數</code></li>
<li>若 <code>elm1</code> 等於 <code>elm2</code>，則傳回 <code>0</code></li>
<li>若 <code>elm1</code> 小於 <code>elm2</code>，則傳回 <code>負數</code></li>
</ul>
<blockquote>
<p>若簡單的比較，可使用數學的 <code>兩數相減</code> 即可</p>
</blockquote>
<p><code>List.compareWith()</code> 將回傳第一個 comparer function 所傳回的 <code>非零之數</code>，可使用 Pattern Matching 對回傳值做判斷。</p>
<h2 id="List-concat">List.concat</h2><hr>
<blockquote>
<p>將 n 個 list 合併為 1 個 list</p>
<p><code>lists : seq&lt;&#39;T list&gt; -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span> .. <span class="number">6</span> ]</span><br><span class="line"><span class="keyword">let</span> list3 = [ <span class="number">7</span> .. <span class="number">9</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myList = List.concat [list1; list2; list3]</span><br><span class="line"></span><br><span class="line">myList</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4; 5; 6; 7; 8; 9]</span></span><br></pre></td></tr></table></figure>
<p><code>List.concat()</code> 可合併 n 個 list，但必須將 n 個 list 包在同一個 list 傳入。</p>
<blockquote>
<p>Q：<code>List.append()</code> 與 <code>List.map()</code> 有何差異？</p>
</blockquote>
<ul>
<li><code>List.append()</code> 只能合併 2 個 list</li>
<li><code>List.concat()</code> 能合併 n 個 list</li>
</ul>
<h2 id="List-contains">List.contains</h2><hr>
<blockquote>
<p>判斷 list 的 element 是否包含某一 value</p>
<p><code>value : &#39;T -&gt; source : &#39;T list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; List.contains <span class="number">4</span></span><br><span class="line">|&gt; printfn <span class="string">"%b"</span></span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="List-countBy">List.countBy</h2><hr>
<blockquote>
<p>將 list 根據 projection function 分組後，各自計算分組後 element 個數，類似 SQL 的 <code>GROUP BY</code> + <code>count(*)</code></p>
<p><code>projection : (&#39;T -&gt; &#39;Key) -&gt; list : &#39;T list -&gt; (&#39;Key * int) list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">100</span> ]</span><br><span class="line">|&gt; List.countBy (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">3</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [(1, 34); (2, 33); (0, 33)]</span></span><br></pre></td></tr></table></figure>
<p>將 <code>[ 1 .. 100 ]</code> % 3 分成三組，餘數為 1 有 34 個，餘數為 2 有 33 個，餘數為 0 有 33 個。</p>
<h2 id="List-distinct">List.distinct</h2><hr>
<blockquote>
<p>將 list 中重複的 element 去除</p>
<p><code>list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> ; <span class="number">2</span>; <span class="number">2</span>; <span class="number">3</span>]</span><br><span class="line">|&gt; List.distinct</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-distinctBy">List.distinctBy</h2><hr>
<blockquote>
<p>將 list 所有 element 經過 projection function 產生新 key 後，將重複 key 的去除</p>
<p><code>projection (&#39;T -&gt; &#39;Key) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">100</span> ]</span><br><span class="line">|&gt; List.distinctBy (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">3</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<p>經過 projection function  <code>fun elm -&gt; elm % 3</code> 之後的  key 為 <code>[ 0; 1; 2; 0; 1; 2 …]</code>，其不重複的 key 為 <code>[ 0; 1; 2 ]</code>，但其對應的 element 為 <code>[ 1; 2; 3]</code>。</p>
<blockquote>
<p>Q：<code>List.distinctBy()</code> 與 <code>List.map()</code> 後再 <code>List.distinct()</code> 有什麼不同？</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">100</span>]</span><br><span class="line">|&gt; List.map (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">3</span>)</span><br><span class="line">|&gt; List.distinct</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 0]</span></span><br></pre></td></tr></table></figure>
<p>經過 mapping function <code>fun elm -&gt; elm % 3</code> 之後的 element 為 <code>[ 0; 1; 2; 0; 1; 2 …]</code>，其不重複的 element 為 <code>[ 0; 1; 2 ]</code>。</p>
<ul>
<li>Project function 是產生新的 key；mapping function 是產生新的 element</li>
<li><code>List.distinctBy()</code> 是排除重複的 key；<code>List.map()</code> + <code>List.distinct()</code> 是排除重複的 element</li>
</ul>
<h2 id="List-empty">List.empty</h2><hr>
<blockquote>
<p>由泛型傳回指定 element 型別的 empty list</p>
<p><code>empty&lt;&#39;T&gt; : &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List.empty&lt;int&gt;</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : List.Empty 與 List.empty 有何差異？</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">myListType</span> </span>= int list</span><br><span class="line"></span><br><span class="line">myListType.Empty</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<p><strong>相同</strong></p>
<ul>
<li>均回傳 empty list</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.Empty</code> 為 <code>List</code> type 的 static method；<code>List.empty()</code> 定義在 List module</li>
<li><code>List.Empty</code> 須先定義 type；<code>List.empty()</code> 可由泛型直接指定 element type</li>
</ul>
<h2 id="List-exactlyOne">List.exactlyOne</h2><hr>
<blockquote>
<p>從 list 回傳單一 value</p>
<p><code>list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> ]</span><br><span class="line">|&gt; List.exactlyOne</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>若 list 的 <code>Length</code> 不為 <code>1</code>，將拋出 <code>ArgumentException</code>。</p>
<h2 id="List-except">List.except</h2><hr>
<blockquote>
<p>從 list 中排出另一個 list 中的 element</p>
<p><code>seq&lt;&#39;T&gt; -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.except [ <span class="number">1</span> .. <span class="number">2</span> ]</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [3; 4; 5; 6; 7; 8; 9; 10]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-exists">List.exists</h2><hr>
<blockquote>
<p>判斷符合 predicate function 條件的 element 是否存在</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.exists (<span class="keyword">fun</span> elm -&gt; elm = <span class="number">2</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="List-exists2">List.exists2</h2><hr>
<blockquote>
<p>判斷兩個 list 是的相同位置，至少有一個 element 相等，須自行提供 predicate function 作為判斷的依據</p>
<p><code>predicate : (&#39;T1 -&gt; &#39;T2 -&gt; bool) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">3</span>; <span class="number">2</span>; <span class="number">1</span> ]</span><br><span class="line"><span class="keyword">let</span> predicate elm1 elm2 = elm1 = elm2 </span><br><span class="line">    </span><br><span class="line">List.exists2 predicate list1 list2</span><br><span class="line">|&gt; printf <span class="string">"%b"</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><code>[ 1; 2; 3 ]</code> 與 <code>[ 3; 2; 1 ]</code> 中，至少第 1 個 element 都是 <code>2</code>，只要有一個 element 是相等的就為 <code>true</code>，否則為 <code>false</code>。</p>
<p>若 <code>list1</code> 與  <code>list2</code> 的 <code>Length</code> 不同，會拋出 <code>ArgumentException</code>。 </p>
<h2 id="List-filter">List.filter</h2><hr>
<blockquote>
<p>過濾出符合 predicate function 條件的 list</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.filter (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [2; 4; 6; 8; 10]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-find">List.find</h2><hr>
<blockquote>
<p>找出 list 中符合 predicate function 條件的第一個 element</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.find (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>KeyNotFoundException</code>。</p>
<blockquote>
<p>Q：<code>List.find()</code> 與 <code>List.pick()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li><p>都用來找資料</p>
</li>
<li><p>找不到資料都會拋出 <code>KeyNotFoundException</code></p>
</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.find()</code> 的 predicate function 為 <code>&#39;T -&gt; bool</code></li>
<li><code>List.pick()</code> 的 chooser function 為 <code>&#39;T -&gt; &#39;U option</code></li>
</ul>
<blockquote>
<p>若 fuction 回傳為 <code>option</code>，則適合用 <code>List.pick()</code>，否則使用 <code>List.find()</code></p>
<p> <code>List.find()</code> 與 <code>List.tryFind()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.find()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryFind()</code> 傳回 <code>&#39;T option</code></li>
<li>若找不到資料，<code>List.find()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFind()</code> 只會回傳 <code>None</code></li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFind()</code> 取代 <code>List.find()</code>，較為安全</p>
</blockquote>
<h2 id="List-findBack">List.findBack</h2><hr>
<blockquote>
<p>從 list 尾部找出符合 predicate function 條件的第一個 element</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; &#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.findBack (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>KeyNotFoundException</code>。</p>
<blockquote>
<p>Q：<code>List.findBack()</code> 與 <code>List.tryFindBack()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findBack()</code> 傳回 <code>&#39;T</code>；而 <code>List.tryFindBack()</code> 傳回 <code>&#39;T option</code></p>
</li>
<li><p>若找不到資料，<code>List.findBack()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindBack()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindBack()</code> 取代 <code>List.findBack()</code>，較為安全</p>
</blockquote>
<h2 id="List-findIndex">List.findIndex</h2><hr>
<blockquote>
<p>找出 list 中符合 predicate function 條件的第一 element 的 index</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; int</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.findIndex (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>KeyNotFoundException</code>。</p>
<blockquote>
<p>Q：<code>List.findIndex()</code> 與 <code>List.tryFindIndex()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findIndex()</code> 傳回 <code>int</code>；而 <code>List.tryFindIndex()</code> 傳回 <code>int option</code></p>
</li>
<li><p>若找不到資料，<code>List.findIndex()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindIndex()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindIndex()</code> 取代 <code>List.findIndex()</code>，較為安全</p>
</blockquote>
<h2 id="List-findIndexBack">List.findIndexBack</h2><hr>
<blockquote>
<p>從 list 尾部找出符合 predicate function 條件的第一 element 的 index</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; int</code> </p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.findIndexBack (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p>若找不到 element，會拋出 <code>KeyNotFoundException</code>。</p>
<blockquote>
<p>Q：<code>List.findIndexBack()</code> 與 <code>List.tryFindIndexBack()</code> 有何差異？</p>
</blockquote>
<p><strong>相同</strong></p>
<ul>
<li>都使用 predicate function 為搜尋條件</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><p><code>List.findIndexBack()</code> 傳回 <code>int</code>；而 <code>List.tryFindIndexBack()</code> 傳回 <code>int option</code></p>
</li>
<li><p>若找不到資料，<code>List.findIndexBack()</code> 會拋出 <code>KeyNotFoundException</code>；但 <code>List.tryFindIndexBack()</code> 只會回傳 <code>None</code></p>
</li>
</ul>
<blockquote>
<p>實務上建議使用 <code>List.tryFindIndexBack()</code> 取代 <code>List.findIndexBack()</code>，較為安全</p>
</blockquote>
<h2 id="List-fold">List.fold</h2><hr>
<blockquote>
<p><code>List.reduce()</code> 的進階版，將 list 中每個 element 的值經過 folder function 累加</p>
<p><code>folder : (&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state : &#39;State -&gt; list : &#39;T list -&gt; &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[ </span><br><span class="line">    (<span class="string">"Cats"</span>, <span class="number">4</span>)</span><br><span class="line">    (<span class="string">"Dogs"</span>, <span class="number">5</span>)</span><br><span class="line">    (<span class="string">"Mice"</span>, <span class="number">3</span>)</span><br><span class="line">    (<span class="string">"Elephants"</span>, <span class="number">2</span>) </span><br><span class="line">]</span><br><span class="line">|&gt; List.fold (<span class="keyword">fun</span> acc (_, num) -&gt; acc + num) <span class="number">0</span> </span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : <code>List.fold()</code> 與 <code>List.reduce()</code> 有何差異？</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">4</span>; <span class="number">5</span>; <span class="number">3</span>; <span class="number">2</span> ]</span><br><span class="line">|&gt; List.reduce (<span class="keyword">fun</span> acc elm -&gt; acc + elm)</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 14</span></span><br></pre></td></tr></table></figure>
<p><strong>相同</strong></p>
<ul>
<li>都是 <code>累加</code></li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.fold()</code> 可以設定初始值；<code>List.reduce()</code> 不能設定初始值</li>
<li><code>List.fold()</code> 可以不同型別，如 <code>(string * int) list</code> -&gt; int；<code>List.reduce()</code> 從頭到尾必須相同型別，如 <code>int lint -&gt; int</code></li>
</ul>
<h2 id="List-folder2">List.folder2</h2><hr>
<blockquote>
<p>將兩個 list 透過 folder function 累加</p>
<p><code>folder : (&#39;State -&gt; &#39;T1 -&gt; &#39;T2 -&gt; &#39;State) -&gt; state : &#39;State -&gt; list1 : &#39;T list -&gt; list2 : &#39;T list -&gt; &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ </span><br><span class="line">    (<span class="string">"Cats"</span>, <span class="number">1</span>)</span><br><span class="line">    (<span class="string">"Dogs"</span>, <span class="number">2</span>)</span><br><span class="line">    (<span class="string">"Mice"</span>, <span class="number">3</span>)</span><br><span class="line">    (<span class="string">"Elephants"</span>, <span class="number">4</span>) </span><br><span class="line">] </span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> list2 = [ </span><br><span class="line">    (<span class="string">"Cats"</span>, <span class="number">4</span>)</span><br><span class="line">    (<span class="string">"Dogs"</span>, <span class="number">5</span>)</span><br><span class="line">    (<span class="string">"Mice"</span>, <span class="number">3</span>)</span><br><span class="line">    (<span class="string">"Elephants"</span>, <span class="number">2</span>) </span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> folder acc (_, num1) (_, num2) = </span><br><span class="line">    acc + num1 + num2</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; List.fold2 folder <span class="number">0</span> list2 </span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 24</span></span><br></pre></td></tr></table></figure>
<h2 id="List-foldBack">List.foldBack</h2><hr>
<blockquote>
<p><code>List.reduce()</code> 的進階版，將 list 中每個 element 的值從尾部經過 folder function 累加</p>
<p><code>folder : (&#39;T -&gt; &#39;State -&gt; State) -&gt; list : &#39;T list -&gt; state : &#39;State -&gt; &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">5</span> ]</span><br><span class="line"></span><br><span class="line">List.fold (<span class="keyword">fun</span> acc elm -&gt; elm::acc) [] list1</span><br><span class="line">|&gt; printfn <span class="string">"%A"</span></span><br><span class="line"></span><br><span class="line">List.foldBack (<span class="keyword">fun</span> elm acc -&gt; elm::acc) list1 []</span><br><span class="line">|&gt; printfn <span class="string">"%A"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [5; 4; 3; 2; 1]</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4; 5]</span></span><br></pre></td></tr></table></figure>
<p>數值累加，從頭加到尾，或尾加到頭都一樣，有有些運算，不同方向累加結果會不一樣，此時就必須使用 <code>List.foldBack()</code> 了。</p>
<p>注意 signature 也不太一樣。</p>
<h2 id="List-foldBack2">List.foldBack2</h2><hr>
<blockquote>
<p>將兩個 list 透過 folder function 從尾部累加</p>
<p><code>folder : (&#39;T1 -&gt; &#39;T2 -&gt; &#39;State -&gt; &#39;State) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; state : &#39;State -&gt; &#39;State</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">5</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">1</span> .. <span class="number">5</span> ]</span><br><span class="line"></span><br><span class="line">List.fold2 (<span class="keyword">fun</span> acc elm1 elm2 -&gt; elm1::elm2::acc) [] list1 list2</span><br><span class="line">|&gt; printfn <span class="string">"%A"</span></span><br><span class="line"></span><br><span class="line">List.foldBack2 (<span class="keyword">fun</span> elm1 elm2 acc -&gt; elm1::elm2::acc) list1 list2 []</span><br><span class="line">|&gt; printfn <span class="string">"%A"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [5; 5; 4; 4; 3; 3; 2; 2; 1; 1]</span></span><br><span class="line"><span class="comment">// [1; 1; 2; 2; 3; 3; 4; 4; 5; 5]</span></span><br></pre></td></tr></table></figure>
<h2 id="List-forall">List.forall</h2><hr>
<blockquote>
<p>判斷是否 list 的所有 element 都通過 predicate function 條件</p>
<p><code>predicate : (&#39;T -&gt; bool) -&gt; list : &#39;T list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">0</span> .. <span class="number">2</span> .. <span class="number">10</span> ]</span><br><span class="line">|&gt; List.forall (<span class="keyword">fun</span> elm -&gt; elm % <span class="number">2</span> = <span class="number">0</span>)</span><br><span class="line">|&gt; printf <span class="string">"%b"</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="List-forall2">List.forall2</h2><hr>
<blockquote>
<p>判斷是否兩個 list 的所有 element 都通過 predicate function 條件</p>
<p><code>predicate : (&#39;T1 -&gt; &#39;T2 -&gt; bool) -&gt; list1 : &#39;T1 list -&gt; list2 : &#39;T2 list -&gt; bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">10</span>]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">1</span> .. <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">List.forall2 (<span class="keyword">fun</span> elm1 elm2 -&gt; (elm1 + elm2) % <span class="number">2</span> = <span class="number">0</span>) list1 list2 </span><br><span class="line">|&gt; printf <span class="string">"%b"</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>List module 所提供的 function 都必須非常熟練，因為這些都是常用的 Higher Order Function，算是 FP 的基本功</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://msdn.microsoft.com/en-us/" target="_blank" rel="external">MSDN</a>, <a href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/collections.list-module-%5bfsharp%5d" target="_blank" rel="external">Collection.List Module (F#)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[FP 的基本功]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入探討 F# 之 List]]></title>
    <link href="http://oomusou.io/fsharp/list/"/>
    <id>http://oomusou.io/fsharp/list/</id>
    <published>2018-04-05T12:23:43.000Z</published>
    <updated>2018-04-09T01:40:23.034Z</updated>
    <content type="html"><![CDATA[<p>F# 除了使用 .NET Framework 所提供的型別外，自己還定義了不少適合 FP 的型別，其中最常用的就是 <code>List</code>，但這與 C# 的 <code>List&lt;T&gt;</code> 不同，反而類似 C# 的 <code>ImmutableList&lt;T&gt;</code>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="Definition">Definition</h2><hr>
<blockquote>
<p>List</p>
<p>將相同型別的 value 整合成單一 value，且每個 element 必須為 immutable</p>
</blockquote>
<p>簡單來說，F# 的 List 就是 linked list 資料結構，為了實現 FP 的 Immutability，每個 element 建立後就不可再修改。</p>
<h2 id="建立_List">建立 List</h2><hr>
<h3 id="List_Literal">List Literal</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<p>List 使用 <code>[]</code> 中括號表示，element 之間以 <code>;</code> 隔開。</p>
<p><img src="/images/fsharp/list/list000.png" alt="list000"></p>
<ol>
<li>List 天生就是泛型，不過並不需要如 C# 宣告泛型型別 <code>List&lt;int&gt;</code>，Type Inference 會自動推導出 <code>int list</code>。</li>
</ol>
<blockquote>
<p>F# 的型別都是寫在後面，不過 List 例外，element 型別寫在 list 前面</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [</span><br><span class="line">    <span class="number">1</span> <span class="comment">// Number one</span></span><br><span class="line">    <span class="number">2</span> <span class="comment">// Number two</span></span><br><span class="line">    <span class="number">3</span> <span class="comment">// Number three</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3;]</span></span><br></pre></td></tr></table></figure>
<p>List 也可以使用換行的方式，此時可以不用加 <code>;</code> 隔開，適用於 element 量較多時，或需要在 element 加上註解時。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 : Control list = [ <span class="keyword">new</span> Button(); <span class="keyword">new</span> CheckBox() ]</span><br></pre></td></tr></table></figure>
<p>List 的 element 必須相同型別，若 element 是物件時，則有例外。基於 <code>里氏替換原則</code>，若 element 的型別為 <code>父類別</code> 或 <code>interface</code> 時，則 element 允許基於相同 <code>父類別</code> 或 <code>interface</code> 的物件。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = []</span><br></pre></td></tr></table></figure>
<p>空 list 則以 <code>[]</code> 表示。</p>
<h3 id="List_Range">List Range</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">10</span> ]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4; 5; 6; 7; 8; 9; 10]</span></span><br></pre></td></tr></table></figure>
<p>若 list 的資料有規律性，則不必全部列出，可使用 <code>..</code>，只要列出頭跟尾即可。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">2</span> .. <span class="number">10</span> ]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 3; 5; 7; 9]</span></span><br></pre></td></tr></table></figure>
<p>若 list 資料為 <code>等差級數</code>，則可在 <code>..</code> 與 <code>..</code> 之間加上 step value，其中 step value 也可以是 <code>負數</code>。</p>
<h3 id="List_Comprehension">List Comprehension</h3><p>若資料的變化性更大，已經無法單純使用 List Range 描述，則可使用更進階的 List Comprehension 表示。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">yield</span> i * i</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 4; 9; 16; 25; 36; 49; 64; 81; 100]</span></span><br></pre></td></tr></table></figure>
<p>直接將 <code>for ... in … do</code> 寫在 <code>[]</code> 之內，<code>yield</code> 的 expression 即為 element。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [<span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span> -&gt; i * i]</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 4; 9; 16; 25; 36; 49; 64; 81; 100]</span></span><br></pre></td></tr></table></figure>
<p>亦可將 <code>do yield</code> 省略，直接將 <code>for ... in ... -&gt;</code> 寫在 <code>[]</code> 內，將 expression 寫在 <code>-&gt;</code> 之後。</p>
<blockquote>
<p>對於簡單的 expression，建議使用 <code>for ... in ... -&gt;</code> 語法較精簡，若還需更複雜的描述，則必須使用 <code>for ... in ... do yield</code></p>
</blockquote>
<h3 id="List-init">List.init</h3><p>根據 index 值建立新的 list</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = List.init <span class="number">10</span> (<span class="keyword">fun</span> idx -&gt; idx * idx)</span><br><span class="line"></span><br><span class="line">list1</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 1; 4; 9; 16; 25; 36; 49; 64; 81]</span></span><br></pre></td></tr></table></figure>
<h2 id="List_Operator">List Operator</h2><hr>
<h3 id="::_Operator">:: Operator</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = <span class="number">0</span> :: list1</span><br><span class="line"></span><br><span class="line">list2</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [0; 1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<p>將 value 加到 <code>:</code> 之前， 將加到 list 最前面。</p>
<h3 id="@_Operator">@ Operator</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span>; <span class="number">2</span>; <span class="number">3</span> ]</span><br><span class="line"><span class="keyword">let</span> list2 = [ <span class="number">4</span>; <span class="number">5</span>; <span class="number">6</span> ]</span><br><span class="line"><span class="keyword">let</span> list3 = list1 @ list2</span><br><span class="line"></span><br><span class="line">list3</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [1; 2; 3; 4; 5; 6]</span></span><br></pre></td></tr></table></figure>
<p><code>@</code> 將兩個 list 合併為一個 list。</p>
<h2 id="Property">Property</h2><p>List 本身提供了不少 property 可用。</p>
<h3 id="Head">Head</h3><blockquote>
<p>獲得 List 第 1 個 element。</p>
<p><code>&#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">printf <span class="string">"%d"</span> list1.Head</span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h3 id="Tail">Tail</h3><blockquote>
<p>獲得第 1 個 element 除外，剩下的 list</p>
<p><code>&#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">list1.Tail</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// [2; 3]</span></span><br></pre></td></tr></table></figure>
<p>就算 Tail 只剩下 1 個 element，仍然是 1 個 element 的 list。</p>
<h3 id="IsEmpty">IsEmpty</h3><blockquote>
<p>判斷 list 是否為空</p>
<p><code>bool</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">2</span> ]</span><br><span class="line"></span><br><span class="line">printf <span class="string">"%b"</span> list1.IsEmpty</span><br><span class="line"><span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h3 id="Item">Item</h3><blockquote>
<p>傳回指定 index 的 element 值</p>
<p><code>&#39;T</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">printf <span class="string">"%d"</span> (list1.Item <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>List 的 index 為 zero-based。</p>
<h3 id="Length">Length</h3><blockquote>
<p>獲得 list 的 element 個數</p>
<p><code>int</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">printf <span class="string">"%d"</span> list1.Length</span><br></pre></td></tr></table></figure>
<h2 id="Static_Method">Static Method</h2><hr>
<h3 id="List-Cons">List.Cons</h3><blockquote>
<p>將 value 加到 list 最前面，產生新的 list，相當於 <code>::</code> operator</p>
<p><code>head: &#39;T * tail: &#39;T list -&gt; &#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list1 = [ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line"></span><br><span class="line">List.Cons (<span class="number">0</span>, list1)</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [0; 1; 2; 3]</span></span><br></pre></td></tr></table></figure>
<p><code>List.Cons()</code> 傳入為一 tuple，第 1 個 element 為 value，第 2 個 element 為 list。</p>
<h3 id="List-Empty">List.Empty</h3><blockquote>
<p>根據 list type 回傳一個 empty list</p>
<p><code>&#39;T list</code></p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">myList</span> </span>= int list</span><br><span class="line"></span><br><span class="line">myList.Empty</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Q : List.Empty 與 List.empty 有何差異？</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List.empty&lt;int&gt;</span><br><span class="line">|&gt; printf <span class="string">"%A"</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>
<p><strong>相同</strong></p>
<ul>
<li>均回傳 empty list</li>
</ul>
<p><strong>相異</strong></p>
<ul>
<li><code>List.Empty</code> 為 <code>List</code> type 的 static method；<code>List.empty()</code> 定義在 List module</li>
<li><code>List.Empty</code> 須先定義 type；<code>List.empty()</code> 可由泛型直接指定 element type</li>
</ul>
<h2 id="Recursive_Function">Recursive Function</h2><hr>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">rec</span> sum list =</span><br><span class="line">   <span class="keyword">match</span> list <span class="keyword">with</span></span><br><span class="line">   | head :: tail -&gt; head + sum tail</span><br><span class="line">   | [] -&gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">[ <span class="number">1</span> .. <span class="number">3</span> ]</span><br><span class="line">|&gt; sum</span><br><span class="line">|&gt; printf <span class="string">"%d"</span></span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>List 在配合 recursive function 時，在 Pattern Matching 常搭配 <code>head :: tail</code>，直接將 list 拆成兩半，然後將 <code>tail</code> 傳入 recursive function 繼續運算。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>List 為 F# 最常用的 collection，概念雖然不難，但有一些 F# 獨特的語法，還是得花一點時間熟悉</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://docs.microsoft.com/en-us/" target="_blank" rel="external">Microsoft Docs</a>, <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/lists" target="_blank" rel="external">Lists</a><br><a href="https://en.wikibooks.org/" target="_blank" rel="external">Wikibooks</a>, <a href="https://en.wikibooks.org/wiki/F_Sharp_Programming/Lists" target="_blank" rel="external">F Sharp Programming/Lists</a><br><a href="https://blogs.msdn.microsoft.com/chrsmith/author/chrsmith/" target="_blank" rel="external">Chris Smith</a>, <a href="https://blogs.msdn.microsoft.com/chrsmith/2008/07/10/mastering-f-lists/" target="_blank" rel="external">Mastering F# Lists</a><br><a href="http://www.oreilly.com/pub/au/3667" target="_blank" rel="external">Chris Smith</a>, <a href="http://shop.oreilly.com/product/0636920024033.do" target="_blank" rel="external">Pramming F# 3.0 2nd</a></p>
]]></content>
    <summary type="html">
    <![CDATA[探討 List 的各種語法]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何動態切換 Service？]]></title>
    <link href="http://oomusou.io/angular/multi-provider/"/>
    <id>http://oomusou.io/angular/multi-provider/</id>
    <published>2018-04-04T13:23:43.000Z</published>
    <updated>2018-04-04T13:27:38.707Z</updated>
    <content type="html"><![CDATA[<p>Angular 提供 DI，讓我們能以依賴注入的方式將 servie 注入，若我們無法在 compile-time 就決定要注入的 service，一直要到 run-time 才能決定，我們該如何在 run-time 動態切換 service 呢？</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.4<br>WebStorm 2018.1<br>Node.js 8.9.4<br>Angular CLI 1.7.3<br>Angular 5.2.8</p>
<h2 id="User_Story">User Story</h2><hr>
<p><img src="/images/angular/multi-provider/di001.png" alt="di001"></p>
<p>User 使用下拉選單選擇 service。</p>
<p><img src="/images/angular/multi-provider/di000.png" alt="di000"></p>
<p>共有 <code>AWS</code>、<code>Azure</code> 與 <code>GCP</code> 三個雲端服務可供選擇，但無論選擇哪個 service，都只能在 run-time 決定，而無法在 compile-time 決定，此時 DI 該注入哪一個 service 呢？</p>
<h2 id="Task">Task</h2><hr>
<p>根據 user 的需求，動態切換 service。</p>
<h2 id="Architecture">Architecture</h2><hr>
<p><img src="/images/angular/multi-provider/di002.svg" alt="di002"></p>
<ul>
<li><strong>AppComponent</strong>：Angular 的 component</li>
<li><strong>ServiceFactory</strong>：負責將 user 選擇的 service 傳回，使用 DI 注入進 component</li>
<li><strong>ServiceInterface</strong>：所有 service 共同的 interface</li>
<li><strong>AWSService</strong>：負責 <code>AWS</code> 功能的 service</li>
<li><strong>AzureService</strong>：負責 <code>Azure</code> 功能的 service</li>
<li><strong>GCPService</strong>：負責 <code>GCP</code> 功能的 service</li>
</ul>
<h2 id="Implementation">Implementation</h2><hr>
<p><strong>app.component.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">select</span> (<span class="attribute">change</span>)=<span class="value">"onChange()"</span> #<span class="attribute">mySelect</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">option</span> *<span class="attribute">ngFor</span>=<span class="value">"let service of services"</span> [<span class="attribute">value</span>]=<span class="value">"service.name"</span>&gt;</span>&#123;&#123; service.name &#125;&#125;<span class="tag">&lt;/<span class="title">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在 HTML 提供 <code>&lt;select&gt;</code> 選擇 service，結果會顯示在 <code>message</code>。</p>
<h3 id="AppComponent">AppComponent</h3><p><img src="/images/angular/multi-provider/di003.svg" alt="di003"></p>
<p><strong>app.component.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ElementRef, ViewChild &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Service &#125; from <span class="string">'./models/service.model'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceInterface &#125; from <span class="string">'./interfaces/service.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceFactory &#125; from <span class="string">'./services/service.factory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'./enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: <span class="string">'app-root'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./app.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./app.component.css'</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  services: Service[] = [</span><br><span class="line">    &#123; name: ServiceEnum.NULL &#125;,</span><br><span class="line">    &#123; name: ServiceEnum.AWS &#125;,</span><br><span class="line">    &#123; name: ServiceEnum.Azure &#125;,</span><br><span class="line">    &#123; name: ServiceEnum.GCP &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  message = <span class="string">'Please select service'</span>;</span><br><span class="line"></span><br><span class="line">  @ViewChild(<span class="string">'mySelect'</span>)</span><br><span class="line">  <span class="keyword">private</span> mySelect: ElementRef;</span><br><span class="line">  <span class="keyword">private</span> service: ServiceInterface;</span><br><span class="line"></span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(private serviceFactory: ServiceFactory) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  onChange() &#123;</span><br><span class="line">    <span class="keyword">const</span> serviceName = <span class="keyword">this</span>.mySelect.nativeElement.value;</span><br><span class="line">    <span class="keyword">this</span>.service = <span class="keyword">this</span>.serviceFactory.createService(serviceName);</span><br><span class="line">    <span class="keyword">this</span>.message = <span class="keyword">this</span>.service.getMessage();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>24 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> service: ServiceInterface;</span><br></pre></td></tr></table></figure>
<p>重點在 <code>service</code> 無法由 compile-time 決定，要由 user 在 run-time 選擇，因此 constructor 要 DI 注入什麼則面臨挑戰。</p>
<p>26 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor"><span class="keyword">constructor</span>(private serviceFactory: ServiceFactory) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>既然無法在 compile-time 決定要注入什麼 service，那就改注入 <code>ServiceFactory</code>，由 <code>不變</code> 的 <code>ServiceFactory</code> 幫我們決定 <code>變動</code> 的 service。</p>
<p>30 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.service = <span class="keyword">this</span>.serviceFactory.createService(serviceName);</span><br><span class="line"><span class="keyword">this</span>.message = <span class="keyword">this</span>.service.getMessage();</span><br></pre></td></tr></table></figure>
<p>由 <code>ServiceFactory.createService()</code> 根據 user 在 run-time 所選擇的 service 名稱，回傳正確的 service。</p>
<blockquote>
<p><code>AppComponent</code> 改注入 <code>ServiceFactory</code> 後，最少 <code>AppComponent</code> 已經符合 <code>開放封閉原則</code>，將來無論新增任何 service，<code>AppComponent</code>都不用再做任何修改</p>
</blockquote>
<h3 id="ServiceFactory">ServiceFactory</h3><p><img src="/images/angular/multi-provider/di004.svg" alt="di004"></p>
<p><strong>service.factory.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ServiceInterface &#125; from <span class="string">'../interfaces/service.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceToken &#125; from <span class="string">'../tokens/service.token'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Inject, Injectable &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'../enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ServiceFactory &#123;</span><br><span class="line">  <span class="constructor"><span class="keyword">constructor</span>(@Inject(ServiceToken) private services: ServiceInterface[]) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  createService(name: ServiceEnum): ServiceInterface &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.services</span><br><span class="line">               .filter(item =&gt; item.getName() === name)[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第 8 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor"><span class="keyword">constructor</span>(@Inject(ServiceToken) private services: ServiceInterface[]) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將符合 <code>ServiceInterface</code> 的所有物件都注入，注意 <code>services</code> 的型別是  <code>ServiceInterface[]</code>。</p>
<p>該如何一次注入所有實現 <code>ServiceInterface</code> 的 service 呢？會在 <code>AppModule</code> 動手腳，稍後會說明。</p>
<p>11 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createService(name: ServiceEnum): ServiceInterface &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.services</span><br><span class="line">               .filter(item =&gt; item.getName() === name)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因為 <code>services</code> 包含所有的 service，使用 <code>filter()</code> 找到符合 user 選擇的 service 並回傳。</p>
<h3 id="ServiceInterface">ServiceInterface</h3><p><img src="/images/angular/multi-provider/di005.svg" alt="di005"></p>
<p><strong>service.interface.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'../enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="interface"><span class="keyword">interface</span> ServiceInterface </span>&#123;</span><br><span class="line">  getName(): ServiceEnum;</span><br><span class="line">  getMessage(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有 service 共同遵守的 interface，共有 <code>getName()</code> 與 <code>getMessage()</code> 兩個 method。</p>
<h3 id="AWSService">AWSService</h3><p><img src="/images/angular/multi-provider/di006.svg" alt="di006"></p>
<p><strong>aws.service.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceInterface &#125; from <span class="string">'../interfaces/service.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'../enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AWSService <span class="keyword">implements</span> ServiceInterface &#123;</span><br><span class="line">  getName(): ServiceEnum &#123;</span><br><span class="line">    <span class="keyword">return</span> ServiceEnum.AWS;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getMessage(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'You have selected AWS service'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AWSService</code> 實現 <code>ServiceInterface</code> 所定義的 method。</p>
<h3 id="AzureService">AzureService</h3><p><img src="/images/angular/multi-provider/di007.svg" alt="di007"></p>
<p><strong>azure.service.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceInterface &#125; from <span class="string">'../interfaces/service.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'../enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AzureService <span class="keyword">implements</span> ServiceInterface &#123;</span><br><span class="line">  getName(): ServiceEnum &#123;</span><br><span class="line">    <span class="keyword">return</span> ServiceEnum.Azure;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getMessage(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'You have selected Azure service'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AzureService</code> 實現 <code>ServiceInterface</code> 所定義的 method。</p>
<h3 id="GCPService">GCPService</h3><p><img src="/images/angular/multi-provider/di008.svg" alt="di008"></p>
<p><strong>gcp.service.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceInterface &#125; from <span class="string">'../interfaces/service.interface'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceEnum &#125; from <span class="string">'../enums/service.enum'</span>;</span><br><span class="line"></span><br><span class="line">@Injectable()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> GcpService <span class="keyword">implements</span> ServiceInterface &#123;</span><br><span class="line">  getName(): ServiceEnum &#123;</span><br><span class="line">    <span class="keyword">return</span> ServiceEnum.GCP;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getMessage(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'You have selected GCP service'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>GcpService</code> 實現 <code>ServiceInterface</code> 所定義的 method。</p>
<h3 id="AppModule">AppModule</h3><p><strong>app.module.ts</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserModule &#125; from <span class="string">'@angular/platform-browser'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; from <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; from <span class="string">'./app.component'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AWSService &#125; from <span class="string">'./services/aws.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceToken &#125; from <span class="string">'./tokens/service.token'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AzureService &#125; from <span class="string">'./services/azure.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; GcpService &#125; from <span class="string">'./services/gcp.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ServiceFactory &#125; from <span class="string">'./services/service.factory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NullService &#125; from <span class="string">'./services/null.service'</span>;</span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule</span><br><span class="line">  ],</span><br><span class="line">  providers: [</span><br><span class="line">    ServiceFactory,</span><br><span class="line">    &#123; provide: ServiceToken, useClass: NullService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">    &#123; provide: ServiceToken, useClass: AWSService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">    &#123; provide: ServiceToken, useClass: AzureService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">    &#123; provide: ServiceToken, useClass: GcpService, multi: <span class="literal">true</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>20 行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; provide: ServiceToken, useClass: NullService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">&#123; provide: ServiceToken, useClass: AWSService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">&#123; provide: ServiceToken, useClass: AzureService, multi: <span class="literal">true</span>&#125;,</span><br><span class="line">&#123; provide: ServiceToken, useClass: GcpService, multi: <span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>
<p>該如何讓符合 <code>ServiceInterface</code> 的 service 在 <code>ServiceFactory</code> 一次全部注入呢 ? 關鍵就在 <code>AppModule</code> 的 provider 加上 <code>multi: true</code>，則所有相同 interface 的 service 將以 array 的方式一次全部注入。</p>
<h2 id="Summary">Summary</h2><hr>
<ul>
<li><code>AppComponent</code> 由原本注入 service 改注入 <code>ServiceFactory</code></li>
<li>由 <code>ServiceFactory</code> 將所有相同 interface 的 service 全部注入</li>
<li>由 <code>ServiceFactory.CreateService()</code> 決定要 <code>filter()</code> 哪個 service 給 client</li>
<li>將來若有新的 service 新增，只需繼續根據 <code>ServiceInterface</code> 新增 service，並在 <code>AppModule</code> 補上 provider，其他程式碼都不必修改，符合 <code>開放封閉原則</code> 的要求</li>
</ul>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>本文的做法，與原本動態 DI 注入的理想還有段距離，但藉由在相同 token 的 multi provider，讓相同 interface 的所有 service 都能一起注入在 <code>ServiceFactory</code>，這樣最少 component 符合 <code>開放封閉原則</code>，將來維護也方便</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/NG52DynamicDI" target="_blank" rel="external">GitHub</a> 上找到</p>
]]></content>
    <summary type="html">
    <![CDATA[使用 Multi Provider]]>
    
    </summary>
    
      <category term="Angular" scheme="http://oomusou.io/tags/Angular/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入探討 F# 之 Tuple]]></title>
    <link href="http://oomusou.io/fsharp/tuple/"/>
    <id>http://oomusou.io/fsharp/tuple/</id>
    <published>2018-04-04T12:23:43.000Z</published>
    <updated>2018-04-04T06:32:07.242Z</updated>
    <content type="html"><![CDATA[<p><code>Tuple</code> 是 FP 語言常見的型別，且 C# 7.0 也開始有 <code>Tuple</code>，讓我們藉由 F# 學習該如何活用 <code>Tuple</code>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="Definition">Definition</h2><hr>
<blockquote>
<p>Tuple</p>
<p>將不同型別的 value 整合成單一 value</p>
</blockquote>
<p>在將不同型別整合成單一型別，F# 提供了 3 種方式：</p>
<ol>
<li><p>Tuple</p>
</li>
<li><p>Record</p>
</li>
<li><p>Union</p>
</li>
</ol>
<p>其中 <code>Tuple</code> 與 <code>Record</code> 提供類似 AND 的方式將不同型別加以整合，而 <code>Union</code> 則提供類似 OR 的方式將不同型別加以整合。<span class="margin-note-marker"><sup>1</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">1</span>關於 F# 的 Union，詳細請參考 <a href="http://0.0.0.0:4000/fsharp/union/" target="_blank" rel="external">深入探討 F# 之 Discriminated Union</a></span></span></span></p>
<p><code>Record</code> 與 <code>Tuple</code> 的差異在於 <code>Record</code> 為 named type，須事先定義型別，而 <code>Tuple</code> 則為  unmamed type，可直接使用，Type Inference 會幫我們推導出 <code>Tuple</code> 型別。</p>
<h2 id="建立_Tuple">建立 Tuple</h2><hr>
<h3 id="相同型別">相同型別</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dinner = (<span class="string">"green eggs"</span>, <span class="string">"ham"</span>)</span><br></pre></td></tr></table></figure>
<p>將 <code>green eggs</code> 與 <code>ham</code> 兩個 string 整合成一個 <code>dinner</code> tuple。</p>
<p><img src="/images/fsharp/tuple/tuple000.png" alt="uple00"></p>
<p>Type Inference 自動推導出 <code>dinner</code> tuple 為 <code>string * string</code>。</p>
<p><code>Tuple</code> 型別表示法，是以 <code>*</code> 串接各型別，因為 <code>Tuple</code> 概念是 AND，所以使用 <code>*</code>。</p>
<h3 id="不同型別">不同型別</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dinner = (<span class="string">"green eggs"</span>, <span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<p>若只是將  tuple 用在相同型別，則顯示不出  tuple 的威力，相同型別大可使用 <code>Array</code> 或 <code>List</code> ，tuple  讓我們可以將 <code>不同型別</code> 包在同一個  tuple。</p>
<p><img src="/images/fsharp/tuple/tuple001.png" alt="uple00"></p>
<p>Type Inference 自動推導出 <code>dinner</code> tuple 為 <code>string * int</code>。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nested = (<span class="number">1</span>, (<span class="number">2.0</span>, <span class="number">3</span>M), (<span class="number">4</span>L, <span class="string">"5"</span>, '<span class="number">6</span>'))</span><br></pre></td></tr></table></figure>
<p>甚至也可以巢狀的方式使用 tuple。</p>
<h2 id="分解_Tuple">分解 Tuple</h2><hr>
<p>Tuple 將不同 value 整合單一 tuple 後，馬上會遇到另外一個問題：</p>
<blockquote>
<p>Q：如何將單一 tuple 分解成 value？</p>
</blockquote>
<p>F# 提供 3 種方式：</p>
<ul>
<li><code>fst()</code> 與 <code>snd()</code></li>
<li>Let Binding</li>
<li>Pattern Matching</li>
</ul>
<h3 id="fst()_與_snd()">fst() 與 snd()</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = (<span class="string">"John"</span>, <span class="string">"Smith"</span>)</span><br><span class="line"></span><br><span class="line">printfn <span class="string">"%s"</span> (fst students)</span><br><span class="line">printfn <span class="string">"%s"</span> (snd students)</span><br></pre></td></tr></table></figure>
<p>若只是兩個 element 的 tuple，可使用 <code>fst()</code> 與 <code>snd()</code> function 分解 tuple。</p>
<blockquote>
<p>沒有 <code>trd()</code>，但可自行建立 <code>let trd (_, _, z) = z</code></p>
</blockquote>
<h3 id="Let_Binding">Let Binding</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = (<span class="string">"John"</span>, <span class="string">"Smith"</span>, <span class="string">"Jessie"</span>)</span><br><span class="line"><span class="keyword">let</span> student1, student2, student3 = students</span><br><span class="line"></span><br><span class="line">printfn <span class="string">"%s, %s, %s"</span> student1 student2 student3</span><br></pre></td></tr></table></figure>
<p>直接使用 <code>let</code>，會自動將 tuple 分解到各別 value，也沒 element 數限制。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = (<span class="string">"John"</span>, <span class="string">"Smith"</span>, <span class="string">"Jessie"</span>)</span><br><span class="line"><span class="keyword">let</span> student1, student2, _ = students</span><br><span class="line"></span><br><span class="line">printfn <span class="string">"%s, %s"</span> student1 student2</span><br></pre></td></tr></table></figure>
<p>若只需部分 element，可使用 <code>_</code> 忽略之。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = (<span class="string">"John"</span>, <span class="string">"Smith"</span>, <span class="string">"Jessie"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> print (student1, student2, student3) = </span><br><span class="line">    printfn <span class="string">"%s %s %s"</span> student1 student2 student3</span><br><span class="line">    </span><br><span class="line">students</span><br><span class="line">|&gt; print</span><br></pre></td></tr></table></figure>
<p>當 tuple 傳進 function 參數時，可直接分解成 value。</p>
<h3 id="Pattern_Matching">Pattern Matching</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = (<span class="string">"John"</span>, <span class="string">"Smith"</span>, <span class="string">"Jessie"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> print students = </span><br><span class="line">    <span class="keyword">match</span> students <span class="keyword">with</span></span><br><span class="line">    | (student1, student2, student3) -&gt; printfn <span class="string">"%s %s %s"</span> student1 student2 student3</span><br><span class="line">    </span><br><span class="line">students</span><br><span class="line">|&gt; print</span><br></pre></td></tr></table></figure>
<p>亦可使用 Pattern Matching 對 tuple 加以分解。</p>
<h2 id="活用_Tuple">活用 Tuple</h2><hr>
<h3 id="將_Tuple_當成參數">將 Tuple 當成參數</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = (<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> add (x, y, z) = x + y + z</span><br><span class="line">    </span><br><span class="line">values</span><br><span class="line">|&gt; add</span><br><span class="line">|&gt; printfn <span class="string">"%d"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 9</span></span><br></pre></td></tr></table></figure>
<p><code>values</code> 為 tuple，而 <code>add()</code> 為 <code>int * int * int -&gt; int</code>。</p>
<p>當 <code>values</code> 傳進 <code>add()</code> 時，會自動分解成 <code>x</code> 、 <code>y</code> 與 <code>z</code>。</p>
<blockquote>
<p>Tuple vs. Partial Function Application</p>
</blockquote>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> add1 x y z = x + y + z</span><br><span class="line"><span class="keyword">let</span> add2 (x, y, z) = x + y + z</span><br></pre></td></tr></table></figure>
<p>雖然都是 <code>x + y + z</code>，但 <code>add1()</code> 與 <code>add2()</code> 意義完全不同。</p>
<p><code>add1()</code> 為 <code>int -&gt; int -&gt; int -&gt; int</code>。</p>
<p><code>add2()</code> 為 <code>int * int * int -&gt; int</code>。</p>
<p><code>add1()</code> 可使用 Partial Function Application 方式使用，也就是若只傳一個參數 <code>int</code>，將回傳 <code>int -&gt; int -&gt; int</code> function，若傳入兩個參數 <code>int</code>，將回傳 <code>init -&gt; int</code> function。</p>
<p><code>add2()</code> 則必須一次傳入整個 tuple，不能只傳 <code>部分參數</code>。</p>
<blockquote>
<p>Ｑ：我該使用 Tuple 或  Partial Function Application 呢？</p>
</blockquote>
<ul>
<li>完全視 <code>設計考量</code> 與 <code>語意</code></li>
<li>Partial Function Application 使用上會比 Tuple 靈活</li>
<li>若你不希望被當成 Partial Function Application 使用，則使用 Tuple。</li>
</ul>
<h3 id="將_Tuple_當成回傳值">將 Tuple 當成回傳值</h3><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> divRem a b =</span><br><span class="line">   <span class="keyword">let</span> x = a / b</span><br><span class="line">   <span class="keyword">let</span> y = a % b</span><br><span class="line">   (x, y)</span><br></pre></td></tr></table></figure>
<p>有些 function 會希望一次回傳多個值，如 <code>兩數相除</code>，會希望同時傳回 <code>商數</code> 與 <code>餘數</code>。</p>
<p>傳統程式語言我們會回傳 <code>Array</code> 或 <code>List</code>，但有相同型別的限制；在 OOP 我們會回傳 <code>Object</code>，但必須事先建立 class；但在 FP 我們可回傳 <code>Tuple</code>。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>Tuple 不用事先定義型別，可以直接使用，特別適合 function 只使用一次的 <code>參數</code> 或 <code>回傳值</code> 型別</li>
<li>在 OOP，若我們想將 <code>多個參數</code> 合併成 <code>單一參數</code>，或將 <code>多回傳值</code> 合併成 <code>單一回傳值</code>，我們必須使用 <code>Object</code>，但常常糾結是否該特別開一個 class 型別；但在 FP，我們可以隨時使用 tuple，也能享受 compile 強型別的檢查</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://docs.microsoft.com/en-us/" target="_blank" rel="external">Microsoft Docs</a>, <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/tuples" target="_blank" rel="external">Tuples</a><br><a href="https://fsharpforfunandprofit.com/" target="_blank" rel="external">F# for fun and profit</a>, <a href="https://fsharpforfunandprofit.com/posts/tuples/" target="_blank" rel="external">Tuples</a><br><a href="http://www.oreilly.com/pub/au/3667" target="_blank" rel="external">Chris Smith</a>, <a href="http://shop.oreilly.com/product/0636920024033.do" target="_blank" rel="external">Pramming F# 3.0 2nd</a></p>
]]></content>
    <summary type="html">
    <![CDATA[學習 FP 如何使用 Tuple]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 SonarQube 檢查 Angular 專案？]]></title>
    <link href="http://oomusou.io/sonarqube/angular/"/>
    <id>http://oomusou.io/sonarqube/angular/</id>
    <published>2018-04-03T13:23:43.000Z</published>
    <updated>2018-04-04T06:08:51.900Z</updated>
    <content type="html"><![CDATA[<p>SonarQube 是一套 <code>程式碼品質檢查工具</code>，可以幫我們檢查 code 的 bugs、 vulenrability、code smell 與 duplication，也屬於 <code>持續整合</code> 重要的一環。</p>
<p>SonarQube 已經內建 SonarTS，可以直接對 TypeScript 進行檢查，本文將以 Angular 為例，並搭配 Jenkins 自動執行 SonarQube，將結果通知 Slack。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.4<br>SonarQube 6.7.2 LTS<br>Jenkins 2.107.1<br>Slack 3.0.5<br>Angular 5.2.9</p>
<h2 id="GitHub">GitHub</h2><hr>
<p>將 Angular 專案放到 GitHub。</p>
<p><img src="/images/sonarqube/angular/slack000.png" alt="lack00"></p>
<ol>
<li>本文將 Angular 專案放在 <code>https://github.com/oomusou/NG52JenkinsSonarQubeSlack</code></li>
</ol>
<blockquote>
<p>當然也可以將 git repository 放在不同的 git server，如 Bitbucket</p>
</blockquote>
<h2 id="SonarQube">SonarQube</h2><hr>
<p><strong>安裝 SonarQube</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>update</span><br><span class="line">$ <span class="keyword">brew </span>install sonarqube</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 SonarQube。</p>
<p><img src="/images/sonarqube/angular/slack001.png" alt="lack00"></p>
<ol>
<li>輸入 <code>brew install sonarqube</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 SonarQube，輸入 <code>brew services start sonarqube</code></li>
<li>若想自行啟動 SonarQube，輸入 <code>sonar console</code></li>
</ol>
<p><strong>啟動 SonarConsole</strong><br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sonar <span class="built_in">console</span></span><br></pre></td></tr></table></figure></p>
<p>使用 <code>sonar console</code> 自行啟動 SonarQube。</p>
<p><img src="/images/sonarqube/angular/slack002.png" alt="lack00"></p>
<ol>
<li>輸入 <code>sonar console</code> 自行啟動 SonarQube</li>
</ol>
<p><strong>測試 SonarQube</strong></p>
<p><img src="/images/sonarqube/angular/slack003.png" alt="lack00"></p>
<ol>
<li>輸入 <code>localhost:9000</code>，若看到 SonarQube 首頁，則表示安裝成功</li>
<li>右上角 <code>Log in</code> 可登入管理設定 SonarQube，預設為 <code>admin/admin</code></li>
</ol>
<h2 id="SonarQube_Scanner">SonarQube Scanner</h2><hr>
<p>SonarQube 雖然已經包含 SonarTS，但必須靠 SonarQube Scanner 才能執行，預設 SonarQube 並沒有包含 Scanner，必須自行安裝。</p>
<p><strong>下載 Scanner</strong></p>
<p><img src="/images/sonarqube/angular/slack004.png" alt="hp00"></p>
<p>到 <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a> 下載 Scanner，選擇 <code>Mac OS X 64 bit</code> 下載。</p>
<p><img src="/images/sonarqube/angular/slack005.png" alt="lack00"></p>
<p>下載後為一 <code>zip</code> 壓縮檔，解壓縮後可安裝在任何目錄。</p>
<p><img src="/images/sonarqube/angular/slack006.png" alt="lack00"></p>
<ol>
<li>選擇 home directory</li>
<li>將 <code>sonar-scanner-3.1.0.1141-macosx</code> 放在 home directory 下</li>
</ol>
<p><strong>設定 Server</strong></p>
<p><strong>sonar-scanner.properties</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#----- Default SonarQube server</span><br><span class="line">sonar<span class="class">.host</span><span class="class">.url</span>=http:<span class="comment">//localhost:9000</span></span><br></pre></td></tr></table></figure>
<p>設定 SonarQube server 位址，並將 <code>#</code> 註解拿掉。</p>
<p><img src="/images/sonarqube/angular/slack007.png" alt="lack00"></p>
<ol>
<li><code>sonar-scanner.properties</code> 位於 <code>sonar-scanner-3.1.0.1141-macosx/conf/</code> 目錄下</li>
</ol>
<p><strong>測試 Scanner</strong></p>
<p>將 SonarQube Scanner 加到 system path。</p>
<p><strong>.zshrc</strong><br><img src="/images/sonarqube/angular/slack008.png" alt="lack00"></p>
<ol>
<li>將 <code>~/sonar-scanner-3.1.0.1141-macosx/bin</code> 目錄加到 system path</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=Angular52 -Dsonar.sources=. -Dsonar.projectName=Angular52 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>sonar-scanner</code> 對 Laravel 專案進行檢查。</p>
<ul>
<li><strong>-D</strong> : 對 SonarQube 的 property 進行設定</li>
<li><strong>sonar.projectKey</strong>：SonarQube 對專案的 key，內部將以此 key 作為辨別，必須唯一</li>
<li><strong>sonar.sources</strong>：SonarQube 要檢查的目錄，因為已經在專案目錄下，<code>.</code> 即為 <code>目前目錄</code></li>
<li><strong>sonar.projectName</strong>：在 SonarQube 網頁上顯示的名稱</li>
<li><strong>sonar.projectVersion</strong>：在 SonarQube 網頁上顯示的版本編號</li>
</ul>
<p><img src="/images/sonarqube/angular/slack009.png" alt="lack00"></p>
<ol>
<li>在專案目錄下輸入 <code>sonar-scanner</code> 檢查 TypeScript</li>
</ol>
<p><img src="/images/sonarqube/angular/slack010.png" alt="lack01"></p>
<ol>
<li>若能看到 <code>EXECUTION SUCCESS</code>，則表示 SonarQube Scanner 安裝成功</li>
</ol>
<p><img src="/images/sonarqube/angular/slack011.png" alt="lack01"></p>
<p>進入 SonarQube 網頁，就可看到 <code>Angular52</code> 專案已經出現 SonarQube。</p>
<p>到目前為止，SonarQube 對 TypeScript 的檢查已經完成，就算只將 SonarQube 裝在本機，也對 TypeScript 程式碼品質的檢查有很大的幫助。</p>
<p>若每次 SonarQube 檢查完，都能將結果送到 Slack，讓 Slack 成為實質的 <code>持續整合</code> 中心，那就太好了。</p>
<blockquote>
<p>Q：Angular 專案有 <code>node_modules</code> 目錄，不需如 Lavavel 專案去排除 <code>vendor</code> 目錄嗎？</p>
</blockquote>
<p><img src="/images/sonarqube/angular/slack050.png" alt="lack05"></p>
<p><strong><em>Administration -&gt; TypeScript</em></strong></p>
<p>預設已經排除了 <code>node_modules</code>，所以不須在 <code>sonar-scanner</code> 下特別指定。</p>
<h2 id="Slack">Slack</h2><hr>
<p><strong>新增 Channel</strong></p>
<p><img src="/images/sonarqube/angular/slack012.png" alt="lack01"></p>
<ol>
<li>按下 <code>Channels</code> 右側的 <code>+</code> 新增 channel</li>
</ol>
<p><img src="/images/sonarqube/angular/slack013.png" alt="lack01"></p>
<ol>
<li><strong>Privacy</strong> : 設定為 <code>Public</code> 或 <code>Private</code> channel</li>
<li><strong>Name</strong> : 設定 channel 名稱</li>
<li><strong>Purpose</strong> : channel 的功能描述，可以不輸入</li>
<li><strong>Send invites to</strong> : 設定 channel 成員，可以稍後再設定</li>
<li>按 <code>Create Channel</code> 開始建立 channel</li>
</ol>
<p><img src="/images/sonarqube/angular/slack014.png" alt="lack01"></p>
<ol>
<li>按 <code>Got It!</code> 進入 channel</li>
</ol>
<p><img src="/images/sonarqube/angular/slack015.png" alt="lack01"></p>
<ol>
<li>正式進入 channel，將來 SonarQube 訊息會傳進此 channel</li>
</ol>
<p><strong>新增 Notification</strong></p>
<p><img src="/images/sonarqube/angular/slack016.png" alt="lack01"></p>
<ol>
<li>選擇右上方的 <code>option</code></li>
<li>選擇 <code>Add an app</code></li>
</ol>
<p><strong>新增 Incoming WebHooks</strong></p>
<p><img src="/images/sonarqube/angular/slack017.png" alt="lack01"></p>
<p>Slack 將開啟瀏覽器</p>
<ol>
<li>稍微往下捲輸入 <code>webhook</code></li>
<li>選擇 <code>Incoming WebHooks</code></li>
</ol>
<p><strong>新增 Configuration</strong></p>
<p><img src="/images/sonarqube/angular/slack018.png" alt="lack01"></p>
<ol>
<li>按 <code>Add Configuration</code> 加入 Jenkins CI</li>
</ol>
<p><strong>新增 Integration</strong></p>
<p><img src="/images/sonarqube/angular/slack019.png" alt="lack01"></p>
<ol>
<li>按 <code>Add Incoming WebHooks Integration</code> 正式加入整合</li>
</ol>
<p><strong>Slack 設定完成</strong></p>
<p><img src="/images/sonarqube/angular/slack020.png" alt="lack02"></p>
<ol>
<li>介紹 SonarQube 設定流程</li>
</ol>
<blockquote>
<p>Slack 部分已經設定完成，接下來是 SonarQube 的設定</p>
<p>Slack 網頁先不要關閉，稍後會用到</p>
</blockquote>
<h2 id="SonarQube_Slack_Notifier">SonarQube Slack Notifier</h2><hr>
<p>SonarQube 預設並沒有辦法直接對 Slack 發出 notification，必須另外安裝 <a href="https://github.com/kogitant/sonar-slack-notifier-plugin" target="_blank" rel="external">CKS Sonar Slack Notifier Plugin</a>。</p>
<p><strong>下載 Plugin</strong></p>
<p><img src="/images/sonarqube/angular/slack021.png" alt="lack02"></p>
<p><strong>安裝 Plugin</strong></p>
<p><img src="/images/sonarqube/angular/slack022.png" alt="lack02"></p>
<p>將 <code>cks-slack-notifier-2.1.2.jar</code> 複製到 <code>/usr/local/Cellar/sonarqube/7.0/libexec/extensions/plugins</code> 目錄下。</p>
<blockquote>
<p>因為 Homebrew 會將 app 安裝在 <code>/usr/local/Cellar/</code> 目錄下</p>
</blockquote>
<p><strong>設定 Plugin</strong></p>
<p><img src="/images/sonarqube/angular/slack023.png" alt="lack02"></p>
<p>重新啟動 SonarQube：</p>
<p><strong><em>Administration -&gt; Slack</em></strong></p>
<ol>
<li>在 <code>Administration</code> 下會發現多了 <code>Slack</code></li>
<li>選擇 <code>Slack</code></li>
<li><strong>Slack web integration hook</strong>：設定 <code>Slack web integration hook</code></li>
<li><strong>Plugin enabled</strong>：<code>enable</code></li>
</ol>
<blockquote>
<p>Q： <code>Slack web integration hook</code> 該填什麼呢？</p>
</blockquote>
<p><img src="/images/sonarqube/angular/slack024.png" alt="lack02"></p>
<p>回到 Slack 最後的網頁往下捲到 <code>Webhook URL</code></p>
<ol>
<li>將 <code>Webhook URL</code> 的一長串 URL 複製，貼到 SonarQube 的 <code>Slack web integration hook</code></li>
</ol>
<p>最後按 <code>Save</code> 存檔。</p>
<p><strong>設定 Project 與 Channel</strong></p>
<p>雖然已經設定了 SonarQube 的 Webhook URL，但還要繼續設定 project 與所對應的 Slack channel，才會正式開啟 notification。</p>
<p><img src="/images/sonarqube/angular/slack025.png" alt="lack02"></p>
<ol>
<li><strong>Project Key</strong>： 設定 SonarQube 的 project key</li>
<li><strong>Slack channel</strong>：設定所要通知 Slack channel</li>
</ol>
<p>最後按 <code>Save</code> 存檔。</p>
<p><strong>測試 Plugin</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=Angular52 -Dsonar.sources=. -Dsonar.projectName=Angular52 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>重新執行 <code>sonar-scanner</code>。</p>
<p><img src="/images/sonarqube/angular/slack027.png" alt="lack02"></p>
<ol>
<li>重新在專案目錄下輸入 <code>sonar-scanner</code> 檢查 TypeScript</li>
</ol>
<p><img src="/images/sonarqube/angular/slack026.png" alt="lack02"></p>
<ol>
<li>Slack 會收到 SonarQube 檢查的結果</li>
</ol>
<p>實務上 SonarQube 還會與其他 CI server 合作，接下來將以 Jenkins 為例，介紹如何以 Jenkins 自動化 SonarQube。</p>
<h2 id="Jenkins">Jenkins</h2><hr>
<p><strong>安裝 Jenkins</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>install jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 Jenkins。</p>
<p><img src="/images/sonarqube/angular/slack028.png" alt="lack02"></p>
<ol>
<li>輸入 <code>brew install jenkins-lts</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 Jenkins，輸入 <code>brew services start jenkins-lts</code></li>
<li>若想自行啟動 Jenkins，輸入 <code>jenkins-lts</code></li>
</ol>
<p><strong>啟動 Jenkins</strong></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 <code>jenkins-lts</code> 自行啟動 Jenkins。</p>
<p><img src="/images/sonarqube/angular/slack029.png" alt="lack02"></p>
<p><strong>Unlock Jenkins</strong></p>
<p><img src="/images/sonarqube/angular/slack030.png" alt="lack03"></p>
<ol>
<li>輸入 <code>localhost:8080</code>，看到 Unlock Jenkins，開始設定 Jenkins</li>
<li>預設密碼放在 <code>./jenkins/secrets/initialAdminPassword</code></li>
</ol>
<p><strong>Customize Jenkins</strong></p>
<p><img src="/images/sonarqube/angular/slack031.png" alt="lack03"></p>
<ol>
<li>選擇 <code>Install suggested plugins</code> 即可</li>
</ol>
<p><strong>Getting Started</strong><br><img src="/images/sonarqube/angular/slack032.png" alt="lack03"></p>
<p>安裝 default plugin 中。</p>
<p><strong>Create Admin User</strong></p>
<p><img src="/images/sonarqube/angular/slack033.png" alt="lack03"></p>
<ol>
<li>建立管理者帳號</li>
</ol>
<p><strong>Jenkins is Ready</strong></p>
<p><img src="/images/sonarqube/angular/slack034.png" alt="lack03"></p>
<ol>
<li>Jenkins 安裝完成，按 <code>Start using jenkins</code> 開始使用 Jenkins</li>
</ol>
<p><strong>Welcome to Jenkins</strong></p>
<p><img src="/images/sonarqube/angular/slack035.png" alt="lack03"></p>
<ol>
<li>進入 Jenkins 管理介面，如此 Jenkins 已經設定成功</li>
</ol>
<h2 id="SonarQube_Scanner_for_Jenkins">SonarQube Scanner for Jenkins</h2><hr>
<p>要讓 Jenkins 能自動執行 SonarQube Scanner，必須另外安裝 plugin。</p>
<p><strong>安裝 SonarQube Scanner for Jenkins</strong></p>
<p><img src="/images/sonarqube/angular/slack036.png" alt="lack03"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Manage Plugins</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack037.png" alt="lack03"></p>
<ol>
<li>選擇 <code>SonarQube Scanner</code></li>
<li>按 <code>Download now and install after restart</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack038.png" alt="lack03"></p>
<p>安裝 plugin 中。</p>
<ol>
<li>將 <code>Restart Jenkins when installation is complete and no jobs are running</code> 打勾</li>
</ol>
<p><strong>設定 SonarQube 環境變數</strong></p>
<p><img src="/images/sonarqube/angular/slack039.png" alt="lack03"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Configure System</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack040.png" alt="lack04"></p>
<ol>
<li>找到 <code>SonarQube servers</code> 區段</li>
<li>將 <code>Enable injection of SonarQube server configuration as build environment variables</code> 打勾</li>
<li>設定 SonarQube server 名稱與網址</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<p><strong>設定 SonarQube Scanner 環境變數</strong></p>
<p><img src="/images/sonarqube/angular/slack041.png" alt="lack04"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Global Tool Configuration</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack042.png" alt="lack04"></p>
<ol>
<li>找到 <code>SonarQube Scanner</code> 區段</li>
<li>設定 SonarQube Scanner 名稱</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<h2 id="Jenkins_Job">Jenkins Job</h2><hr>
<p><strong>Source Code Management</strong></p>
<p><img src="/images/sonarqube/angular/slack043.png" alt="lack04"></p>
<ol>
<li>選擇 Job，按左側 <code>Configure</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack044.png" alt="lack04"></p>
<ol>
<li>找到 <code>Source Code Management</code> 區段</li>
<li>將 Git 的 <code>Repository URL</code> 設定到 <code>https://github.com/oomusou/NG52JenkinsSonarQubeSlack</code></li>
</ol>
<p><strong>Build</strong></p>
<p><img src="/images/sonarqube/angular/slack045.png" alt="lack04"></p>
<ol>
<li>找到 <code>Build</code> 區段</li>
<li>在 <code>Add build step</code> 選擇 <code>Execute SonarQube Scanner</code></li>
</ol>
<p><img src="/images/sonarqube/angular/slack046.png" alt="lack04"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=Angular52</span><br><span class="line">sonar.sources=. </span><br><span class="line">sonar.projectName=Angular52 </span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>在 <code>Analysis properties</code> 加上以上設定。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=Angular52 -Dsonar.sources=. -Dsonar.projectName=Angular52 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>還記得之前曾經下過以上指令嗎？就是將這些 SonarQube property 設定在 Jenkins，改由 Jenkins 幫我們傳。</p>
<p><img src="/images/sonarqube/angular/slack047.png" alt="lack04"></p>
<ol>
<li>按左側 <code>Build Now</code> 執行 Job</li>
<li>執行成功後會出現 <code>OK</code> 與 <code>Success</code>。</li>
</ol>
<p><img src="/images/sonarqube/angular/slack048.png" alt="lack04"></p>
<p>剛剛 Jenkins 執行的 Project 出現在 SonarQube 上。</p>
<p><img src="/images/sonarqube/angular/slack049.png" alt="lack04"></p>
<ol>
<li>Slack 也再次收到 SonarQube 檢查的結果</li>
</ol>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>SonarQube 已經內建 SonarTS，也可以用來檢查 TypeScript 與 Angular</li>
<li>就算不將 SonarQube 安裝在 server，安裝在本機也能有效的檢查 TypeScript 程式碼品質</li>
<li>SonarQube 也能將檢查結果推送到 Slack</li>
<li>藉由 Jenkins 幫忙，我們就可以自動化執行 SonarQube</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/NG52JenkinsSonarQubeSlack" target="_blank" rel="external">GitHub</a> 上找到</p>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://www.sonarqube.org" target="_blank" rel="external">SonarQube</a>, <a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">SonarQube Downloads</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner+for+Jenkins" target="_blank" rel="external">Analying with SonarQube Scanner for Jenkins</a><br><a href="https://jenkins.io/" target="_blank" rel="external">Jenkins</a>, <a href="https://plugins.jenkins.io/sonar" target="_blank" rel="external">SonarQube Scanner</a><br><a href="https://github.com/kogitant" target="_blank" rel="external">Antti Koivisto</a>, <a href="https://github.com/kogitant/sonar-slack-notifier-plugin" target="_blank" rel="external">CKS Sonar Slack Notifier Plugin</a></p>
]]></content>
    <summary type="html">
    <![CDATA[持續檢查 TypeScript 程式碼品質]]>
    
    </summary>
    
      <category term="Angular" scheme="http://oomusou.io/tags/Angular/"/>
    
      <category term="Jenkins" scheme="http://oomusou.io/tags/Jenkins/"/>
    
      <category term="Slack" scheme="http://oomusou.io/tags/Slack/"/>
    
      <category term="SonarQube" scheme="http://oomusou.io/tags/SonarQube/"/>
    
      <category term="TypeScript" scheme="http://oomusou.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入淺出 F# 之 Partial Function Application]]></title>
    <link href="http://oomusou.io/fsharp/partial-function-application/"/>
    <id>http://oomusou.io/fsharp/partial-function-application/</id>
    <published>2018-04-03T12:23:43.000Z</published>
    <updated>2018-04-03T02:55:22.082Z</updated>
    <content type="html"><![CDATA[<p>FP 既然強調 Higher Order Function，就會希望 argument 以 function 傳入，因此就會有 function 能夠傳回 function 的需求，除了回傳 Anonymous Function 或 Lambda Expression 外，F# 更提供了 Partial Function Application ，讓程式碼更優雅。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="Lambda_Expression">Lambda Expression</h2><hr>
<p>舉一個最簡單的例子</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1.</span><span class="number">.5</span>]</span><br><span class="line">|&gt; List.iter (<span class="keyword">fun</span> i -&gt; printfn <span class="string">"%d"</span> i)</span><br></pre></td></tr></table></figure>
<p>將 <code>1</code> 到 <code>5</code> 的 <code>List</code> 全部印出來。</p>
<p><img src="/images/fsharp/partial/partial000.png" alt="artial00"></p>
<p><code>List.iter()</code> 的 argument 要求 <code>&#39;T -&gt; unit</code> 的 function。</p>
<p>在沒有提供 Partial Function Application 的程式語言，我們會傳進 Anonymous function 或 Lambda Expression。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fun</span> i -&gt; printfn <span class="string">"%d"</span> i</span><br></pre></td></tr></table></figure>
<p>這種寫法中規中矩，儘管語法不太一樣，在一般語言都看得到。</p>
<h2 id="Partial_Function_Application">Partial Function Application</h2><hr>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1.</span><span class="number">.5</span>]</span><br><span class="line">|&gt; List.iter (printfn <span class="string">"%d"</span>)</span><br></pre></td></tr></table></figure>
<p>既然 <code>List.iter()</code> 的 argument 要求 <code>&#39;T -&gt; unit</code> 的 function，我們只要能產生 <code>T -&gt; unit</code> 就符合 <code>List.iter()</code> 的需求。</p>
<p><code>printfn()</code> 的 singnature 為 <code>string -&gt; &#39;T -&gt; unit</code>，他的意思是：</p>
<ul>
<li>當傳入兩個參數為 <code>string</code> 與 <code>&#39;T</code> 時，回傳值為 <code>unit</code></li>
<li>當傳入一個 參數為 <code>string</code> 時，回傳值回 <code>T -&gt; unit</code></li>
</ul>
<p><code>List.iter()</code> 要的正是 <code>&#39;T -&gt; unit</code>，所以我們只要傳入一個參數即可。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printfn <span class="string">"%d"</span></span><br></pre></td></tr></table></figure>
<p>這種寫法是不是比 Lambda Expression 更優雅呢？</p>
<h2 id="Summary">Summary</h2><hr>
<ul>
<li>在多參數的 function，只要提供 <code>部分參數</code>，就會回傳一個新的 function，而不必自己建立 Anonymous Function 或 Lambda Expression。</li>
<li>在多參數的 function，其型別是以 <code>-&gt;</code> 隔開，如 <code>string -&gt; &#39;T -&gt; unit</code>，而不是 <code>string, &#39;T -&gt; unit</code>，因為 F# 的 function 可隨時提供 <code>部分參數</code>，而回傳新的 function，如只提供 <code>string</code>，就會回傳 <code>&#39;T -&gt; unit</code>，這也是為什麼 F# 在每個參數間以 <code>-&gt;</code> 隔開，而非 <code>,</code></li>
</ul>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>Partial Function Application 並不是 F# 的獨門絕技，只要是 FP 語言都會有，算是 FP 語言的基本要求，但在一般語言如 C#、JavaScript 卻看不到，只能使用 Lambda Expression / Anonymous Function / Arrow Function 來處理，但 Partial Function Application 提供了更優雅的方式</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[更優雅的方式產生 function]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 SonarQube 檢查 .NET Core 專案？]]></title>
    <link href="http://oomusou.io/sonarqube/netcore/"/>
    <id>http://oomusou.io/sonarqube/netcore/</id>
    <published>2018-04-02T12:23:43.000Z</published>
    <updated>2018-04-03T06:48:49.216Z</updated>
    <content type="html"><![CDATA[<p>SonarQube 是一套 <code>程式碼品質檢查工具</code>，可以幫我們檢查 code 的 bugs、 vulenrability、code smell 與 duplication，也屬於 <code>持續整合</code> 重要的一環。</p>
<p>SonarQube 已經內建 SonarC#，可以直接對 C# 進行檢查，本文將以 .NET Core 為例，並搭配 Jenkins 自動執行 SonarQube，將結果通知 Slack。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.4<br>SonarQube 6.7.2 LTS<br>Jenkins 2.107.1<br>Slack 3.0.5<br>.NET Core 2.0.6</p>
<h2 id="GitHub">GitHub</h2><hr>
<p>將 .NET Core 專案放到 GitHub。</p>
<p><img src="/images/sonarqube/slack/slack000.png" alt="lack00"></p>
<ol>
<li>本文將 .NET Core 專案放在 <code>https://github.com/oomusou/Core2JenkinsSonarQubeSlack</code></li>
</ol>
<blockquote>
<p>當然也可以將 git repository 放在不同的 git server，如 Bitbucket</p>
</blockquote>
<h2 id="SonarQube">SonarQube</h2><hr>
<p><strong>安裝 SonarQube</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>update</span><br><span class="line">$ <span class="keyword">brew </span>install sonarqube</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 SonarQube。</p>
<p><img src="/images/sonarqube/slack/slack001.png" alt="lack00"></p>
<ol>
<li>輸入 <code>brew install sonarqube</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 SonarQube，輸入 <code>brew services start sonarqube</code></li>
<li>若想自行啟動 SonarQube，輸入 <code>sonar console</code></li>
</ol>
<p><strong>啟動 SonarConsole</strong></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sonar <span class="built_in">console</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>sonar console</code> 自行啟動 SonarQube。</p>
<p><img src="/images/sonarqube/slack/slack002.png" alt="lack00"></p>
<ol>
<li>輸入 <code>sonar console</code> 自行啟動 SonarQube</li>
</ol>
<p><strong>測試 SonarQube</strong></p>
<p><img src="/images/sonarqube/slack/slack003.png" alt="lack00"></p>
<ol>
<li>輸入 <code>localhost:9000</code>，若看到 SonarQube 首頁，則表示安裝成功</li>
<li>右上角 <code>Log in</code> 可登入管理設定 SonarQube，預設為 <code>admin/admin</code></li>
</ol>
<h2 id="SonarQube_Scanner">SonarQube Scanner</h2><hr>
<p>SonarQube 雖然已經包含 SonarC#，但必須靠 SonarQube Scanner 才能執行，預設 SonarQube 並沒有包含 Scanner，必須自行安裝。</p>
<p><strong>下載 Scanner</strong></p>
<p><img src="/images/sonarqube/slack/slack004.png" alt="hp00"></p>
<p>到 <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a> 下載 Scanner，選擇 <code>Mac OS X 64 bit</code> 下載。</p>
<p><img src="/images/sonarqube/slack/slack005.png" alt="lack00"></p>
<p>下載後為一 <code>zip</code> 壓縮檔，解壓縮後可安裝在任何目錄。</p>
<p><img src="/images/sonarqube/slack/slack006.png" alt="lack00"></p>
<ol>
<li>選擇 home directory</li>
<li>將 <code>sonar-scanner-3.1.0.1141-macosx</code> 放在 home directory 下</li>
</ol>
<p><strong>設定 Server</strong></p>
<p><strong>sonar-scanner.properties</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#----- Default SonarQube server</span><br><span class="line">sonar<span class="class">.host</span><span class="class">.url</span>=http:<span class="comment">//localhost:9000</span></span><br></pre></td></tr></table></figure>
<p>設定 SonarQube server 位址，並將 <code>#</code> 註解拿掉。</p>
<p><img src="/images/sonarqube/slack/slack007.png" alt="lack00"></p>
<ol>
<li><code>sonar-scanner.properties</code> 位於 <code>sonar-scanner-3.1.0.1141-macosx/conf/</code> 目錄下</li>
</ol>
<p><strong>測試 Scanner</strong></p>
<p>將 SonarQube Scanner 加到 system path。</p>
<p><strong>.zshrc</strong><br><img src="/images/sonarqube/slack/slack008.png" alt="lack00"></p>
<ol>
<li>將 <code>~/sonar-scanner-3.1.0.1141-macosx/bin</code> 目錄加到 system path</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=NETCore2 -Dsonar.sources=. -Dsonar.projectName=NETCore2 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>sonar-scanner</code> 對 Laravel 專案進行檢查。</p>
<ul>
<li><strong>-D</strong> : 對 SonarQube 的 property 進行設定</li>
<li><strong>sonar.projectKey</strong>：SonarQube 對專案的 key，內部將以此 key 作為辨別，必須唯一</li>
<li><strong>sonar.sources</strong>：SonarQube 要檢查的目錄，因為已經在專案目錄下，<code>.</code> 即為 <code>目前目錄</code></li>
<li><strong>sonar.projectName</strong>：在 SonarQube 網頁上顯示的名稱</li>
<li><strong>sonar.projectVersion</strong>：在 SonarQube 網頁上顯示的版本編號</li>
</ul>
<p><img src="/images/sonarqube/slack/slack009.png" alt="lack00"></p>
<ol>
<li>在專案目錄下輸入 <code>sonar-scanner</code> 檢查 C#</li>
</ol>
<p><img src="/images/sonarqube/slack/slack010.png" alt="lack01"></p>
<ol>
<li>若能看到 <code>EXECUTION SUCCESS</code>，則表示 SonarQube Scanner 安裝成功</li>
</ol>
<p><img src="/images/sonarqube/slack/slack011.png" alt="lack01"></p>
<p>進入 SonarQube 網頁，就可看到 <code>NETCore2</code> 專案已經出現 SonarQube。</p>
<p>到目前為止，SonarQube 對 C# 的檢查已經完成，就算只將 SonarQube 裝在本機，也對 C# 程式碼品質的檢查有很大的幫助。</p>
<p>若每次 SonarQube 檢查完，都能將結果送到 Slack，讓 Slack 成為實質的 <code>持續整合</code> 中心，那就太好了。</p>
<h2 id="Slack">Slack</h2><hr>
<p><strong>新增 Channel</strong></p>
<p><img src="/images/sonarqube/slack/slack012.png" alt="lack01"></p>
<ol>
<li>按下 <code>Channels</code> 右側的 <code>+</code> 新增 channel</li>
</ol>
<p><img src="/images/sonarqube/slack/slack013.png" alt="lack01"></p>
<ol>
<li><strong>Privacy</strong> : 設定為 <code>Public</code> 或 <code>Private</code> channel</li>
<li><strong>Name</strong> : 設定 channel 名稱</li>
<li><strong>Purpose</strong> : channel 的功能描述，可以不輸入</li>
<li><strong>Send invites to</strong> : 設定 channel 成員，可以稍後再設定</li>
<li>按 <code>Create Channel</code> 開始建立 channel</li>
</ol>
<p><img src="/images/sonarqube/slack/slack014.png" alt="lack01"></p>
<ol>
<li>按 <code>Got It!</code> 進入 channel</li>
</ol>
<p><img src="/images/sonarqube/slack/slack015.png" alt="lack01"></p>
<ol>
<li>正式進入 channel，將來 SonarQube 訊息會傳進此 channel</li>
</ol>
<p><strong>新增 Notification</strong></p>
<p><img src="/images/sonarqube/slack/slack016.png" alt="lack01"></p>
<ol>
<li>選擇右上方的 <code>option</code></li>
<li>選擇 <code>Add an app</code></li>
</ol>
<p><strong>新增 Incoming WebHooks</strong></p>
<p><img src="/images/sonarqube/slack/slack017.png" alt="lack01"></p>
<p>Slack 將開啟瀏覽器</p>
<ol>
<li>稍微往下捲輸入 <code>webhook</code></li>
<li>選擇 <code>Incoming WebHooks</code></li>
</ol>
<p><strong>新增 Configuration</strong></p>
<p><img src="/images/sonarqube/slack/slack018.png" alt="lack01"></p>
<ol>
<li>按 <code>Add Configuration</code> 加入 Jenkins CI</li>
</ol>
<p><strong>新增 Integration</strong></p>
<p><img src="/images/sonarqube/slack/slack019.png" alt="lack01"></p>
<ol>
<li>按 <code>Add Incoming WebHooks Integration</code> 正式加入整合</li>
</ol>
<p><strong>Slack 設定完成</strong></p>
<p><img src="/images/sonarqube/slack/slack020.png" alt="lack02"></p>
<ol>
<li>介紹 SonarQube 設定流程</li>
</ol>
<blockquote>
<p>Slack 部分已經設定完成，接下來是 SonarQube 的設定</p>
<p>Slack 網頁先不要關閉，稍後會用到</p>
</blockquote>
<h2 id="SonarQube_Slack_Notifier">SonarQube Slack Notifier</h2><hr>
<p>SonarQube 預設並沒有辦法直接對 Slack 發出 notification，必須另外安裝 <a href="https://github.com/kogitant/sonar-slack-notifier-plugin" target="_blank" rel="external">CKS Sonar Slack Notifier Plugin</a>。</p>
<p><strong>下載 Plugin</strong></p>
<p><img src="/images/sonarqube/slack/slack021.png" alt="lack02"></p>
<p><strong>安裝 Plugin</strong></p>
<p><img src="/images/sonarqube/slack/slack022.png" alt="lack02"></p>
<p>將 <code>cks-slack-notifier-2.1.2.jar</code> 複製到 <code>/usr/local/Cellar/sonarqube/7.0/libexec/extensions/plugins</code> 目錄下。</p>
<blockquote>
<p>因為 Homebrew 會將 app 安裝在 <code>/usr/local/Cellar/</code> 目錄下</p>
</blockquote>
<p><strong>設定 Plugin</strong></p>
<p><img src="/images/sonarqube/slack/slack023.png" alt="lack02"></p>
<p>重新啟動 SonarQube：</p>
<ol>
<li>在 <code>Administration</code> 下會發現多了 <code>Slack</code></li>
<li>選擇 <code>Slack</code></li>
<li><strong>Slack web integration hook</strong>：設定 <code>Slack web integration hook</code></li>
<li><strong>Plugin enabled</strong>：<code>enable</code></li>
</ol>
<blockquote>
<p>Q： <code>Slack web integration hook</code> 該填什麼呢？</p>
</blockquote>
<p><img src="/images/sonarqube/slack/slack024.png" alt="lack02"></p>
<p>回到 Slack 最後的網頁往下捲到 <code>Webhook URL</code></p>
<ol>
<li>將 <code>Webhook URL</code> 的一長串 URL 複製，貼到 SonarQube 的 <code>Slack web integration hook</code></li>
</ol>
<p>最後按 <code>Save</code> 存檔。</p>
<p><strong>設定 Project 與 Channel</strong></p>
<p>雖然已經設定了 SonarQube 的 Webhook URL，但還要繼續設定 project 與所對應的 Slack channel，才會正式開啟 notification。</p>
<p><img src="/images/sonarqube/slack/slack025.png" alt="lack02"></p>
<ol>
<li><strong>Project Key</strong>： 設定 SonarQube 的 project key</li>
<li><strong>Slack channel</strong>：設定所要通知 Slack channel</li>
</ol>
<p>最後按 <code>Save</code> 存檔。</p>
<p><strong>測試 Plugin</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=NETCore2 -Dsonar.sources=. -Dsonar.projectName=NETCore2 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>重新執行 <code>sonar-scanner</code>。</p>
<p><img src="/images/sonarqube/slack/slack027.png" alt="lack02"></p>
<ol>
<li>重新在專案目錄下輸入 <code>sonar-scanner</code> 檢查 C#</li>
</ol>
<p><img src="/images/sonarqube/slack/slack026.png" alt="lack02"></p>
<ol>
<li>Slack 會收到 SonarQube 檢查的結果</li>
</ol>
<p>實務上 SonarQube 還會與其他 CI server 合作，接下來將以 Jenkins 為例，介紹如何以 Jenkins 自動化 SonarQube。</p>
<h2 id="Jenkins">Jenkins</h2><hr>
<p><strong>安裝 Jenkins</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>install jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 Jenkins。</p>
<p><img src="/images/sonarqube/slack/slack028.png" alt="lack02"></p>
<ol>
<li>輸入 <code>brew install jenkins-lts</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 Jenkins，輸入 <code>brew services start jenkins-lts</code></li>
<li>若想自行啟動 Jenkins，輸入 <code>jenkins-lts</code></li>
</ol>
<p><strong>啟動 Jenkins</strong></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 <code>jenkins-lts</code> 自行啟動 Jenkins。</p>
<p><img src="/images/sonarqube/slack/slack029.png" alt="lack02"></p>
<p><strong>Unlock Jenkins</strong></p>
<p><img src="/images/sonarqube/slack/slack030.png" alt="lack03"></p>
<ol>
<li>輸入 <code>localhost:8080</code>，看到 Unlock Jenkins，開始設定 Jenkins</li>
<li>預設密碼放在 <code>./jenkins/secrets/initialAdminPassword</code></li>
</ol>
<p><strong>Customize Jenkins</strong></p>
<p><img src="/images/sonarqube/slack/slack031.png" alt="lack03"></p>
<ol>
<li>選擇 <code>Install suggested plugins</code> 即可</li>
</ol>
<p><strong>Getting Started</strong></p>
<p><img src="/images/sonarqube/slack/slack032.png" alt="lack03"></p>
<p>安裝 default plugin 中。</p>
<p><strong>Create Admin User</strong></p>
<p><img src="/images/sonarqube/slack/slack033.png" alt="lack03"></p>
<ol>
<li>建立管理者帳號</li>
</ol>
<p><strong>Jenkins is Ready</strong></p>
<p><img src="/images/sonarqube/slack/slack034.png" alt="lack03"></p>
<ol>
<li>Jenkins 安裝完成，按 <code>Start using jenkins</code> 開始使用 Jenkins</li>
</ol>
<p><strong>Welcome to Jenkins</strong></p>
<p><img src="/images/sonarqube/slack/slack035.png" alt="lack03"></p>
<ol>
<li>進入 Jenkins 管理介面，如此 Jenkins 已經設定成功</li>
</ol>
<h2 id="SonarQube_Scanner_for_Jenkins">SonarQube Scanner for Jenkins</h2><hr>
<p>要讓 Jenkins 能自動執行 SonarQube Scanner，必須另外安裝 plugin。</p>
<p><strong>安裝 SonarQube Scanner for Jenkins</strong></p>
<p><img src="/images/sonarqube/slack/slack036.png" alt="lack03"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Manage Plugins</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack037.png" alt="lack03"></p>
<ol>
<li>選擇 <code>SonarQube Scanner</code></li>
<li>按 <code>Download now and install after restart</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack038.png" alt="lack03"></p>
<p>安裝 plugin 中。</p>
<ol>
<li>將 <code>Restart Jenkins when installation is complete and no jobs are running</code> 打勾</li>
</ol>
<p><strong>設定 SonarQube 環境變數</strong></p>
<p><img src="/images/sonarqube/slack/slack039.png" alt="lack03"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Configure System</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack040.png" alt="lack04"></p>
<ol>
<li>找到 <code>SonarQube servers</code> 區段</li>
<li>將 <code>Enable injection of SonarQube server configuration as build environment variables</code> 打勾</li>
<li>設定 SonarQube server 名稱與網址</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<p><strong>設定 SonarQube Scanner 環境變數</strong></p>
<p><img src="/images/sonarqube/slack/slack041.png" alt="lack04"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Global Tool Configuration</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack042.png" alt="lack04"></p>
<ol>
<li>找到 <code>SonarQube Scanner</code> 區段</li>
<li>設定 SonarQube Scanner 名稱</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<h2 id="Jenkins_Job">Jenkins Job</h2><hr>
<p><strong>Source Code Management</strong></p>
<p><img src="/images/sonarqube/slack/slack043.png" alt="lack04"></p>
<ol>
<li>選擇 Job，按左側 <code>Configure</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack044.png" alt="lack04"></p>
<ol>
<li>找到 <code>Source Code Management</code> 區段</li>
<li>將 Git 的 <code>Repository URL</code> 設定到 <code>https://github.com/oomusou/Core2JenkinsSonarQubeSlack</code></li>
</ol>
<p><strong>Build</strong></p>
<p><img src="/images/sonarqube/slack/slack045.png" alt="lack04"></p>
<ol>
<li>找到 <code>Build</code> 區段</li>
<li>在 <code>Add build step</code> 選擇 <code>Execute SonarQube Scanner</code></li>
</ol>
<p><img src="/images/sonarqube/slack/slack046.png" alt="lack04"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=NETCore2</span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.projectName=NETCore2</span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>在 <code>Analysis properties</code> 加上以上設定。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=NETCore2 -Dsonar.sources=. -Dsonar.projectName=NETCore2 -Dsonar.projectVersion=<span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>還記得之前曾經下過以上指令嗎？就是將這些 SonarQube property 設定在 Jenkins，改由 Jenkins 幫我們傳。</p>
<p><img src="/images/sonarqube/slack/slack047.png" alt="lack04"></p>
<ol>
<li>按左側 <code>Build Now</code> 執行 Job</li>
<li>執行成功後會出現 <code>OK</code> 與 <code>Success</code>。</li>
</ol>
<p><img src="/images/sonarqube/slack/slack048.png" alt="lack04"></p>
<p>剛剛 Jenkins 執行的 Project 出現在 SonarQube 上。</p>
<p><img src="/images/sonarqube/slack/slack049.png" alt="lack04"></p>
<ol>
<li>Slack 也再次收到 SonarQube 檢查的結果</li>
</ol>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>SonarQube 已經內建 SonarC#，也可以用來檢查 C# 與 .NET Core</li>
<li>就算不將 SonarQube 安裝在 server，安裝在本機也能有效的檢查 C# 程式碼品質</li>
<li>SonarQube 也能將檢查結果推送到 Slack</li>
<li>藉由 Jenkins 幫忙，我們就可以自動化執行 SonarQube</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/Core2JenkinsSonarQubeSlack" target="_blank" rel="external">GitHub</a> 上找到</p>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://www.sonarqube.org" target="_blank" rel="external">SonarQube</a>, <a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">SonarQube Downloads</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner+for+Jenkins" target="_blank" rel="external">Analying with SonarQube Scanner for Jenkins</a><br><a href="https://jenkins.io/" target="_blank" rel="external">Jenkins</a>, <a href="https://plugins.jenkins.io/sonar" target="_blank" rel="external">SonarQube Scanner</a><br><a href="https://github.com/kogitant" target="_blank" rel="external">Antti Koivisto</a>, <a href="https://github.com/kogitant/sonar-slack-notifier-plugin" target="_blank" rel="external">CKS Sonar Slack Notifier Plugin</a></p>
]]></content>
    <summary type="html">
    <![CDATA[持續檢查 C# 程式碼品質]]>
    
    </summary>
    
      <category term=".NET Core" scheme="http://oomusou.io/tags/NET-Core/"/>
    
      <category term="C#" scheme="http://oomusou.io/tags/C/"/>
    
      <category term="Jenkins" scheme="http://oomusou.io/tags/Jenkins/"/>
    
      <category term="Slack" scheme="http://oomusou.io/tags/Slack/"/>
    
      <category term="SonarQube" scheme="http://oomusou.io/tags/SonarQube/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[深入淺出 F# 之 Unit 與 Ignore]]></title>
    <link href="http://oomusou.io/fsharp/unit-ignore/"/>
    <id>http://oomusou.io/fsharp/unit-ignore/</id>
    <published>2018-04-01T12:23:43.000Z</published>
    <updated>2018-04-03T02:57:31.197Z</updated>
    <content type="html"><![CDATA[<p>F# 是 FP，強調 function 都要有 input 值，也要有 return 值，若 function 真的沒有 input 值，也沒有 return 值，在 F# 該如何表示呢？</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="Unit_與_()">Unit 與 ()</h2><hr>
<p>FP 的思考來自於數學函數，認為 function 都要有 <code>定義域</code> 與 <code>對應域</code>，如 <code>y = f(x)</code>，也就是 input  <code>x</code> 的型別就是 <code>定義域</code>，而 return  <code>y</code> 的型別就是 <code>對應域</code>。</p>
<p>但在電腦語言的 function，可能沒有 input 值，也可能沒有 return 值，這就與數學 function 不同，針對這種需求，F# 特別設計出新的型別 <code>unit</code>，其值只有一個 <code>()</code>。</p>
<h2 id="無_return">無 return</h2><hr>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> print msg = printfn <span class="string">"%s"</span> msg</span><br><span class="line"></span><br><span class="line">print <span class="string">"Hello World"</span></span><br></pre></td></tr></table></figure>
<p><code>print()</code> 為 function，其內容只有 <code>printfn()</code> 印出 <code>msg</code>，這就是典型 I/O 類的 side effect，但沒有 return 值。</p>
<p><img src="/images/fsharp/unit-ignore/unit000.png" alt="nit00"></p>
<p>若觀察 <code>print()</code> 的型別，其為 <code>string -&gt; unit</code> ，也就是若沒 return 值，Type Inference 會推導為 <code>unit</code>。</p>
<blockquote>
<p>Q : 所以 <code>unit</code> 不就 C# 的 <code>void</code>？</p>
</blockquote>
<p>若以無 return 值的 function 觀點，<code>unit</code> 相當於 <code>void</code> 沒錯，但 <code>unit</code> 還有其他用途。</p>
<h2 id="無_input">無 input</h2><hr>
<p>若想要建立 <code>input()</code> ，但不用傳入任何值，就可以印出 <code>Hello World</code>。</p>
<p>直覺會這樣寫：</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> print = printfn <span class="string">"%s"</span> <span class="string">"Hello World"</span></span><br></pre></td></tr></table></figure>
<p>但別忘了 F# 強調是 Function Value，也就是 function 也視為是一種 value，因此都使用 <code>let</code> 。</p>
<p><img src="/images/fsharp/unit-ignore/unit001.png" alt="nit00"></p>
<p>Type Inference 推導為 <code>unit</code>，是 <code>unit</code> 型別的 value，而不是 function。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> print () = printfn <span class="string">"%s"</span> <span class="string">"Hello World"</span></span><br></pre></td></tr></table></figure>
<p>正確寫法應該使用 <code>()</code> 代表其無 input 值，但其 <code>定義域</code> 為 <code>()</code> ，也就是 <code>unit</code> type。</p>
<p><img src="/images/fsharp/unit-ignore/unit002.png" alt="nit00"></p>
<p>Type Inference 推導的 <code>print</code> 為 <code>unit -&gt; unit</code>，是 <code>unit -&gt; unit</code> 型別的 function，而不是 value。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> print () = printfn <span class="string">"%s"</span> <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line">print ()</span><br></pre></td></tr></table></figure>
<p>呼叫 <code>prinf()</code> 時，也要明確傳入 <code>()</code> 代表 no input。</p>
<p><img src="/images/fsharp/unit-ignore/unit004.png" alt="nit00"></p>
<h2 id="有_return_但不想用">有 return 但不想用</h2><hr>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum x y  = x + y</span><br><span class="line"></span><br><span class="line">sum <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>明明 <code>sum()</code> 有 return <code>x + y</code>，但呼叫 <code>sum()</code> 時卻沒處理 return 值，compiler 編譯後會抱怨。</p>
<p><img src="/images/fsharp/unit-ignore/unit003.png" alt="nit00"></p>
<p>有兩種解法：</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum x y  = x + y</span><br><span class="line"><span class="keyword">let</span> result = sum <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>明確將 <code>sum()</code> 結果 binding 到 <code>result</code> value，這是 FP 最標準做法。</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum x y = x + y</span><br><span class="line">sum <span class="number">2</span> <span class="number">3</span> |&gt; ignore</span><br></pre></td></tr></table></figure>
<p>將 <code>sum()</code> 結果 pipeline 到 <code>ignore()</code>，則 compiler 就不會抱怨。</p>
<blockquote>
<p>實務上若真的不想處理 function 的結果，建議使用 <code>ignore()</code></p>
</blockquote>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>FP 嚴格遵守數學 function 定義，但電腦 function 卻可能沒有 input 也沒有 return，因此 F# 特別設計出 <code>unit</code> 與 <code>()</code>，這樣就與數學的 <code>定義域</code> 與 <code>對應域</code> 的觀念相通</li>
</ul>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://docs.microsoft.com/en-us/" target="_blank" rel="external">Microsoft Docs</a>, <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/unit-type" target="_blank" rel="external">Unit Type</a><br><a href="https://dev.to/josegonz321" target="_blank" rel="external">Jose Gonzales</a>, <a href="https://dev.to/josegonz321/whats-the-unit-type-in-fsharp" target="_blank" rel="external">What’s the Unit Type in F#?</a><br><a href="https://stackoverflow.com/" target="_blank" rel="external">Stack overflow</a>, <a href="https://stackoverflow.com/questions/17870937/what-does-this-notation-mean/17872004#17872004" target="_blank" rel="external">What does this () notation mean?</a><br><a href="http://www.oreilly.com/pub/au/3667" target="_blank" rel="external">Chris Smith</a>, <a href="http://shop.oreilly.com/product/0636920024033.do" target="_blank" rel="external">Pramming F# 3.0 2nd</a></p>
]]></content>
    <summary type="html">
    <![CDATA[讓電腦 function 與數學 function 觀念相同]]>
    
    </summary>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 SonarQube 檢查 PHP 專案？]]></title>
    <link href="http://oomusou.io/sonarqube/php/"/>
    <id>http://oomusou.io/sonarqube/php/</id>
    <published>2018-03-31T12:23:43.000Z</published>
    <updated>2018-04-03T06:48:42.776Z</updated>
    <content type="html"><![CDATA[<p>SonarQube 是一套 <code>程式碼品質檢查工具</code>，可以幫我們檢查 code 的 bugs、 vulenrability、code smell 與 duplication，也屬於 <code>持續整合</code> 重要的一環。</p>
<p>SonarQube 已經內建 SonarPHP，可以直接對 PHP 進行檢查，本文將以 Laravel 為例，並搭配 Jenkins 自動執行 SonarQube。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.4<br>SonarQube 6.7.2 LTS<br>SonarPHP 2.1.3<br>SonarQube Scanner 3.1<br>Jenkins 2.107.1<br>SonarQube Scanner for Jenkins 2.6.1<br>PHP 7.1.14<br>Laravel 5.6.14</p>
<h2 id="GitHub">GitHub</h2><hr>
<p>將 Laravel 專案放到 GitHub。</p>
<p><img src="/images/sonarqube/php/php015.png" alt="hp01"></p>
<ol>
<li>本文將 Laravel 專案放在 <code>https://github.com/oomusou/Laravel56Demo</code></li>
</ol>
<blockquote>
<p>當然也可以將 git repository 放在不同的 git server，如 Bitbucket</p>
</blockquote>
<h2 id="SonarQube">SonarQube</h2><hr>
<p><strong>安裝 SonarQube</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>update</span><br><span class="line">$ <span class="keyword">brew </span>install sonarqube</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 SonarQube。</p>
<p><img src="/images/sonarqube/php/php016.png" alt="hp01"></p>
<ol>
<li>輸入 <code>brew install sonarqube</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 SonarQube，輸入 <code>brew services start sonarqube</code></li>
<li>若想自行啟動 SonarQube，輸入 <code>sonar console</code></li>
</ol>
<p><strong>啟動 SonarQube</strong></p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sonar <span class="built_in">console</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>sonar console</code> 自行啟動 SonarQube。</p>
<p><img src="/images/sonarqube/php/php025.png" alt="hp02"></p>
<ol>
<li>輸入 <code>sonar console</code> 自行啟動 SonarQube</li>
</ol>
<p><strong>測試 SonarQube</strong></p>
<p><img src="/images/sonarqube/php/php017.png" alt="hp01"></p>
<ol>
<li>輸入 <code>localhost:9000</code>，若看到 SonarQube 首頁，則表示安裝成功</li>
<li>右上角 <code>Log in</code> 可登入管理設定 SonarQube，預設為 <code>admin/admin</code></li>
</ol>
<h2 id="SonarQube_Scanner">SonarQube Scanner</h2><hr>
<p>SonarQube 雖然已經包含 SonarPHP，但必須靠 SonarQube Scanner 才能執行，預設 SonarQube 並沒有包含 Scanner，必須自行安裝。</p>
<p><strong>下載 Scanner</strong></p>
<p><img src="/images/sonarqube/php/php000.png" alt="hp00"></p>
<p>到 <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a> 下載 Scanner，選擇 <code>Mac OS X 64 bit</code> 下載。</p>
<p><img src="/images/sonarqube/php/php018.png" alt="hp01"></p>
<p>下載後為一 <code>zip</code> 壓縮檔，解壓縮後可安裝在任何目錄。</p>
<p><img src="/images/sonarqube/php/php019.png" alt="hp01"></p>
<ol>
<li>選擇 home directory</li>
<li>將 <code>sonar-scanner-3.1.0.1141-macosx</code> 放在 home directory 下</li>
</ol>
<p><strong>設定 Server</strong></p>
<p><strong>sonar-scanner.properties</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#----- Default SonarQube server</span><br><span class="line">sonar<span class="class">.host</span><span class="class">.url</span>=http:<span class="comment">//localhost:9000</span></span><br></pre></td></tr></table></figure>
<p>設定 SonarQube server 位址，並將 <code>#</code> 註解拿掉。</p>
<p><img src="/images/sonarqube/php/php020.png" alt="hp02"></p>
<ol>
<li><code>sonar-scanner.properties</code> 位於 <code>sonar-scanner-3.1.0.1141-macosx/conf/</code> 目錄下</li>
</ol>
<p><strong>測試 Scanner</strong></p>
<p>將 SonarQube Scanner 加到 system path。</p>
<p><strong>.zshrc</strong></p>
<p><img src="/images/sonarqube/php/php022.png" alt="hp02"></p>
<ol>
<li>將 <code>~/sonar-scanner-3.1.0.1141-macosx/bin</code> 目錄加到 system path</li>
</ol>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=Laravel56 -Dsonar.sources=. -Dsonar.projectName=Laravel56 -Dsonar.projectVersion=1.0 -Dsonar.exclusions=vendor/<span class="keyword">*</span><span class="keyword">*</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>sonar-scanner</code> 對 Laravel 專案進行檢查。</p>
<ul>
<li><strong>-D</strong> : 對 SonarQube 的 property 進行設定</li>
<li><strong>sonar.projectKey</strong>：SonarQube 對專案的 key，內部將以此 key 作為辨別，必須唯一</li>
<li><strong>sonar.sources</strong>：SonarQube 要檢查的目錄，因為已經在專案目錄下，<code>.</code> 即為 <code>目前目錄</code></li>
<li><strong>sonar.projectName</strong>：在 SonarQube 網頁上顯示的名稱</li>
<li><strong>sonar.projectVersion</strong>：在 SonarQube 網頁上顯示的版本編號</li>
<li><strong>sonar.exclusions</strong>：不受 SonarQube 檢查的目錄，如 PHP 套件的放在 <code>vendor</code> 目錄下，實務上我們不會想讓 SonarQube 去檢查 package 的程式碼品質，所以會加以排除</li>
</ul>
<blockquote>
<p>SonarQube 預設也會檢查 JavaScript，若你有 JavaScript 的套件目錄不想檢查，也可以設定在 <code>sonar.exclusions</code></p>
</blockquote>
<p><img src="/images/sonarqube/php/php023.png" alt="hp02"></p>
<ol>
<li>在專案目錄下輸入 <code>sonar-scanner</code> 檢查 PHP</li>
</ol>
<p><img src="/images/sonarqube/php/php024.png" alt="hp02"></p>
<ol>
<li>若能看到 <code>EXECUTION SUCCESS</code>，則表示 SonarQube Scanner 安裝成功</li>
</ol>
<p><img src="/images/sonarqube/php/php001.png" alt="hp00"></p>
<p>進入 SonarQube 網頁，就可看到 <code>Laravel56</code> 專案已經出現 SonarQube。</p>
<p>到目前為止，SonarQube 對 PHP 的檢查已經完成，就算只將 SonarQube 裝在本機，也對 PHP 程式碼品質的檢查有很大的幫助。</p>
<p>實務上 SonarQube 還會與其他 CI server 合作，接下來將以 Jenkins 為例，介紹如何以 Jenkins 自動化 SonarQube。</p>
<h2 id="Jenkins">Jenkins</h2><hr>
<p><strong>安裝 Jenkins</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>install jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 Homebrew 安裝 Jenkins。</p>
<p><img src="/images/sonarqube/php/php021.png" alt="hp02"></p>
<ol>
<li>輸入 <code>brew install jenkins-lts</code> 安裝</li>
<li>若想在每次 Mac 重開機就自動執行 Jenkins，輸入 <code>brew services start jenkins-lts</code></li>
<li>若想自行啟動 Jenkins，輸入 <code>jenkins-lts</code></li>
</ol>
<p><strong>啟動 Jenkins</strong></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>jenkins-lts</span><br></pre></td></tr></table></figure>
<p>使用 <code>jenkins-lts</code> 自行啟動 Jenkins。</p>
<p><img src="/images/sonarqube/php/php026.png" alt="hp02"></p>
<p><strong>Unlock Jenkins</strong></p>
<p><img src="/images/sonarqube/php/php028.png" alt="hp02"></p>
<ol>
<li>輸入 <code>localhost:8080</code>，看到 Unlock Jenkins，開始設定 Jenkins</li>
<li>預設密碼放在 <code>./jenkins/secrets/initialAdminPassword</code></li>
</ol>
<p><strong>Customize Jenkins</strong></p>
<p><img src="/images/sonarqube/php/php029.png" alt="hp02"></p>
<ol>
<li>選擇 <code>Install suggested plugins</code> 即可</li>
</ol>
<p><strong>Getting Started</strong></p>
<p><img src="/images/sonarqube/php/php030.png" alt="hp03"></p>
<p>安裝 default plugin 中。</p>
<p><strong>Create Admin User</strong></p>
<p><img src="/images/sonarqube/php/php031.png" alt="hp03"></p>
<ol>
<li>建立管理者帳號。</li>
</ol>
<p><strong>Jenkins is Ready</strong></p>
<p><img src="/images/sonarqube/php/php032.png" alt="hp03"></p>
<ol>
<li>Jenkins 安裝完成，按 <code>Start using jenkins</code> 開始使用 Jenkins</li>
</ol>
<p><strong>Welcome to Jenkins</strong></p>
<p><img src="/images/sonarqube/php/php033.png" alt="hp03"></p>
<ol>
<li>Jenkins 安裝完成，按 <code>Start using jenkins</code> 開始使用 Jenkins</li>
</ol>
<h2 id="SonarQube_Scanner_for_Jenkins">SonarQube Scanner for Jenkins</h2><hr>
<p>要讓 Jenkins 能自動執行 SonarQube Scanner，必須另外安裝 plugin。</p>
<p><strong>安裝 SonarQube Scanner for Jenkins</strong></p>
<p><img src="/images/sonarqube/php/php011.png" alt="hp01"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Manage Plugins</code></li>
</ol>
<p><img src="/images/sonarqube/php/php002.png" alt="hp00"></p>
<ol>
<li>選擇 <code>SonarQube Scanner</code></li>
<li>按 <code>Download now and install after restart</code></li>
</ol>
<p><img src="/images/sonarqube/php/php003.png" alt="hp00"></p>
<p>安裝 plugin 中。</p>
<ol>
<li>將 <code>Restart Jenkins when installation is complete and no jobs are running</code> 打勾</li>
</ol>
<p><strong>設定 SonarQube 環境變數</strong></p>
<p><img src="/images/sonarqube/php/php006.png" alt="hp00"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Configure System</code></li>
</ol>
<p><img src="/images/sonarqube/php/php005.png" alt="hp00"></p>
<ol>
<li>找到 <code>SonarQube servers</code> 區段</li>
<li>將 <code>Enable injection of SonarQube server configuration as build environment variables</code> 打勾</li>
<li>設定 SonarQube server 名稱與網址</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<p><strong>設定 SonarQube Scanner 環境變數</strong></p>
<p><img src="/images/sonarqube/php/php009.png" alt="hp00"></p>
<ol>
<li>左側選擇 <code>Manage Jenkins</code></li>
<li>右側選擇 <code>Global Tool Configuration</code></li>
</ol>
<p><img src="/images/sonarqube/php/php008.png" alt="hp00"></p>
<ol>
<li>找到 <code>SonarQube Scanner</code> 區段</li>
<li>設定 SonarQube Scanner 名稱</li>
</ol>
<p>最後按 <code>Apply</code> 與 <code>Save</code> 儲存設定。</p>
<h2 id="Jenkins_Job">Jenkins Job</h2><hr>
<p><strong>Source Code Management</strong></p>
<p><img src="/images/sonarqube/php/php007.png" alt="hp00"></p>
<ol>
<li>選擇 Job，按左側 <code>Configure</code></li>
</ol>
<p><img src="/images/sonarqube/php/php027.png" alt="hp02"></p>
<ol>
<li>找到 <code>Source Code Management</code> 區段</li>
<li>將 Git 的 <code>Repository URL</code> 設定到 <code>http://github.com/oomusou/Laravel56Demo</code></li>
</ol>
<p><strong>Build</strong><br><img src="/images/sonarqube/php/php004.png" alt="hp00"></p>
<ol>
<li>找到 <code>Build</code> 區段</li>
<li>在 <code>Add build step</code> 選擇 <code>Execute SonarQube Scanner</code></li>
</ol>
<p><img src="/images/sonarqube/php/php010.png" alt="hp01"></p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=Laravel56 </span><br><span class="line">sonar.sources=. </span><br><span class="line">sonar.projectName=Laravel56 </span><br><span class="line">sonar.projectVersion=1.0 </span><br><span class="line">sonar.exclusions=vendor/<span class="keyword">*</span><span class="keyword">*</span></span><br></pre></td></tr></table></figure>
<p>在 <code>Analysis properties</code> 加上以上設定。</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/MyProject $ sonar-scanner -Dsonar.projectKey=Laravel56 -Dsonar.sources=. -Dsonar.projectName=Laravel56 -Dsonar.projectVersion=1.0 -Dsonar.exclusions=vendor/<span class="keyword">*</span><span class="keyword">*</span></span><br></pre></td></tr></table></figure>
<p>還記得之前曾經下過以上指令嗎？就是將這些 SonarQube property 設定在 Jenkins，改由 Jenkins 幫我們傳。</p>
<p><img src="/images/sonarqube/php/php013.png" alt="hp01"></p>
<ol>
<li>按左側 <code>Build Now</code> 執行 Job</li>
</ol>
<p><img src="/images/sonarqube/php/php012.png" alt="hp01"></p>
<p>執行成功後會出現 <code>OK</code> 與 <code>Success</code>。</p>
<p><img src="/images/sonarqube/php/php014.png" alt="hp01"></p>
<p>也會看到剛剛 Jenkins 執行的 Project 出現在 SonarQube 上。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>SonarQube 已經內建 SonarPHP，也可以用來檢查 PHP</li>
<li>就算不將 SonarQube 安裝在 server，安裝在本機也能有效的檢查 PHP 程式碼品質</li>
<li>藉由 Jenkins 幫忙，我們就可以自動化執行 SonarQube</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/Laravel56Demo" target="_blank" rel="external">GitHub</a> 上找到</p>
<h2 id="Reference">Reference</h2><hr>
<p><a href="https://www.sonarqube.org" target="_blank" rel="external">SonarQube</a>, <a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">SonarQube Downloads</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/PLUG/SonarPHP" target="_blank" rel="external">SonarPHP</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">Analyzing with SonarQube Scanner</a><br><a href="https://docs.sonarqube.org/" target="_blank" rel="external">SonarQube</a>, <a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner+for+Jenkins" target="_blank" rel="external">Analying with SonarQube Scanner for Jenkins</a><br><a href="https://jenkins.io/" target="_blank" rel="external">Jenkins</a>, <a href="https://plugins.jenkins.io/sonar" target="_blank" rel="external">SonarQube Scanner</a></p>
]]></content>
    <summary type="html">
    <![CDATA[SonarQube 現在也能用在 PHP]]>
    
    </summary>
    
      <category term="Laravel" scheme="http://oomusou.io/tags/Laravel/"/>
    
      <category term="PHP" scheme="http://oomusou.io/tags/PHP/"/>
    
      <category term="SonarQube" scheme="http://oomusou.io/tags/SonarQube/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 F# 實現 Decorator Pattern？]]></title>
    <link href="http://oomusou.io/fsharp/decorator/"/>
    <id>http://oomusou.io/fsharp/decorator/</id>
    <published>2018-03-30T12:23:43.000Z</published>
    <updated>2018-04-01T11:41:44.110Z</updated>
    <content type="html"><![CDATA[<p>Decorator Pattern 是 OOP 中著名的 Design Pattern，尤其可在不改變 interface 的前提下，動態對原有物件增加功能，F# 既然是 Function First Language，就讓我們以 function 的角度重新實現 Decorator Pattern。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>.NET Core SDK 2.1.101<br>JetBrains Rider 2017.3.1<br>F# 4.1</p>
<h2 id="User_Story">User Story</h2><hr>
<p>假設你在處理訂單，訂單的折扣方式有兩種</p>
<ul>
<li>超過 1000 元，則 <code>全館八折</code> 再 <code>滿千送百</code></li>
<li>不到 1000 元，則 <code>全館八折</code></li>
</ul>
<h2 id="Task">Task</h2><hr>
<p>直接使用 FP 的思維完成需求。</p>
<h2 id="Definition">Definition</h2><hr>
<blockquote>
<p>Decorator Pattern</p>
<p>在不改變原有 interface 的前提下，動態增加原有的功能</p>
</blockquote>
<p><img src="/images/fsharp/decorator/decorator000.svg" alt="ecorator00"></p>
<p>首先思考 Decorator Pattern 的本質：</p>
<ol>
<li>Component 與 decorator 之間的 interface 必須相同</li>
<li>Component 可自由組合 decorator</li>
</ol>
<p>只要能達到這兩個目標，就算完成了 Decorator Pattern。</p>
<h2 id="OOP_思考方式">OOP 思考方式</h2><hr>
<ul>
<li>為了讓 component 與 decorator 的 interface 要相同，所以必須訂出共同的 interface</li>
<li>由於 decorator 必須包含原本 component 功能，因此 decorator 必須以 state 方式保存原本 component</li>
<li>由於各 decorator 都必須透過 constructor 保存原本 component，因此將共用 constructor 抽出來由 <code>AbstractDecorator</code> 實作<span class="margin-note-marker"><sup>1</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">1</span>關於 OOP 的 Decorator 實作，詳細請參考 <a href="http://oomusou.io/design-pattern/decorator/">如何使用 C# 實現 Decorator Pattern ?</a></span></span></span></li>
</ul>
<h2 id="FP_思考方式">FP 思考方式</h2><hr>
<ul>
<li>Component 與 decorator 都是 function，不用事先定義 interface，反正只要 interface 不同，在 Pattern Matching 一定會編譯錯誤</li>
<li>Component 與 decorator 都是 function，既然 interface 都相同，只要使用 Function Composition 產生新的 function 即可</li>
</ul>
<h2 id="Implementation">Implementation</h2><hr>
<p><strong>PriceDecorator.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> OrderLibrary</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> PriceDecorator =  </span><br><span class="line">    <span class="keyword">let</span> discountPrice price = price * <span class="number">0.8</span></span><br><span class="line">    <span class="keyword">let</span> rebatePrice price = price - <span class="number">100.0</span></span><br></pre></td></tr></table></figure>
<p>以 <code>discountPrice()</code> 表示 <code>全館八折</code>。</p>
<p>以 <code>rebatePrice()</code> 表示 <code>滿千送百</code>。</p>
<p>由於 component 與 decorator 基本上都是 <code>double -&gt; double</code> 的型別，可以廣義視為 decorator 放在同一 module。</p>
<p><strong>OrderService.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> OrderLibrary</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> PriceDecorator</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> OrderService =</span><br><span class="line">    <span class="keyword">let</span> getPrice price = </span><br><span class="line">        <span class="keyword">match</span> price &gt; <span class="number">1000.0</span> <span class="keyword">with</span></span><br><span class="line">        | <span class="keyword">true</span> -&gt; (discountPrice &gt;&gt; rebatePrice) price</span><br><span class="line">        | <span class="keyword">false</span> -&gt; discountPrice price</span><br></pre></td></tr></table></figure>
<p>根據商業邏輯：</p>
<blockquote>
<p>超過 1000 元，則 <code>全館八折</code> 再 <code>滿千送百</code></p>
</blockquote>
<p>因此將 <code>discountPrice()</code> 與 <code>rebatePrice()</code> 以 <code>&gt;&gt;</code> compose 成一個新的 function，就相當於 <code>全館八折</code> 再 <code>滿千送百</code></p>
<blockquote>
<p>在 FP 只要使用 Compose Function，就相當於 OOP 的 Decorator Pattern，在 F# 只需 <code>&gt;&gt;</code>，但 C# 卻要 interface 與 abstract class 的搭配才能實現</p>
</blockquote>
<p><strong>Program.fs</strong></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> System</span><br><span class="line"><span class="keyword">open</span> OrderLibrary</span><br><span class="line"></span><br><span class="line"><span class="annotation">[&lt;EntryPoint&gt;]</span></span><br><span class="line"><span class="keyword">let</span> main argv =</span><br><span class="line">    <span class="number">1200.0</span></span><br><span class="line">    |&gt; OrderService.getPrice</span><br><span class="line">    |&gt; printfn <span class="string">"%f"</span></span><br><span class="line">    </span><br><span class="line">    <span class="number">800.0</span></span><br><span class="line">    |&gt; OrderService.getPrice</span><br><span class="line">    |&gt; printfn <span class="string">"%f"</span></span><br><span class="line">        </span><br><span class="line">    <span class="number">0</span> <span class="comment">// return an integer exit code</span></span><br></pre></td></tr></table></figure>
<p>將各種 price 以 Pipeline 方式傳給 <code>OrderService.getPrice()</code> 計算，並將結果傳給 <code>printfn()</code> 顯示。</p>
<h2 id="Summary">Summary</h2><hr>
<p>回想 Decorator Pattern 的本質：</p>
<ol>
<li>Component 與 decorator 之間的 interface 必須相同</li>
<li>Component 可自由組合 decorator</li>
</ol>
<p>由於 component 與 decorator 的 interface 相同，可以廣義視為 decorator，雖然沒有特別定義 interface，但 <code>discountPrice()</code> 與 <code>rebatePrice()</code> 的 signature 都是 <code>double -&gt; double</code>，若 function 的 signature 不同，在 Pattern Matching 就會編譯錯誤，與原本 Decorator Pattern 定義 interface 的本質相同。</p>
<p>原本 OOP 的 Decorator Pattern 可以透過 <code>new</code> 自由組合 decorator object，但 FP 可透過 <code>&gt;&gt;</code> 自由組合 decorator function，與原本 Decorator Pattern 的自由組合 decorator 本質相同。</p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>Decorator Pattern 本質就是 object 的組合，但 object 的組合沒 function 簡單直覺，所以才需要搭配 interface 與 abstract class，但若純 function，只要使用 Function Composition 即可簡單完成</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的 <a href="https://github.com/oomusou/FSharpCore2OrderDecorator" target="_blank" rel="external">GitHub</a> 上找到</p>
]]></content>
    <summary type="html">
    <![CDATA[以 FP 重新思考 Decorator Pattern]]>
    
    </summary>
    
      <category term="Design Pattern" scheme="http://oomusou.io/tags/Design-Pattern/"/>
    
      <category term="F#" scheme="http://oomusou.io/tags/F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[如何使用 Docker 安裝 SonarQube？]]></title>
    <link href="http://oomusou.io/sonarqube/docker/"/>
    <id>http://oomusou.io/sonarqube/docker/</id>
    <published>2018-03-29T13:23:43.000Z</published>
    <updated>2018-03-29T14:14:33.325Z</updated>
    <content type="html"><![CDATA[<p>SonarQube 是一套 <code>程式碼品質檢查工具</code>，可以幫我們檢查 code 的 bugs、 vulenrability、code smell 與 duplication，也屬於 <code>持續整合</code> 重要的一環，亦可使用 Docker 安裝，將來管理會更加容易。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>macOS High Sierra 10.13.3<br>Docker for Mac 18.03.0-ce-mac59 (23608)<br>SonarQube 6.7.2 (build 37468)</p>
<h2 id="下載_Docker_Image">下載 Docker Image</h2><hr>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name sonarqube -p <span class="number">9000</span>:<span class="number">9000</span> -p <span class="number">9092</span>:<span class="number">9092</span> sonarqube:lts</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker run</code> 下載 image 並建立 container 並執行之。</p>
<ul>
<li><strong>-d</strong>：<code>d</code> etach，建立 container 後，就脫離目前 process</li>
<li><strong>–name</strong>：替 container 取一個人能夠識別的名字</li>
<li><strong>-p</strong>：Docker 外部與 SonarQube內部所對應的 port，其中左邊為外部 Docker 的 port，右邊為 SonarQube 內部的 port</li>
<li><p><strong>sonarqube:lts</strong>：SonarQube 的 LTS 版本，目前為 <code>6.7.2</code></p>
<p>若要下載最新版 SonarQube，可使用以下指令：</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name sonarqube -p <span class="number">9000</span>:<span class="number">9000</span> -p <span class="number">9092</span>:<span class="number">9092</span> sonarqube</span><br></pre></td></tr></table></figure>
<p>不指定為 LTS 版，則下載最新版 SonarQube。</p>
<p><img src="/images/sonarqube/docker/docker000.png" alt="ocker00"></p>
<ol>
<li>輸入 <code>docker run …</code> 下載 SonarQube 的 docker image，並建立 container 執行之</li>
</ol>
<p><img src="/images/sonarqube/docker/docker001.png" alt="ocker00"></p>
<p>輸入 <code>localhost:9000</code>，若看到 SonarQube 首頁，則表示安裝成功。</p>
<h2 id="啟動_SonarQube">啟動 SonarQube</h2><hr>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">start</span> sonarqube</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker start</code> 啟動 SonarQube container。</p>
<p><img src="/images/sonarqube/docker/docker003.png" alt="ocker00"></p>
<ol>
<li>輸入 <code>docker start sonarqube</code> 啟動 SonarQube container</li>
</ol>
<h2 id="停止_SonarQube">停止 SonarQube</h2><hr>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>docker stop sonarqube</span><br></pre></td></tr></table></figure>
<p>使用 <code>docker stop</code> 停止 SonarQube container。</p>
<p><img src="/images/sonarqube/docker/docker002.png" alt="ocker00"></p>
<ol>
<li>輸入 <code>docker stop sonarqube</code> 停止 sonarqube container</li>
</ol>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>雖然在 macOS 安裝原生的 SonarQube 並不難，但使用 Docker 安裝 SonarQube 更簡單，且管理更方便</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[使用 Docker 安裝 SonarQube 更簡單]]>
    
    </summary>
    
      <category term="Docker" scheme="http://oomusou.io/tags/Docker/"/>
    
      <category term="SonarQube" scheme="http://oomusou.io/tags/SonarQube/"/>
    
  </entry>
  
</feed>
